/*! For license information please see signup.bundle.js.LICENSE.txt */
(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})}};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var t={};e.r(t),e.d(t,{FirebaseError:()=>y,SDK_VERSION:()=>Ie,_DEFAULT_ENTRY_NAME:()=>ce,_addComponent:()=>de,_addOrOverwriteComponent:()=>fe,_apps:()=>le,_clearComponents:()=>ye,_components:()=>he,_getProvider:()=>me,_registerComponent:()=>pe,_removeServiceInstance:()=>ge,deleteApp:()=>Ee,getApp:()=>_e,getApps:()=>Te,initializeApp:()=>be,onLog:()=>ke,registerVersion:()=>Se,setLogLevel:()=>Ae});const n=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},r={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){const i=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,u=i>>2,l=(3&i)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(h=64)),r.push(n[u],n[l],n[h],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(n(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){const s=n[e.charAt(t++)],o=t<e.length?n[e.charAt(t)]:0;++t;const a=t<e.length?n[e.charAt(t)]:64;++t;const c=t<e.length?n[e.charAt(t)]:64;if(++t,null==s||null==o||null==a||null==c)throw new i;const u=s<<2|o>>4;if(r.push(u),64!==a){const e=o<<4&240|a>>2;if(r.push(e),64!==c){const e=a<<6&192|c;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class i extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const s=function(e){return function(e){const t=n(e);return r.encodeByteArray(t,!0)}(e).replace(/\./g,"")},o=function(e){try{return r.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function a(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=a(e[n],t[n]));return e}const c=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==e.g)return e.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&o(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},u=()=>{var e;return null===(e=c())||void 0===e?void 0:e.config};class l{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function h(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function d(){var t;const n=null===(t=c())||void 0===t?void 0:t.forceEnvironment;if("node"===n)return!0;if("browser"===n)return!1;try{return"[object process]"===Object.prototype.toString.call(e.g.process)}catch(e){return!1}}function f(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function p(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function m(){const e=h();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function g(){try{return"object"==typeof indexedDB}catch(e){return!1}}class y extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,y.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,v.prototype.create)}}class v{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace(w,((e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new y(r,o,n)}}const w=/\{\$([^}]+)}/g;function I(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function b(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(_(n)&&_(s)){if(!b(n,s))return!1}else if(n!==s)return!1}for(const e of r)if(!n.includes(e))return!1;return!0}function _(e){return null!==e&&"object"==typeof e}function T(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function E(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}})),t}function S(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}function k(e,t){const n=new A(e,t);return n.subscribe.bind(n)}class A{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=C),void 0===r.error&&(r.error=C),void 0===r.complete&&(r.complete=C);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}})),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function C(){}function N(e){return e&&e._delegate?e._delegate:e}class D{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const x="[DEFAULT]";class R{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new l;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:x})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=x){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=x){return this.instances.has(e)}getOptions(e=x){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===x?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e=x){return this.component?this.component.multipleInstances?e:x:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class O{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new R(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const P=[];var L;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(L||(L={}));const M={debug:L.DEBUG,verbose:L.VERBOSE,info:L.INFO,warn:L.WARN,error:L.ERROR,silent:L.SILENT},F=L.INFO,V={[L.DEBUG]:"log",[L.VERBOSE]:"log",[L.INFO]:"info",[L.WARN]:"warn",[L.ERROR]:"error"},U=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),i=V[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)};class q{constructor(e){this.name=e,this._logLevel=F,this._logHandler=U,this._userLogHandler=null,P.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in L))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?M[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,L.DEBUG,...e),this._logHandler(this,L.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,L.VERBOSE,...e),this._logHandler(this,L.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,L.INFO,...e),this._logHandler(this,L.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,L.WARN,...e),this._logHandler(this,L.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,L.ERROR,...e),this._logHandler(this,L.ERROR,...e)}}const B=(e,t)=>t.some((t=>e instanceof t));let j,K;const G=new WeakMap,z=new WeakMap,$=new WeakMap,W=new WeakMap,H=new WeakMap;let Q={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return z.get(e);if("objectStoreNames"===t)return e.objectStoreNames||$.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Y(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function X(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(K||(K=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(J(this),e),Y(G.get(this))}:function(...e){return Y(t.apply(J(this),e))}:function(e,...n){const r=t.call(J(this),e,...n);return $.set(r,e.sort?e.sort():[e]),Y(r)}:(e instanceof IDBTransaction&&function(e){if(z.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)}));z.set(e,t)}(e),B(e,j||(j=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,Q):e);var t}function Y(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(Y(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&G.set(t,e)})).catch((()=>{})),H.set(t,e),t}(e);if(W.has(e))return W.get(e);const t=X(e);return t!==e&&(W.set(e,t),H.set(t,e)),t}const J=e=>H.get(e),Z=["get","getKey","getAll","getAllKeys","count"],ee=["put","add","delete","clear"],te=new Map;function ne(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(te.get(t))return te.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=ee.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!Z.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&s.done]))[0]};return te.set(t,s),s}var re;re=Q,Q={...re,get:(e,t,n)=>ne(e,t)||re.get(e,t,n),has:(e,t)=>!!ne(e,t)||re.has(e,t)};class ie{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const se="@firebase/app",oe="0.9.4",ae=new q("@firebase/app"),ce="[DEFAULT]",ue={[se]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},le=new Map,he=new Map;function de(e,t){try{e.container.addComponent(t)}catch(n){ae.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function fe(e,t){e.container.addOrOverwriteComponent(t)}function pe(e){const t=e.name;if(he.has(t))return ae.debug(`There were multiple attempts to register component ${t}.`),!1;he.set(t,e);for(const t of le.values())de(t,e);return!0}function me(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function ge(e,t,n=ce){me(e,t).clearInstance(n)}function ye(){he.clear()}const ve=new v("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class we{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new D("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ve.create("app-deleted",{appName:this._name})}}const Ie="9.17.2";function be(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const r=Object.assign({name:ce,automaticDataCollectionEnabled:!1},t),i=r.name;if("string"!=typeof i||!i)throw ve.create("bad-app-name",{appName:String(i)});if(n||(n=u()),!n)throw ve.create("no-options");const s=le.get(i);if(s){if(b(n,s.options)&&b(r,s.config))return s;throw ve.create("duplicate-app",{appName:i})}const o=new O(i);for(const e of he.values())o.addComponent(e);const a=new we(n,r,o);return le.set(i,a),a}function _e(e=ce){const t=le.get(e);if(!t&&e===ce)return be();if(!t)throw ve.create("no-app",{appName:e});return t}function Te(){return Array.from(le.values())}async function Ee(e){const t=e.name;le.has(t)&&(le.delete(t),await Promise.all(e.container.getProviders().map((e=>e.delete()))),e.isDeleted=!0)}function Se(e,t,n){var r;let i=null!==(r=ue[e])&&void 0!==r?r:e;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const e=[`Unable to register library "${i}" with version "${t}":`];return s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void ae.warn(e.join(" "))}pe(new D(`${i}-version`,(()=>({library:i,version:t})),"VERSION"))}function ke(e,t){if(null!==e&&"function"!=typeof e)throw ve.create("invalid-log-argument");!function(e,t){for(const n of P){let r=null;t&&t.level&&(r=M[t.level]),n.userLogHandler=null===e?null:(t,n,...i)=>{const s=i.map((e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}})).filter((e=>e)).join(" ");n>=(null!=r?r:t.logLevel)&&e({level:L[n].toLowerCase(),message:s,args:i,type:t.name})}}}(e,t)}function Ae(e){var t;t=e,P.forEach((e=>{e.setLogLevel(t)}))}const Ce="firebase-heartbeat-database",Ne=1,De="firebase-heartbeat-store";let xe=null;function Re(){return xe||(xe=function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),a=Y(o);return r&&o.addEventListener("upgradeneeded",(e=>{r(Y(o.result),e.oldVersion,e.newVersion,Y(o.transaction))})),n&&o.addEventListener("blocked",(()=>n())),a.then((e=>{s&&e.addEventListener("close",(()=>s())),i&&e.addEventListener("versionchange",(()=>i()))})).catch((()=>{})),a}(Ce,Ne,{upgrade:(e,t)=>{0===t&&e.createObjectStore(De)}}).catch((e=>{throw ve.create("idb-open",{originalErrorMessage:e.message})}))),xe}async function Oe(e,t){try{const n=(await Re()).transaction(De,"readwrite"),r=n.objectStore(De);return await r.put(t,Pe(e)),n.done}catch(e){if(e instanceof y)ae.warn(e.message);else{const t=ve.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});ae.warn(t.message)}}}function Pe(e){return`${e.name}!${e.options.appId}`}class Le{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Fe(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=Me();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==t&&!this._heartbeatsCache.heartbeats.some((e=>e.date===t)))return this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const e=Me(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){const n=[];let r=e.slice();for(const i of e){const e=n.find((e=>e.agent===i.agent));if(e){if(e.dates.push(i.date),Ve(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),Ve(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),r=s(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}}function Me(){return(new Date).toISOString().substring(0,10)}class Fe{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!g()&&new Promise(((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}})).then((()=>!0)).catch((()=>!1))}async read(){return await this._canUseIndexedDBPromise&&await async function(e){try{return(await Re()).transaction(De).objectStore(De).get(Pe(e))}catch(e){if(e instanceof y)ae.warn(e.message);else{const t=ve.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});ae.warn(t.message)}}}(this.app)||{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Oe(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Oe(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function Ve(e){return s(JSON.stringify({version:2,heartbeats:e})).length}pe(new D("platform-logger",(e=>new ie(e)),"PRIVATE")),pe(new D("heartbeat",(e=>new Le(e)),"PRIVATE")),Se(se,oe,""),Se(se,oe,"esm2017"),Se("fire-js","");class Ue{constructor(e,t){this._delegate=e,this.firebase=t,de(e,new D("app-compat",(()=>this),"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise((e=>{this._delegate.checkDestroyed(),e()})).then((()=>(this.firebase.INTERNAL.removeApp(this.name),Ee(this._delegate))))}_getService(e,t=ce){var n;this._delegate.checkDestroyed();const r=this._delegate.container.getProvider(e);return r.isInitialized()||"EXPLICIT"!==(null===(n=r.getComponent())||void 0===n?void 0:n.instantiationMode)||r.initialize(),r.getImmediate({identifier:t})}_removeServiceInstance(e,t=ce){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){de(this._delegate,e)}_addOrOverwriteComponent(e){fe(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const qe=new v("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."}),Be=function e(){const n=function(e){const n={},r={__esModule:!0,initializeApp:function(t,i={}){const s=be(t,i);if(I(n,s.name))return n[s.name];const o=new e(s,r);return n[s.name]=o,o},app:i,registerVersion:Se,setLogLevel:Ae,onLog:ke,apps:null,SDK_VERSION:Ie,INTERNAL:{registerComponent:function(t){const n=t.name,s=n.replace("-compat","");if(pe(t)&&"PUBLIC"===t.type){const o=(e=i())=>{if("function"!=typeof e[s])throw qe.create("invalid-app-argument",{appName:n});return e[s]()};void 0!==t.serviceProps&&a(o,t.serviceProps),r[s]=o,e.prototype[s]=function(...e){return this._getService.bind(this,n).apply(this,t.multipleInstances?e:[])}}return"PUBLIC"===t.type?r[s]:null},removeApp:function(e){delete n[e]},useAsService:function(e,t){return"serverAuth"===t?null:t},modularAPIs:t}};function i(e){if(!I(n,e=e||ce))throw qe.create("no-app",{appName:e});return n[e]}return r.default=r,Object.defineProperty(r,"apps",{get:function(){return Object.keys(n).map((e=>n[e]))}}),i.App=e,r}(Ue);return n.INTERNAL=Object.assign(Object.assign({},n.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){a(n,e)},createSubscribe:k,ErrorFactory:v,deepExtend:a}),n}(),je=new q("@firebase/app-compat");if("object"==typeof self&&self.self===self&&void 0!==self.firebase){je.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");const e=self.firebase.SDK_VERSION;e&&e.indexOf("LITE")>=0&&je.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}const Ke=Be;function Ge(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}Se("@firebase/app-compat","0.2.4",void 0),Ke.registerVersion("firebase","9.17.2","app-compat"),Object.create,Object.create;const ze={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},$e="EMAIL_SIGNIN",We="PASSWORD_RESET",He="RECOVER_EMAIL",Qe="REVERT_SECOND_FACTOR_ADDITION",Xe="VERIFY_AND_CHANGE_EMAIL",Ye="VERIFY_EMAIL";const Je=function(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}},Ze=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},et=new v("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),tt=new q("@firebase/auth");function nt(e,...t){tt.logLevel<=L.ERROR&&tt.error(`Auth (${Ie}): ${e}`,...t)}function rt(e,...t){throw at(e,...t)}function it(e,...t){return at(e,...t)}function st(e,t,n){const r=Object.assign(Object.assign({},Ze()),{[t]:n});return new v("auth","Firebase",r).create(t,{appName:e.name})}function ot(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&rt(e,"argument-error"),st(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function at(e,...t){if("string"!=typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return et.create(e,...t)}function ct(e,t,...n){if(!e)throw at(t,...n)}function ut(e){const t="INTERNAL ASSERTION FAILED: "+e;throw nt(t),new Error(t)}function lt(e,t){e||ut(t)}const ht=new Map;function dt(e){lt(e instanceof Function,"Expected a class definition");let t=ht.get(e);return t?(lt(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,ht.set(e,t),t)}function ft(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function pt(){return"http:"===mt()||"https:"===mt()}function mt(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class gt{constructor(e,t){this.shortDelay=e,this.longDelay=t,lt(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(h())||p()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(pt()||f()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function yt(e,t){lt(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class vt{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void ut("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void ut("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void ut("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const wt={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},It=new gt(3e4,6e4);function bt(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function _t(e,t,n,r,i={}){return Tt(e,i,(async()=>{let i={},s={};r&&("GET"===t?s=r:i={body:JSON.stringify(r)});const o=T(Object.assign({key:e.config.apiKey},s)).slice(1),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode),vt.fetch()(St(e,e.config.apiHost,n,o),Object.assign({method:t,headers:a,referrerPolicy:"no-referrer"},i))}))}async function Tt(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},wt),t);try{const t=new kt(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await i.json();if("needConfirmation"in s)throw At(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw At(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw At(e,"email-already-in-use",s);if("USER_DISABLED"===n)throw At(e,"user-disabled",s);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw st(e,a,o);rt(e,a)}}catch(t){if(t instanceof y)throw t;rt(e,"internal-error",{message:String(t)})}}async function Et(e,t,n,r,i={}){const s=await _t(e,t,n,r,i);return"mfaPendingCredential"in s&&rt(e,"multi-factor-auth-required",{_serverResponse:s}),s}function St(e,t,n,r){const i=`${t}${n}?${r}`;return e.config.emulator?yt(e.config,i):`${e.config.apiScheme}://${i}`}class kt{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(it(this.auth,"network-request-failed"))),It.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function At(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=it(e,t,r);return i.customData._tokenResponse=n,i}function Ct(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function Nt(e){return 1e3*Number(e)}function Dt(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return nt("JWT malformed, contained fewer than 3 sections"),null;try{const e=o(n);return e?JSON.parse(e):(nt("Failed to decode base64 JWT payload"),null)}catch(e){return nt("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}async function xt(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof y&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class Rt{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class Ot{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ct(this.lastLoginAt),this.creationTime=Ct(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Pt(e){var t;const n=e.auth,r=await e.getIdToken(),i=await xt(e,async function(e,t){return _t(e,"POST","/v1/accounts:lookup",t)}(n,{idToken:r}));ct(null==i?void 0:i.users.length,n,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const o=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?s.providerUserInfo.map((e=>{var{providerId:t}=e,n=Ge(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[],a=(c=e.providerData,u=o,[...c.filter((e=>!u.some((t=>t.providerId===e.providerId)))),...u]);var c,u;const l=e.isAnonymous,h=!(e.email&&s.passwordHash||(null==a?void 0:a.length)),d=!!l&&h,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new Ot(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(e,f)}class Lt{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ct(e.idToken,"internal-error"),ct(void 0!==e.idToken,"internal-error"),ct(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){const t=Dt(e);return ct(t,"internal-error"),ct(void 0!==t.exp,"internal-error"),ct(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return ct(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:i}=await async function(e,t){const n=await Tt(e,{},(async()=>{const n=T({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,s=St(e,r,"/v1/token",`key=${i}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",vt.fetch()(s,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new Lt;return n&&(ct("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(ct("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(ct("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Lt,this.toJSON())}_performRefresh(){return ut("not implemented")}}function Mt(e,t){ct("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Ft{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=Ge(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Rt(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Ot(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await xt(this,this.stsTokenManager.getToken(this.auth,e));return ct(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=N(e),r=await n.getIdToken(t),i=Dt(r);ct(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const s="object"==typeof i.firebase?i.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:Ct(Nt(i.auth_time)),issuedAtTime:Ct(Nt(i.iat)),expirationTime:Ct(Nt(i.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=N(e);await Pt(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(ct(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new Ft(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){ct(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await Pt(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await xt(this,async function(e,t){return _t(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,o,a,c,u;const l=null!==(n=t.displayName)&&void 0!==n?n:void 0,h=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,f=null!==(s=t.photoURL)&&void 0!==s?s:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,m=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,g=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:v,emailVerified:w,isAnonymous:I,providerData:b,stsTokenManager:_}=t;ct(v&&_,e,"internal-error");const T=Lt.fromJSON(this.name,_);ct("string"==typeof v,e,"internal-error"),Mt(l,e.name),Mt(h,e.name),ct("boolean"==typeof w,e,"internal-error"),ct("boolean"==typeof I,e,"internal-error"),Mt(d,e.name),Mt(f,e.name),Mt(p,e.name),Mt(m,e.name),Mt(g,e.name),Mt(y,e.name);const E=new Ft({uid:v,auth:e,email:h,emailVerified:w,displayName:l,isAnonymous:I,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:T,createdAt:g,lastLoginAt:y});return b&&Array.isArray(b)&&(E.providerData=b.map((e=>Object.assign({},e)))),m&&(E._redirectEventId=m),E}static async _fromIdTokenResponse(e,t,n=!1){const r=new Lt;r.updateFromServerResponse(t);const i=new Ft({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await Pt(i),i}}class Vt{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Vt.type="NONE";const Ut=Vt;function qt(e,t,n){return`firebase:${e}:${t}:${n}`}class Bt{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=qt(this.userKey,r.apiKey,i),this.fullPersistenceKey=qt("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Ft._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new Bt(dt(Ut),e,n);const r=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let i=r[0]||dt(Ut);const s=qt(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=await n._get(s);if(t){const r=Ft._fromJSON(e,t);n!==i&&(o=r),i=n;break}}catch(e){}const a=r.filter((e=>e._shouldAllowMigration));return i._shouldAllowMigration&&a.length?(i=a[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new Bt(i,e,n)):new Bt(i,e,n)}}function jt(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if($t(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Kt(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Ht(t))return"Blackberry";if(Qt(t))return"Webos";if(Gt(t))return"Safari";if((t.includes("chrome/")||zt(t))&&!t.includes("edge/"))return"Chrome";if(Wt(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function Kt(e=h()){return/firefox\//i.test(e)}function Gt(e=h()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function zt(e=h()){return/crios\//i.test(e)}function $t(e=h()){return/iemobile/i.test(e)}function Wt(e=h()){return/android/i.test(e)}function Ht(e=h()){return/blackberry/i.test(e)}function Qt(e=h()){return/webos/i.test(e)}function Xt(e=h()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Yt(e=h()){return Xt(e)||Wt(e)||Qt(e)||Ht(e)||/windows phone/i.test(e)||$t(e)}function Jt(e,t=[]){let n;switch(e){case"Browser":n=jt(h());break;case"Worker":n=`${jt(h())}-${e}`;break;default:n=e}const r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${Ie}/${r}`}class Zt{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,r)=>{try{n(e(t))}catch(e){r(e)}}));n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const e of t)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class en{constructor(e,t,n){this.app=e,this.heartbeatServiceProvider=t,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new nn(this),this.idTokenSubscription=new nn(this),this.beforeStateQueue=new Zt(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=et,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=dt(t)),this._initializationPromise=this.queue((async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await Bt.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUser(e){var t;const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,s=null==r?void 0:r._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==s||!(null==o?void 0:o.user)||(r=o.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(e)))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return ct(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Pt(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?N(e):null;return t&&ct(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&ct(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue((async()=>{await this.assertedPersistence.setPersistence(dt(e))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new v("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&dt(e)||this._popupRedirectResolver;ct(t,this,"argument-error"),this.redirectPersistenceManager=await Bt.create(this,[dt(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return ct(s,this,"internal-error"),s.then((()=>i(this.currentUser))),"function"==typeof t?e.addObserver(t,n,r):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ct(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Jt(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());return n&&(t["X-Firebase-Client"]=n),t}}function tn(e){return N(e)}class nn{constructor(e){this.auth=e,this.observer=null,this.addObserver=k((e=>this.observer=e))}get next(){return ct(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function rn(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function sn(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class on{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return ut("not implemented")}_getIdTokenResponse(e){return ut("not implemented")}_linkToIdToken(e,t){return ut("not implemented")}_getReauthenticationResolver(e){return ut("not implemented")}}async function an(e,t){return _t(e,"POST","/v1/accounts:resetPassword",bt(e,t))}async function cn(e,t){return _t(e,"POST","/v1/accounts:update",t)}async function un(e,t){return _t(e,"POST","/v1/accounts:sendOobCode",bt(e,t))}class ln extends on{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new ln(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new ln(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return async function(e,t){return Et(e,"POST","/v1/accounts:signInWithPassword",bt(e,t))}(e,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return Et(e,"POST","/v1/accounts:signInWithEmailLink",bt(e,t))}(e,{email:this._email,oobCode:this._password});default:rt(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return cn(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return Et(e,"POST","/v1/accounts:signInWithEmailLink",bt(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:rt(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function hn(e,t){return Et(e,"POST","/v1/accounts:signInWithIdp",bt(e,t))}class dn extends on{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new dn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):rt("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=Ge(t,["providerId","signInMethod"]);if(!n||!r)return null;const s=new dn(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return hn(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,hn(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,hn(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=T(t)}return e}}const fn={USER_NOT_FOUND:"user-not-found"};class pn extends on{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new pn({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new pn({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return Et(e,"POST","/v1/accounts:signInWithPhoneNumber",bt(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await Et(e,"POST","/v1/accounts:signInWithPhoneNumber",bt(e,t));if(n.temporaryProof)throw At(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return Et(e,"POST","/v1/accounts:signInWithPhoneNumber",bt(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),fn)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new pn({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class mn{constructor(e){var t,n,r,i,s,o;const a=E(S(e)),c=null!==(t=a.apiKey)&&void 0!==t?t:null,u=null!==(n=a.oobCode)&&void 0!==n?n:null,l=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=a.mode)&&void 0!==r?r:null);ct(c&&u&&l,"argument-error"),this.apiKey=c,this.operation=l,this.code=u,this.continueUrl=null!==(i=a.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(s=a.languageCode)&&void 0!==s?s:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=E(S(e)).link,n=t?E(S(t)).deep_link_id:null,r=E(S(e)).deep_link_id;return(r?E(S(r)).link:null)||r||n||t||e}(e);try{return new mn(t)}catch(e){return null}}}class gn{constructor(){this.providerId=gn.PROVIDER_ID}static credential(e,t){return ln._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=mn.parseLink(t);return ct(n,"argument-error"),ln._fromEmailAndCode(e,n.code,n.tenantId)}}gn.PROVIDER_ID="password",gn.EMAIL_PASSWORD_SIGN_IN_METHOD="password",gn.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class yn{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class vn extends yn{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class wn extends vn{static credentialFromJSON(e){const t="string"==typeof e?JSON.parse(e):e;return ct("providerId"in t&&"signInMethod"in t,"argument-error"),dn._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return ct(e.idToken||e.accessToken,"argument-error"),dn._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return wn.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return wn.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:r,pendingToken:i,nonce:s,providerId:o}=e;if(!(n||r||t||i))return null;if(!o)return null;try{return new wn(o)._credential({idToken:t,accessToken:n,nonce:s,pendingToken:i})}catch(e){return null}}}class In extends vn{constructor(){super("facebook.com")}static credential(e){return dn._fromParams({providerId:In.PROVIDER_ID,signInMethod:In.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return In.credentialFromTaggedObject(e)}static credentialFromError(e){return In.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return In.credential(e.oauthAccessToken)}catch(e){return null}}}In.FACEBOOK_SIGN_IN_METHOD="facebook.com",In.PROVIDER_ID="facebook.com";class bn extends vn{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return dn._fromParams({providerId:bn.PROVIDER_ID,signInMethod:bn.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return bn.credentialFromTaggedObject(e)}static credentialFromError(e){return bn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return bn.credential(t,n)}catch(e){return null}}}bn.GOOGLE_SIGN_IN_METHOD="google.com",bn.PROVIDER_ID="google.com";class _n extends vn{constructor(){super("github.com")}static credential(e){return dn._fromParams({providerId:_n.PROVIDER_ID,signInMethod:_n.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return _n.credentialFromTaggedObject(e)}static credentialFromError(e){return _n.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return _n.credential(e.oauthAccessToken)}catch(e){return null}}}_n.GITHUB_SIGN_IN_METHOD="github.com",_n.PROVIDER_ID="github.com";class Tn extends on{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return hn(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,hn(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,hn(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r,pendingToken:i}=t;return n&&r&&i&&n===r?new Tn(n,i):null}static _create(e,t){return new Tn(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class En extends yn{constructor(e){ct(e.startsWith("saml."),"argument-error"),super(e)}static credentialFromResult(e){return En.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return En.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=Tn.fromJSON(e);return ct(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:n}=e;if(!t||!n)return null;try{return Tn._create(n,t)}catch(e){return null}}}class Sn extends vn{constructor(){super("twitter.com")}static credential(e,t){return dn._fromParams({providerId:Sn.PROVIDER_ID,signInMethod:Sn.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Sn.credentialFromTaggedObject(e)}static credentialFromError(e){return Sn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return Sn.credential(t,n)}catch(e){return null}}}async function kn(e,t){return Et(e,"POST","/v1/accounts:signUp",bt(e,t))}Sn.TWITTER_SIGN_IN_METHOD="twitter.com",Sn.PROVIDER_ID="twitter.com";class An{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const i=await Ft._fromIdTokenResponse(e,n,r),s=Cn(n);return new An({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=Cn(n);return new An({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function Cn(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class Nn extends y{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,Nn.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new Nn(e,t,n,r)}}function Dn(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw Nn._fromErrorAndOperation(e,n,t,r);throw n}))}function xn(e){return new Set(e.map((({providerId:e})=>e)).filter((e=>!!e)))}async function Rn(e,t,n=!1){const r=await xt(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return An._forOperation(e,"link",r)}async function On(e,t,n){await Pt(t);const r=!1===e?"provider-already-linked":"no-such-provider";ct(xn(t.providerData).has(n)===e,t.auth,r)}async function Pn(e,t,n=!1){const{auth:r}=e,i="reauthenticate";try{const s=await xt(e,Dn(r,i,t,e),n);ct(s.idToken,r,"internal-error");const o=Dt(s.idToken);ct(o,r,"internal-error");const{sub:a}=o;return ct(e.uid===a,r,"user-mismatch"),An._forOperation(e,i,s)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&rt(r,"user-mismatch"),e}}async function Ln(e,t,n=!1){const r="signIn",i=await Dn(e,r,t),s=await An._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(s.user),s}async function Mn(e,t){return Ln(tn(e),t)}async function Fn(e,t){const n=N(e);return await On(!1,n,t.providerId),Rn(n,t)}async function Vn(e,t){return Pn(N(e),t)}class Un{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?qn._fromServerResponse(e,t):rt(e,"internal-error")}}class qn extends Un{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new qn(t)}}function Bn(e,t,n){var r;ct((null===(r=n.url)||void 0===r?void 0:r.length)>0,e,"invalid-continue-uri"),ct(void 0===n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(ct(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(ct(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function jn(e,t){const n=N(e),r=await an(n,{oobCode:t}),i=r.requestType;switch(ct(i,n,"internal-error"),i){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":ct(r.newEmail,n,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":ct(r.mfaInfo,n,"internal-error");default:ct(r.email,n,"internal-error")}let s=null;return r.mfaInfo&&(s=Un._fromServerResponse(tn(n),r.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.newEmail:r.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.email:r.newEmail)||null,multiFactorInfo:s},operation:i}}async function Kn(e,t,n){const{auth:r}=e,i={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(i.email=t),n&&(i.password=n);const s=await xt(e,cn(r,i));await e._updateTokensIfNecessary(s,!0)}class Gn{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class zn extends Gn{constructor(e,t,n,r){super(e,t,n),this.username=r}}class $n extends Gn{constructor(e,t){super(e,"facebook.com",t)}}class Wn extends zn{constructor(e,t){super(e,"github.com",t,"string"==typeof(null==t?void 0:t.login)?null==t?void 0:t.login:null)}}class Hn extends Gn{constructor(e,t){super(e,"google.com",t)}}class Qn extends zn{constructor(e,t,n){super(e,"twitter.com",t,n)}}function Xn(e){const{user:t,_tokenResponse:n}=e;return t.isAnonymous&&!n?{providerId:null,isNewUser:!1,profile:null}:function(e){var t,n;if(!e)return null;const{providerId:r}=e,i=e.rawUserInfo?JSON.parse(e.rawUserInfo):{},s=e.isNewUser||"identitytoolkit#SignupNewUserResponse"===e.kind;if(!r&&(null==e?void 0:e.idToken)){const r=null===(n=null===(t=Dt(e.idToken))||void 0===t?void 0:t.firebase)||void 0===n?void 0:n.sign_in_provider;if(r)return new Gn(s,"anonymous"!==r&&"custom"!==r?r:null)}if(!r)return null;switch(r){case"facebook.com":return new $n(s,i);case"github.com":return new Wn(s,i);case"google.com":return new Hn(s,i);case"twitter.com":return new Qn(s,i,e.screenName||null);case"custom":case"anonymous":return new Gn(s,null);default:return new Gn(s,r,i)}}(n)}class Yn{constructor(e,t,n){this.type=e,this.credential=t,this.auth=n}static _fromIdtoken(e,t){return new Yn("enroll",e,t)}static _fromMfaPendingCredential(e){return new Yn("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,n;if(null==e?void 0:e.multiFactorSession){if(null===(t=e.multiFactorSession)||void 0===t?void 0:t.pendingCredential)return Yn._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null===(n=e.multiFactorSession)||void 0===n?void 0:n.idToken)return Yn._fromIdtoken(e.multiFactorSession.idToken)}return null}}class Jn{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,t){const n=tn(e),r=t.customData._serverResponse,i=(r.mfaInfo||[]).map((e=>Un._fromServerResponse(n,e)));ct(r.mfaPendingCredential,n,"internal-error");const s=Yn._fromMfaPendingCredential(r.mfaPendingCredential);return new Jn(s,i,(async e=>{const i=await e._process(n,s);delete r.mfaInfo,delete r.mfaPendingCredential;const o=Object.assign(Object.assign({},r),{idToken:i.idToken,refreshToken:i.refreshToken});switch(t.operationType){case"signIn":const e=await An._fromIdTokenResponse(n,t.operationType,o);return await n._updateCurrentUser(e.user),e;case"reauthenticate":return ct(t.user,n,"internal-error"),An._forOperation(t.user,t.operationType,o);default:rt(n,"internal-error")}}))}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}class Zn{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload((t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map((t=>Un._fromServerResponse(e.auth,t))))}))}static _fromUser(e){return new Zn(e)}async getSession(){return Yn._fromIdtoken(await this.user.getIdToken(),this.user.auth)}async enroll(e,t){const n=e,r=await this.getSession(),i=await xt(this.user,n._process(this.user.auth,r,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t="string"==typeof e?e:e.uid,n=await this.user.getIdToken();try{const e=await xt(this.user,(r=this.user.auth,i={idToken:n,mfaEnrollmentId:t},_t(r,"POST","/v2/accounts/mfaEnrollment:withdraw",bt(r,i))));this.enrolledFactors=this.enrolledFactors.filter((({uid:e})=>e!==t)),await this.user._updateTokensIfNecessary(e),await this.user.reload()}catch(e){throw e}var r,i}}const er=new WeakMap,tr="__sak";class nr{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(tr,"1"),this.storage.removeItem(tr),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class rr extends nr{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=h();return Gt(e)||Xt(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=Yt(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const r=this.storage.getItem(n);if(e.newValue!==r)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},i=this.storage.getItem(n);m()&&10===document.documentMode&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}rr.type="LOCAL";const ir=rr;class sr extends nr{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}sr.type="SESSION";const or=sr;class ar{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new ar(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,s=this.handlersMap[r];if(!(null==s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(s).map((async e=>e(t.origin,i))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function cr(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}ar.receivers=[];class ur{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const r="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,s;return new Promise(((o,a)=>{const c=cr("",20);r.port1.start();const u=setTimeout((()=>{a(new Error("unsupported_event"))}),n);s={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),i=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(i),o(t.data.response);break;default:clearTimeout(u),clearTimeout(i),a(new Error("invalid_response"))}}},this.handlers.add(s),r.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])})).finally((()=>{s&&this.removeMessageHandler(s)}))}}function lr(){return window}function hr(){return void 0!==lr().WorkerGlobalScope&&"function"==typeof lr().importScripts}const dr="firebaseLocalStorageDb",fr=1,pr="firebaseLocalStorage",mr="fbase_key";class gr{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function yr(e,t){return e.transaction([pr],t?"readwrite":"readonly").objectStore(pr)}function vr(){const e=indexedDB.open(dr,fr);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(pr,{keyPath:mr})}catch(e){n(e)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(pr)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(dr);return new gr(e).toPromise()}(),t(await vr()))}))}))}async function wr(e,t,n){const r=yr(e,!0).put({[mr]:t,value:n});return new gr(r).toPromise()}function Ir(e,t){const n=yr(e,!0).delete(t);return new gr(n).toPromise()}class br{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await vr()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return hr()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ar._getInstance(hr()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new ur(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&function(){var e;return(null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await vr();return await wr(e,tr,"1"),await Ir(e,tr),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>wr(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=yr(e,!1).get(t),r=await new gr(n).toPromise();return void 0===r?null:r.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>Ir(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=yr(e,!1).getAll();return new gr(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}br.type="LOCAL";const _r=br;function Tr(e){return new Promise(((t,n)=>{const r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=it("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}().appendChild(r)}))}function Er(e){return`__${e}${Math.floor(1e6*Math.random())}`}const Sr=1e12;class kr{constructor(e){this.auth=e,this.counter=Sr,this._widgets=new Map}render(e,t){const n=this.counter;return this._widgets.set(n,new Ar(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t;const n=e||Sr;null===(t=this._widgets.get(n))||void 0===t||t.delete(),this._widgets.delete(n)}getResponse(e){var t;const n=e||Sr;return(null===(t=this._widgets.get(n))||void 0===t?void 0:t.getResponse())||""}async execute(e){var t;const n=e||Sr;return null===(t=this._widgets.get(n))||void 0===t||t.execute(),""}}class Ar{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const r="string"==typeof e?document.getElementById(e):e;ct(r,"argument-error",{appName:t}),this.container=r,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout((()=>{this.responseToken=function(e){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let e=0;e<50;e++)t.push(n.charAt(Math.floor(Math.random()*n.length)));return t.join("")}();const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(e){}this.timerId=window.setTimeout((()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(e){}this.isVisible&&this.execute()}),6e4)}),500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const Cr=Er("rcb"),Nr=new gt(3e4,6e4);class Dr{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(null===(e=lr().grecaptcha)||void 0===e?void 0:e.render)}load(e,t=""){return ct(function(e){return e.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e)}(t),e,"argument-error"),this.shouldResolveImmediately(t)?Promise.resolve(lr().grecaptcha):new Promise(((n,r)=>{const i=lr().setTimeout((()=>{r(it(e,"network-request-failed"))}),Nr.get());lr()[Cr]=()=>{lr().clearTimeout(i),delete lr()[Cr];const s=lr().grecaptcha;if(!s)return void r(it(e,"internal-error"));const o=s.render;s.render=(e,t)=>{const n=o(e,t);return this.counter++,n},this.hostLanguage=t,n(s)},Tr(`https://www.google.com/recaptcha/api.js??${T({onload:Cr,render:"explicit",hl:t})}`).catch((()=>{clearTimeout(i),r(it(e,"internal-error"))}))}))}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(null===(t=lr().grecaptcha)||void 0===t?void 0:t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class xr{async load(e){return new kr(e)}clearedOneInstance(){}}const Rr="recaptcha",Or={theme:"light",type:"image"};class Pr{constructor(e,t=Object.assign({},Or),n){this.parameters=t,this.type=Rr,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=tn(n),this.isInvisible="invisible"===this.parameters.size,ct("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");const r="string"==typeof e?document.getElementById(e):e;ct(r,this.auth,"argument-error"),this.container=r,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new xr:new Dr,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha();return t.getResponse(e)||new Promise((n=>{const r=e=>{e&&(this.tokenChangeListeners.delete(r),n(e))};this.tokenChangeListeners.add(r),this.isInvisible&&t.execute(e)}))}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch((e=>{throw this.renderPromise=null,e}))),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach((e=>{this.container.removeChild(e)}))}validateStartingState(){ct(!this.parameters.sitekey,this.auth,"argument-error"),ct(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),ct("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach((e=>e(t))),"function"==typeof e)e(t);else if("string"==typeof e){const n=lr()[e];"function"==typeof n&&n(t)}}}assertNotDestroyed(){ct(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){ct(pt()&&!hr(),this.auth,"internal-error"),await function(){let e=null;return new Promise((t=>{"complete"!==document.readyState?(e=()=>t(),window.addEventListener("load",e)):t()})).catch((t=>{throw e&&window.removeEventListener("load",e),t}))}(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await async function(e){return(await _t(e,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}(this.auth);ct(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return ct(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class Lr{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=pn._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function Mr(e,t,n){var r;const i=await n.verify();try{let s;if(ct("string"==typeof i,e,"argument-error"),ct(n.type===Rr,e,"argument-error"),s="string"==typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s){ct("enroll"===t.type,e,"internal-error");const n=await function(e,t){return _t(e,"POST","/v2/accounts/mfaEnrollment:start",bt(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:i}});return n.phoneSessionInfo.sessionInfo}{ct("signin"===t.type,e,"internal-error");const n=(null===(r=s.multiFactorHint)||void 0===r?void 0:r.uid)||s.multiFactorUid;ct(n,e,"missing-multi-factor-info");const o=await function(e,t){return _t(e,"POST","/v2/accounts/mfaSignIn:start",bt(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:i}});return o.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return _t(e,"POST","/v1/accounts:sendVerificationCode",bt(e,t))}(e,{phoneNumber:s.phoneNumber,recaptchaToken:i});return t}}finally{n._reset()}}class Fr{constructor(e){this.providerId=Fr.PROVIDER_ID,this.auth=tn(e)}verifyPhoneNumber(e,t){return Mr(this.auth,e,N(t))}static credential(e,t){return pn._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Fr.credentialFromTaggedObject(t)}static credentialFromError(e){return Fr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?pn._fromTokenResponse(t,n):null}}function Vr(e,t){return t?dt(t):(ct(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Fr.PROVIDER_ID="phone",Fr.PHONE_SIGN_IN_METHOD="phone";class Ur extends on{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return hn(e,this._buildIdpRequest())}_linkToIdToken(e,t){return hn(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return hn(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function qr(e){return Ln(e.auth,new Ur(e),e.bypassAuthState)}function Br(e){const{auth:t,user:n}=e;return ct(n,t,"internal-error"),Pn(n,new Ur(e),e.bypassAuthState)}async function jr(e){const{auth:t,user:n}=e;return ct(n,t,"internal-error"),Rn(n,new Ur(e),e.bypassAuthState)}class Kr{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:o}=e;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return qr;case"linkViaPopup":case"linkViaRedirect":return jr;case"reauthViaPopup":case"reauthViaRedirect":return Br;default:rt(this.auth,"internal-error")}}resolve(e){lt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){lt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Gr=new gt(2e3,1e4);class zr extends Kr{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,zr.currentPopupAction&&zr.currentPopupAction.cancel(),zr.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ct(e,this.auth,"internal-error"),e}async onExecution(){lt(1===this.filter.length,"Popup operations only handle one event");const e=cr();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(it(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(it(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,zr.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(it(this.auth,"popup-closed-by-user"))}),2e3):this.pollId=window.setTimeout(e,Gr.get())};e()}}zr.currentPopupAction=null;const $r="pendingRedirect",Wr=new Map;class Hr extends Kr{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=Wr.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=Jr(t),r=Yr(e);if(!await r._isAvailable())return!1;const i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}Wr.set(this.auth._key(),e)}return this.bypassAuthState||Wr.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function Qr(e,t){return Yr(e)._set(Jr(t),"true")}function Xr(e,t){Wr.set(e._key(),t)}function Yr(e){return dt(e._redirectPersistence)}function Jr(e){return qt($r,e.config.apiKey,e.name)}async function Zr(e,t,n=!1){const r=tn(e),i=Vr(r,t),s=new Hr(r,i,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}async function ei(e){const t=cr(`${e.uid}:::`);return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}class ti{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return ri(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!ri(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(it(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(ni(e))}saveEventToCache(e){this.cachedEventUids.add(ni(e)),this.lastProcessedEventTime=Date.now()}}function ni(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function ri({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}async function ii(e,t={}){return _t(e,"GET","/v1/projects",t)}const si=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,oi=/^https?/;function ai(e){const t=ft(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!oi.test(n))return!1;if(si.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const ci=new gt(3e4,6e4);function ui(){const e=lr().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}let li=null;function hi(e){return li=li||function(e){return new Promise(((t,n)=>{var r,i,s;function o(){ui(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{ui(),n(it(e,"network-request-failed"))},timeout:ci.get()})}if(null===(i=null===(r=lr().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=lr().gapi)||void 0===s?void 0:s.load)){const t=Er("iframefcb");return lr()[t]=()=>{gapi.load?o():n(it(e,"network-request-failed"))},Tr(`https://apis.google.com/js/api.js?onload=${t}`).catch((e=>n(e)))}o()}})).catch((e=>{throw li=null,e}))}(e),li}const di=new gt(5e3,15e3),fi="__/auth/iframe",pi="emulator/auth/iframe",mi={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},gi=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function yi(e){const t=e.config;ct(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?yt(t,pi):`https://${e.config.authDomain}/${fi}`,r={apiKey:t.apiKey,appName:e.name,v:Ie},i=gi.get(e.config.apiHost);i&&(r.eid=i);const s=e._getFrameworks();return s.length&&(r.fw=s.join(",")),`${n}?${T(r).slice(1)}`}const vi={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},wi=500,Ii=600,bi="_blank",_i="http://localhost";class Ti{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}const Ei="__/auth/handler",Si="emulator/auth/handler";function ki(e,t,n,r,i,s){ct(e.config.authDomain,e,"auth-domain-config-required"),ct(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:Ie,eventId:i};if(t instanceof yn){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(s||{}))o[e]=t}if(t instanceof vn){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const e of Object.keys(a))void 0===a[e]&&delete a[e];return`${function({config:e}){return e.emulator?yt(e,Si):`https://${e.authDomain}/${Ei}`}(e)}?${T(a).slice(1)}`}const Ai="webStorageSupport",Ci=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=or,this._completeRedirectFn=Zr,this._overrideRedirectResult=Xr}async _openPopup(e,t,n,r){var i;return lt(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()"),function(e,t,n,r=wi,i=Ii){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const c=Object.assign(Object.assign({},vi),{width:r.toString(),height:i.toString(),top:s,left:o}),u=h().toLowerCase();n&&(a=zt(u)?bi:n),Kt(u)&&(t=t||_i,c.scrollbars="yes");const l=Object.entries(c).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=h()){var t;return Xt(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(u)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",a),new Ti(null);const d=window.open(t||"",a,l);ct(d,e,"popup-blocked");try{d.focus()}catch(e){}return new Ti(d)}(e,ki(e,t,n,ft(),r),cr())}async _openRedirect(e,t,n,r){var i;return await this._originValidation(e),i=ki(e,t,n,ft(),r),lr().location.href=i,new Promise((()=>{}))}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(lt(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await async function(e){const t=await hi(e),n=lr().gapi;return ct(n,e,"internal-error"),t.open({where:document.body,url:yi(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:mi,dontclear:!0},(t=>new Promise((async(n,r)=>{await t.restyle({setHideOnLeave:!1});const i=it(e,"network-request-failed"),s=lr().setTimeout((()=>{r(i)}),di.get());function o(){lr().clearTimeout(s),n(t)}t.ping(o).then(o,(()=>{r(i)}))}))))}(e),n=new ti(e);return t.register("authEvent",(t=>(ct(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"})),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Ai,{type:Ai},(n=>{var r;const i=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r[Ai];void 0!==i&&t(!!i),rt(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await ii(e);for(const e of t)try{if(ai(e))return}catch(e){}rt(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Yt()||Gt()||Xt()}};class Ni{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return ut("unexpected MultiFactorSessionType")}}}class Di extends Ni{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new Di(e)}_finalizeEnroll(e,t,n){return function(e,t){return _t(e,"POST","/v2/accounts/mfaEnrollment:finalize",bt(e,t))}(e,{idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return function(e,t){return _t(e,"POST","/v2/accounts/mfaSignIn:finalize",bt(e,t))}(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class xi{constructor(){}static assertion(e){return Di._fromCredential(e)}}xi.FACTOR_ID="phone";var Ri,Oi="@firebase/auth",Pi="0.21.4";class Li{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){ct(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function Mi(){return window}(e=>{var t;null===(t=c())||void 0===t||t._authIdTokenMaxAge})(),Ri="Browser",pe(new D("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),{apiKey:i,authDomain:s}=n.options;return((e,n)=>{ct(i&&!i.includes(":"),"invalid-api-key",{appName:e.name}),ct(!(null==s?void 0:s.includes(":")),"argument-error",{appName:e.name});const r={apiKey:i,authDomain:s,clientPlatform:Ri,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Jt(Ri)},o=new en(e,n,r);return function(e,t){const n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(dt);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(o,t),o})(n,r)}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),pe(new D("auth-internal",(e=>{return t=tn(e.getProvider("auth").getImmediate()),new Li(t);var t}),"PRIVATE").setInstantiationMode("EXPLICIT")),Se(Oi,Pi,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(Ri)),Se(Oi,Pi,"esm2017");const Fi=2e3;const Vi=20;class Ui extends ti{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise((e=>{this.resolveInialized=e}))}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(e){return this.resolveInialized(),this.passiveListeners.forEach((t=>t(e))),super.onEvent(e)}async initialized(){await this.initPromise}}async function qi(e){const t=await ji()._get(Ki(e));return t&&await ji()._remove(Ki(e)),t}function Bi(){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let n=0;n<Vi;n++){const n=Math.floor(Math.random()*t.length);e.push(t.charAt(n))}return e.join("")}function ji(){return dt(ir)}function Ki(e){return qt("authEvent",e.config.apiKey,e.name)}function Gi(e){if(!(null==e?void 0:e.includes("?")))return{};const[t,...n]=e.split("?");return E(n.join("?"))}const zi=class{constructor(){this._redirectPersistence=or,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=Zr,this._overrideRedirectResult=Xr}async _initialize(e){const t=e._key();let n=this.eventManagers.get(t);return n||(n=new Ui(e),this.eventManagers.set(t,n),this.attachCallbackListeners(e,n)),n}_openPopup(e){rt(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,n,r){!function(e){var t,n,r,i,s,o,a,c,u,l;const h=Mi();ct("function"==typeof(null===(t=null==h?void 0:h.universalLinks)||void 0===t?void 0:t.subscribe),e,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),ct(void 0!==(null===(n=null==h?void 0:h.BuildInfo)||void 0===n?void 0:n.packageName),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),ct("function"==typeof(null===(s=null===(i=null===(r=null==h?void 0:h.cordova)||void 0===r?void 0:r.plugins)||void 0===i?void 0:i.browsertab)||void 0===s?void 0:s.openUrl),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),ct("function"==typeof(null===(c=null===(a=null===(o=null==h?void 0:h.cordova)||void 0===o?void 0:o.plugins)||void 0===a?void 0:a.browsertab)||void 0===c?void 0:c.isAvailable),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),ct("function"==typeof(null===(l=null===(u=null==h?void 0:h.cordova)||void 0===u?void 0:u.InAppBrowser)||void 0===l?void 0:l.open),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(e);const i=await this._initialize(e);await i.initialized(),i.resetRedirect(),Wr.clear(),await this._originValidation(e);const s=function(e,t,n=null){return{type:t,eventId:n,urlResponse:null,sessionId:Bi(),postBody:null,tenantId:e.tenantId,error:it(e,"no-auth-event")}}(e,n,r);await function(e,t){return ji()._set(Ki(e),t)}(e,s);const o=await async function(e,t,n){var r;const{BuildInfo:i}=Mi();lt(t.sessionId,"AuthEvent did not contain a session ID");const s=await async function(e){const t=function(e){if(lt(/[0-9a-zA-Z]+/.test(e),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(e);const t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let t=0;t<e.length;t++)n[t]=e.charCodeAt(t);return n}(e),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map((e=>e.toString(16).padStart(2,"0"))).join("")}(t.sessionId),o={};return Xt()?o.ibi=i.packageName:Wt()?o.apn=i.packageName:rt(e,"operation-not-supported-in-this-environment"),i.displayName&&(o.appDisplayName=i.displayName),o.sessionId=s,ki(e,n,t.type,void 0,null!==(r=t.eventId)&&void 0!==r?r:void 0,o)}(e,s,t);return async function(e,t,n){const{cordova:r}=Mi();let i=()=>{};try{await new Promise(((s,o)=>{let a=null;function c(){var e;s();const t=null===(e=r.plugins.browsertab)||void 0===e?void 0:e.close;"function"==typeof t&&t(),"function"==typeof(null==n?void 0:n.close)&&n.close()}function u(){a||(a=window.setTimeout((()=>{o(it(e,"redirect-cancelled-by-user"))}),Fi))}function l(){"visible"===(null===document||void 0===document?void 0:document.visibilityState)&&u()}t.addPassiveListener(c),document.addEventListener("resume",u,!1),Wt()&&document.addEventListener("visibilitychange",l,!1),i=()=>{t.removePassiveListener(c),document.removeEventListener("resume",u,!1),document.removeEventListener("visibilitychange",l,!1),a&&window.clearTimeout(a)}}))}finally{i()}}(e,i,await function(e){const{cordova:t}=Mi();return new Promise((n=>{t.plugins.browsertab.isAvailable((r=>{let i=null;r?t.plugins.browsertab.openUrl(e):i=t.InAppBrowser.open(e,function(e=h()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(e)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(e)}()?"_blank":"_system","location=yes"),n(i)}))}))}(o))}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){const{BuildInfo:t}=Mi(),n={};Xt()?n.iosBundleId=t.packageName:Wt()?n.androidPackageName=t.packageName:rt(e,"operation-not-supported-in-this-environment"),await ii(e,n)}(e)),this.originValidationPromises[t]}attachCallbackListeners(e,t){const{universalLinks:n,handleOpenURL:r,BuildInfo:i}=Mi(),s=setTimeout((async()=>{await qi(e),t.onEvent($i())}),500),o=async n=>{clearTimeout(s);const r=await qi(e);let i=null;r&&(null==n?void 0:n.url)&&(i=function(e,t){var n,r;const i=function(e){const t=Gi(e),n=t.link?decodeURIComponent(t.link):void 0,r=Gi(n).link,i=t.deep_link_id?decodeURIComponent(t.deep_link_id):void 0;return Gi(i).link||i||r||n||e}(t);if(i.includes("/__/auth/callback")){const t=Gi(i),s=t.firebaseError?function(e){try{return JSON.parse(e)}catch(e){return null}}(decodeURIComponent(t.firebaseError)):null,o=null===(r=null===(n=null==s?void 0:s.code)||void 0===n?void 0:n.split("auth/"))||void 0===r?void 0:r[1],a=o?it(o):null;return a?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:a,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:i,postBody:null}}return null}(r,n.url)),t.onEvent(i||$i())};void 0!==n&&"function"==typeof n.subscribe&&n.subscribe(null,o);const a=r,c=`${i.packageName.toLowerCase()}://`;Mi().handleOpenURL=async e=>{if(e.toLowerCase().startsWith(c)&&o({url:e}),"function"==typeof a)try{a(e)}catch(e){console.error(e)}}}};function $i(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:it("no-auth-event")}}function Wi(){var e;return(null===(e=null===self||void 0===self?void 0:self.location)||void 0===e?void 0:e.protocol)||null}function Hi(e=h()){return!("file:"!==Wi()&&"ionic:"!==Wi()&&"capacitor:"!==Wi()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function Qi(){try{const e=self.localStorage,t=cr();if(e)return e.setItem(t,"1"),e.removeItem(t),!function(e=h()){return m()&&11===(null===document||void 0===document?void 0:document.documentMode)||function(e=h()){return/Edge\/\d+/.test(e)}(e)}()||g()}catch(e){return Xi()&&g()}return!1}function Xi(){return void 0!==e.g&&"WorkerGlobalScope"in e.g&&"importScripts"in e.g}function Yi(){return("http:"===Wi()||"https:"===Wi()||f()||Hi())&&!(p()||d())&&Qi()&&!Xi()}function Ji(){return Hi()&&"undefined"!=typeof document}const Zi={LOCAL:"local",NONE:"none",SESSION:"session"},es=ct,ts="persistence";async function ns(e){await e._initializationPromise;const t=rs(),n=qt(ts,e.config.apiKey,e.name);t&&t.setItem(n,e._getPersistence())}function rs(){var e;try{return(null===(e="undefined"!=typeof window?window:null)||void 0===e?void 0:e.sessionStorage)||null}catch(e){return null}}const is=ct;class ss{constructor(){this.browserResolver=dt(Ci),this.cordovaResolver=dt(zi),this.underlyingResolver=null,this._redirectPersistence=or,this._completeRedirectFn=Zr,this._overrideRedirectResult=Xr}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,n,r)}async _openRedirect(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,n,r)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return Ji()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return is(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){if(this.underlyingResolver)return;const e=await async function(){return!!Ji()&&new Promise((e=>{const t=setTimeout((()=>{e(!1)}),1e3);document.addEventListener("deviceready",(()=>{clearTimeout(t),e(!0)}))}))}();this.underlyingResolver=e?this.cordovaResolver:this.browserResolver}}function os(e){return e.unwrap()}function as(e){const{_tokenResponse:t}=e instanceof y?e.customData:e;if(!t)return null;if(!(e instanceof y)&&"temporaryProof"in t&&"phoneNumber"in t)return Fr.credentialFromResult(e);const n=t.providerId;if(!n||n===ze.PASSWORD)return null;let r;switch(n){case ze.GOOGLE:r=bn;break;case ze.FACEBOOK:r=In;break;case ze.GITHUB:r=_n;break;case ze.TWITTER:r=Sn;break;default:const{oauthIdToken:e,oauthAccessToken:i,oauthTokenSecret:s,pendingToken:o,nonce:a}=t;return i||s||e||o?o?n.startsWith("saml.")?Tn._create(n,o):dn._fromParams({providerId:n,signInMethod:n,pendingToken:o,idToken:e,accessToken:i}):new wn(n).credential({idToken:e,accessToken:i,rawNonce:a}):null}return e instanceof y?r.credentialFromError(e):r.credentialFromResult(e)}function cs(e,t){return t.catch((t=>{throw t instanceof y&&function(e,t){var n;const r=null===(n=t.customData)||void 0===n?void 0:n._tokenResponse;if("auth/multi-factor-auth-required"===(null==t?void 0:t.code))t.resolver=new ls(e,function(e,t){var n;const r=N(e),i=t;return ct(t.customData.operationType,r,"argument-error"),ct(null===(n=i.customData._serverResponse)||void 0===n?void 0:n.mfaPendingCredential,r,"argument-error"),Jn._fromError(r,i)}(e,t));else if(r){const e=as(t),n=t;e&&(n.credential=e,n.tenantId=r.tenantId||void 0,n.email=r.email||void 0,n.phoneNumber=r.phoneNumber||void 0)}}(e,t),t})).then((e=>{const t=e.operationType,n=e.user;return{operationType:t,credential:(r=e,as(r)),additionalUserInfo:Xn(e),user:hs.getOrCreate(n)};var r}))}async function us(e,t){const n=await t;return{verificationId:n.verificationId,confirm:t=>cs(e,n.confirm(t))}}class ls{constructor(e,t){this.resolver=t,this.auth=e.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return cs(os(this.auth),this.resolver.resolveSignIn(e))}}class hs{constructor(e){this._delegate=e,this.multiFactor=function(e){const t=N(e);return er.has(t)||er.set(t,Zn._fromUser(t)),er.get(t)}(e)}static getOrCreate(e){return hs.USER_MAP.has(e)||hs.USER_MAP.set(e,new hs(e)),hs.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return cs(this.auth,Fn(this._delegate,e))}async linkWithPhoneNumber(e,t){return us(this.auth,async function(e,t,n){const r=N(e);await On(!1,r,"phone");const i=await Mr(r.auth,t,N(n));return new Lr(i,(e=>Fn(r,e)))}(this._delegate,e,t))}async linkWithPopup(e){return cs(this.auth,async function(e,t,n){const r=N(e);ot(r.auth,t,yn);const i=Vr(r.auth,n);return new zr(r.auth,"linkViaPopup",t,i,r).executeNotNull()}(this._delegate,e,ss))}async linkWithRedirect(e){return await ns(tn(this.auth)),function(e,t,n){return async function(e,t,n){const r=N(e);ot(r.auth,t,yn),await r.auth._initializationPromise;const i=Vr(r.auth,n);await On(!1,r,t.providerId),await Qr(i,r.auth);const s=await ei(r);return i._openRedirect(r.auth,t,"linkViaRedirect",s)}(e,t,n)}(this._delegate,e,ss)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return cs(this.auth,Vn(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return us(this.auth,async function(e,t,n){const r=N(e),i=await Mr(r.auth,t,N(n));return new Lr(i,(e=>Vn(r,e)))}(this._delegate,e,t))}reauthenticateWithPopup(e){return cs(this.auth,async function(e,t,n){const r=N(e);ot(r.auth,t,yn);const i=Vr(r.auth,n);return new zr(r.auth,"reauthViaPopup",t,i,r).executeNotNull()}(this._delegate,e,ss))}async reauthenticateWithRedirect(e){return await ns(tn(this.auth)),function(e,t,n){return async function(e,t,n){const r=N(e);ot(r.auth,t,yn),await r.auth._initializationPromise;const i=Vr(r.auth,n);await Qr(i,r.auth);const s=await ei(r);return i._openRedirect(r.auth,t,"reauthViaRedirect",s)}(e,t,n)}(this._delegate,e,ss)}sendEmailVerification(e){return async function(e,t){const n=N(e),r={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&Bn(n.auth,r,t);const{email:i}=await async function(e,t){return un(e,t)}(n.auth,r);i!==e.email&&await e.reload()}(this._delegate,e)}async unlink(e){return await async function(e,t){const n=N(e);await On(!0,n,t);const{providerUserInfo:r}=await async function(e,t){return _t(e,"POST","/v1/accounts:update",t)}(n.auth,{idToken:await n.getIdToken(),deleteProvider:[t]}),i=xn(r||[]);return n.providerData=n.providerData.filter((e=>i.has(e.providerId))),i.has("phone")||(n.phoneNumber=null),await n.auth._persistUserIfCurrent(n),n}(this._delegate,e),this}updateEmail(e){return function(e,t){return Kn(N(e),t,null)}(this._delegate,e)}updatePassword(e){return function(e,t){return Kn(N(e),null,t)}(this._delegate,e)}updatePhoneNumber(e){return async function(e,t){await Rn(N(e),t)}(this._delegate,e)}updateProfile(e){return async function(e,{displayName:t,photoURL:n}){if(void 0===t&&void 0===n)return;const r=N(e),i={idToken:await r.getIdToken(),displayName:t,photoUrl:n,returnSecureToken:!0},s=await xt(r,async function(e,t){return _t(e,"POST","/v1/accounts:update",t)}(r.auth,i));r.displayName=s.displayName||null,r.photoURL=s.photoUrl||null;const o=r.providerData.find((({providerId:e})=>"password"===e));o&&(o.displayName=r.displayName,o.photoURL=r.photoURL),await r._updateTokensIfNecessary(s)}(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return async function(e,t,n){const r=N(e),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await e.getIdToken(),newEmail:t};n&&Bn(r.auth,i,n);const{email:s}=await async function(e,t){return un(e,t)}(r.auth,i);s!==e.email&&await e.reload()}(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}hs.USER_MAP=new WeakMap;const ds=ct;class fs{constructor(e,t){if(this.app=e,t.isInitialized())return this._delegate=t.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:n}=e.options;ds(n,"invalid-api-key",{appName:e.name}),ds(n,"invalid-api-key",{appName:e.name});const r="undefined"!=typeof window?ss:void 0;this._delegate=t.initialize({options:{persistence:ms(n,e.name),popupRedirectResolver:r}}),this._delegate._updateErrorMap(Je),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?hs.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){!function(e,t,n){const r=tn(e);ct(r._canInitEmulator,r,"emulator-config-failed"),ct(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!!(null==n?void 0:n.disableWarnings),s=rn(t),{host:o,port:a}=function(e){const t=rn(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:sn(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:sn(t)}}}(t),c=null===a?"":`:${a}`;r.config.emulator={url:`${s}//${o}${c}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(this._delegate,e,t)}applyActionCode(e){return async function(e,t){await async function(e,t){return _t(e,"POST","/v1/accounts:update",bt(e,t))}(N(e),{oobCode:t})}(this._delegate,e)}checkActionCode(e){return jn(this._delegate,e)}confirmPasswordReset(e,t){return async function(e,t,n){await an(N(e),{oobCode:t,newPassword:n})}(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return cs(this._delegate,async function(e,t,n){const r=tn(e),i=await kn(r,{returnSecureToken:!0,email:t,password:n}),s=await An._fromIdTokenResponse(r,"signIn",i);return await r._updateCurrentUser(s.user),s}(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return async function(e,t){const n={identifier:t,continueUri:pt()?ft():"http://localhost"},{signinMethods:r}=await async function(e,t){return _t(e,"POST","/v1/accounts:createAuthUri",bt(e,t))}(N(e),n);return r||[]}(this._delegate,e)}isSignInWithEmailLink(e){return function(e,t){const n=mn.parseLink(t);return"EMAIL_SIGNIN"===(null==n?void 0:n.operation)}(this._delegate,e)}async getRedirectResult(){ds(Yi(),this._delegate,"operation-not-supported-in-this-environment");const e=await async function(e,t){return await tn(e)._initializationPromise,Zr(e,t,!1)}(this._delegate,ss);return e?cs(this._delegate,Promise.resolve(e)):{credential:null,user:null}}addFrameworkForLogging(e){!function(e,t){tn(e)._logFramework(t)}(this._delegate,e)}onAuthStateChanged(e,t,n){const{next:r,error:i,complete:s}=ps(e,t,n);return this._delegate.onAuthStateChanged(r,i,s)}onIdTokenChanged(e,t,n){const{next:r,error:i,complete:s}=ps(e,t,n);return this._delegate.onIdTokenChanged(r,i,s)}sendSignInLinkToEmail(e,t){return async function(e,t,n){const r=N(e),i={requestType:"EMAIL_SIGNIN",email:t};ct(n.handleCodeInApp,r,"argument-error"),n&&Bn(r,i,n),await async function(e,t){return un(e,t)}(r,i)}(this._delegate,e,t)}sendPasswordResetEmail(e,t){return async function(e,t,n){const r=N(e),i={requestType:"PASSWORD_RESET",email:t};n&&Bn(r,i,n),await async function(e,t){return un(e,t)}(r,i)}(this._delegate,e,t||void 0)}async setPersistence(e){let t;switch(function(e,t){es(Object.values(Zi).includes(t),e,"invalid-persistence-type"),p()?es(t!==Zi.SESSION,e,"unsupported-persistence-type"):d()?es(t===Zi.NONE,e,"unsupported-persistence-type"):Xi()?es(t===Zi.NONE||t===Zi.LOCAL&&g(),e,"unsupported-persistence-type"):es(t===Zi.NONE||Qi(),e,"unsupported-persistence-type")}(this._delegate,e),e){case Zi.SESSION:t=or;break;case Zi.LOCAL:t=await dt(_r)._isAvailable()?_r:ir;break;case Zi.NONE:t=Ut;break;default:return rt("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(t)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return cs(this._delegate,async function(e){var t;const n=tn(e);if(await n._initializationPromise,null===(t=n.currentUser)||void 0===t?void 0:t.isAnonymous)return new An({user:n.currentUser,providerId:null,operationType:"signIn"});const r=await kn(n,{returnSecureToken:!0}),i=await An._fromIdTokenResponse(n,"signIn",r,!0);return await n._updateCurrentUser(i.user),i}(this._delegate))}signInWithCredential(e){return cs(this._delegate,Mn(this._delegate,e))}signInWithCustomToken(e){return cs(this._delegate,async function(e,t){const n=tn(e),r=await async function(e,t){return Et(e,"POST","/v1/accounts:signInWithCustomToken",bt(e,t))}(n,{token:t,returnSecureToken:!0}),i=await An._fromIdTokenResponse(n,"signIn",r);return await n._updateCurrentUser(i.user),i}(this._delegate,e))}signInWithEmailAndPassword(e,t){return cs(this._delegate,function(e,t,n){return Mn(N(e),gn.credential(t,n))}(this._delegate,e,t))}signInWithEmailLink(e,t){return cs(this._delegate,async function(e,t,n){const r=N(e),i=gn.credentialWithLink(t,n||ft());return ct(i._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),Mn(r,i)}(this._delegate,e,t))}signInWithPhoneNumber(e,t){return us(this._delegate,async function(e,t,n){const r=tn(e),i=await Mr(r,t,N(n));return new Lr(i,(e=>Mn(r,e)))}(this._delegate,e,t))}async signInWithPopup(e){return ds(Yi(),this._delegate,"operation-not-supported-in-this-environment"),cs(this._delegate,async function(e,t,n){const r=tn(e);ot(e,t,yn);const i=Vr(r,n);return new zr(r,"signInViaPopup",t,i).executeNotNull()}(this._delegate,e,ss))}async signInWithRedirect(e){return ds(Yi(),this._delegate,"operation-not-supported-in-this-environment"),await ns(this._delegate),function(e,t,n){return async function(e,t,n){const r=tn(e);ot(e,t,yn),await r._initializationPromise;const i=Vr(r,n);return await Qr(i,r),i._openRedirect(r,t,"signInViaRedirect")}(e,t,n)}(this._delegate,e,ss)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return async function(e,t){const{data:n}=await jn(N(e),t);return n.email}(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}function ps(e,t,n){let r=e;"function"!=typeof e&&({next:r,error:t,complete:n}=e);const i=r;return{next:e=>i(e&&hs.getOrCreate(e)),error:t,complete:n}}function ms(e,t){const n=function(e,t){const n=rs();if(!n)return[];const r=qt(ts,e,t);switch(n.getItem(r)){case Zi.NONE:return[Ut];case Zi.LOCAL:return[_r,or];case Zi.SESSION:return[or];default:return[]}}(e,t);if("undefined"==typeof self||n.includes(_r)||n.push(_r),"undefined"!=typeof window)for(const e of[ir,or])n.includes(e)||n.push(e);return n.includes(Ut)||n.push(Ut),n}fs.Persistence=Zi;class gs{constructor(){this.providerId="phone",this._delegate=new Fr(os(Ke.auth()))}static credential(e,t){return Fr.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}gs.PHONE_SIGN_IN_METHOD=Fr.PHONE_SIGN_IN_METHOD,gs.PROVIDER_ID=Fr.PROVIDER_ID;const ys=ct;var vs;(vs=Ke).INTERNAL.registerComponent(new D("auth-compat",(e=>{const t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("auth");return new fs(t,n)}),"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:$e,PASSWORD_RESET:We,RECOVER_EMAIL:He,REVERT_SECOND_FACTOR_ADDITION:Qe,VERIFY_AND_CHANGE_EMAIL:Xe,VERIFY_EMAIL:Ye}},EmailAuthProvider:gn,FacebookAuthProvider:In,GithubAuthProvider:_n,GoogleAuthProvider:bn,OAuthProvider:wn,SAMLAuthProvider:En,PhoneAuthProvider:gs,PhoneMultiFactorGenerator:xi,RecaptchaVerifier:class{constructor(e,t,n=Ke.app()){var r;ys(null===(r=n.options)||void 0===r?void 0:r.apiKey,"invalid-api-key",{appName:n.name}),this._delegate=new Pr(e,t,n.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}},TwitterAuthProvider:Sn,Auth:fs,AuthCredential:on,Error:y}).setInstantiationMode("LAZY").setMultipleInstances(!1)),vs.registerVersion("@firebase/auth-compat","0.3.4");var ws,Is="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==e.g?e.g:"undefined"!=typeof self?self:{},bs={},_s=_s||{},Ts=Is||self;function Es(){}function Ss(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function ks(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var As="closure_uid_"+(1e9*Math.random()>>>0),Cs=0;function Ns(e,t,n){return e.call.apply(e.bind,arguments)}function Ds(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function xs(e,t,n){return(xs=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Ns:Ds).apply(null,arguments)}function Rs(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function Os(e,t){function n(){}n.prototype=t.prototype,e.X=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Wb=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function Ps(){this.s=this.s,this.o=this.o}Ps.prototype.s=!1,Ps.prototype.na=function(){var e;!this.s&&(this.s=!0,this.M(),0)&&(e=this,Object.prototype.hasOwnProperty.call(e,As)&&e[As]||(e[As]=++Cs))},Ps.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Ls=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function Ms(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function Fs(e,t){for(let t=1;t<arguments.length;t++){const n=arguments[t];if(Ss(n)){const t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}function Vs(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}Vs.prototype.h=function(){this.defaultPrevented=!0};var Us=function(){if(!Ts.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{Ts.addEventListener("test",Es,t),Ts.removeEventListener("test",Es,t)}catch(e){}return e}();function qs(e){return/^[\s\xa0]*$/.test(e)}var Bs=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function js(e,t){return e<t?-1:e>t?1:0}function Ks(){var e=Ts.navigator;return e&&(e=e.userAgent)?e:""}function Gs(e){return-1!=Ks().indexOf(e)}function zs(e){return zs[" "](e),e}zs[" "]=Es;var $s,Ws,Hs=Gs("Opera"),Qs=Gs("Trident")||Gs("MSIE"),Xs=Gs("Edge"),Ys=Xs||Qs,Js=Gs("Gecko")&&!(-1!=Ks().toLowerCase().indexOf("webkit")&&!Gs("Edge"))&&!(Gs("Trident")||Gs("MSIE"))&&!Gs("Edge"),Zs=-1!=Ks().toLowerCase().indexOf("webkit")&&!Gs("Edge");function eo(){var e=Ts.document;return e?e.documentMode:void 0}e:{var to="",no=(Ws=Ks(),Js?/rv:([^\);]+)(\)|;)/.exec(Ws):Xs?/Edge\/([\d\.]+)/.exec(Ws):Qs?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Ws):Zs?/WebKit\/(\S+)/.exec(Ws):Hs?/(?:Version)[ \/]?(\S+)/.exec(Ws):void 0);if(no&&(to=no?no[1]:""),Qs){var ro=eo();if(null!=ro&&ro>parseFloat(to)){$s=String(ro);break e}}$s=to}var io,so={};function oo(){return function(e){var t=so;return Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=function(){let e=0;const t=Bs(String($s)).split("."),n=Bs("9").split("."),r=Math.max(t.length,n.length);for(let o=0;0==e&&o<r;o++){var i=t[o]||"",s=n[o]||"";do{if(i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==i[0].length&&0==s[0].length)break;e=js(0==i[1].length?0:parseInt(i[1],10),0==s[1].length?0:parseInt(s[1],10))||js(0==i[2].length,0==s[2].length)||js(i[2],s[2]),i=i[3],s=s[3]}while(0==e)}return 0<=e}()}()}Ts.document&&Qs?io=eo()||parseInt($s,10)||void 0:io=void 0;var ao=io;function co(e,t){if(Vs.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(Js){e:{try{zs(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:uo[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&co.X.h.call(this)}}Os(co,Vs);var uo={2:"touch",3:"pen",4:"mouse"};co.prototype.h=function(){co.X.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var lo="closure_listenable_"+(1e6*Math.random()|0),ho=0;function fo(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++ho,this.ba=this.ea=!1}function po(e){e.ba=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function mo(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function go(e){const t={};for(const n in e)t[n]=e[n];return t}const yo="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function vo(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t],r)e[n]=r[n];for(let t=0;t<yo.length;t++)n=yo[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function wo(e){this.src=e,this.g={},this.h=0}function Io(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=Ls(i,t);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(po(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function bo(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.ba&&s.listener==t&&s.capture==!!n&&s.ha==r)return i}return-1}wo.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=bo(e,t,r,i);return-1<o?(t=e[o],n||(t.ea=!1)):((t=new fo(t,this.src,s,!!r,i)).ea=n,e.push(t)),t};var _o="closure_lm_"+(1e6*Math.random()|0),To={};function Eo(e,t,n,r,i){if(r&&r.once)return ko(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)Eo(e,t[s],n,r,i);return null}return n=Oo(n),e&&e[lo]?e.N(t,n,ks(r)?!!r.capture:!!r,i):So(e,t,n,!1,r,i)}function So(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o=ks(i)?!!i.capture:!!i,a=xo(e);if(a||(e[_o]=a=new wo(e)),(n=a.add(t,n,r,o,s)).proxy)return n;if(r=function(){const e=Do;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)Us||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(No(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function ko(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)ko(e,t[s],n,r,i);return null}return n=Oo(n),e&&e[lo]?e.O(t,n,ks(r)?!!r.capture:!!r,i):So(e,t,n,!0,r,i)}function Ao(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)Ao(e,t[s],n,r,i);else r=ks(r)?!!r.capture:!!r,n=Oo(n),e&&e[lo]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=bo(s=e.g[t],n,r,i))&&(po(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--))):e&&(e=xo(e))&&(t=e.g[t.toString()],e=-1,t&&(e=bo(t,n,r,i)),(n=-1<e?t[e]:null)&&Co(n))}function Co(e){if("number"!=typeof e&&e&&!e.ba){var t=e.src;if(t&&t[lo])Io(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(No(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=xo(t))?(Io(n,e),0==n.h&&(n.src=null,t[_o]=null)):po(e)}}}function No(e){return e in To?To[e]:To[e]="on"+e}function Do(e,t){if(e.ba)e=!0;else{t=new co(t,this);var n=e.listener,r=e.ha||e.src;e.ea&&Co(e),e=n.call(r,t)}return e}function xo(e){return(e=e[_o])instanceof wo?e:null}var Ro="__closure_events_fn_"+(1e9*Math.random()>>>0);function Oo(e){return"function"==typeof e?e:(e[Ro]||(e[Ro]=function(t){return e.handleEvent(t)}),e[Ro])}function Po(){Ps.call(this),this.i=new wo(this),this.P=this,this.I=null}function Lo(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"==typeof t)t=new Vs(t,e);else if(t instanceof Vs)t.target=t.target||e;else{var i=t;vo(t=new Vs(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=Mo(o,r,!0,t)&&i}if(i=Mo(o=t.g=e,r,!0,t)&&i,i=Mo(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=Mo(o=t.g=n[s],r,!1,t)&&i}function Mo(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.ba&&o.capture==n){var a=o.listener,c=o.ha||o.src;o.ea&&Io(e.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}Os(Po,Ps),Po.prototype[lo]=!0,Po.prototype.removeEventListener=function(e,t,n,r){Ao(this,e,t,n,r)},Po.prototype.M=function(){if(Po.X.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)po(n[r]);delete t.g[e],t.h--}}this.I=null},Po.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},Po.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var Fo=Ts.JSON.stringify;function Vo(){var e=zo;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var Uo,qo=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new Bo),(e=>e.reset()));class Bo{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function jo(e){Ts.setTimeout((()=>{throw e}),0)}function Ko(e,t){Uo||function(){var e=Ts.Promise.resolve(void 0);Uo=function(){e.then($o)}}(),Go||(Uo(),Go=!0),zo.add(e,t)}var Go=!1,zo=new class{constructor(){this.h=this.g=null}add(e,t){const n=qo.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function $o(){for(var e;e=Vo();){try{e.h.call(e.g)}catch(e){jo(e)}var t=qo;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}Go=!1}function Wo(e,t){Po.call(this),this.h=e||1,this.g=t||Ts,this.j=xs(this.lb,this),this.l=Date.now()}function Ho(e){e.ca=!1,e.R&&(e.g.clearTimeout(e.R),e.R=null)}function Qo(e,t,n){if("function"==typeof e)n&&(e=xs(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=xs(e.handleEvent,e)}return 2147483647<Number(t)?-1:Ts.setTimeout(e,t||0)}function Xo(e){e.g=Qo((()=>{e.g=null,e.i&&(e.i=!1,Xo(e))}),e.j);const t=e.h;e.h=null,e.m.apply(null,t)}Os(Wo,Po),(ws=Wo.prototype).ca=!1,ws.R=null,ws.lb=function(){if(this.ca){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-e):(this.R&&(this.g.clearTimeout(this.R),this.R=null),Lo(this,"tick"),this.ca&&(Ho(this),this.start()))}},ws.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())},ws.M=function(){Wo.X.M.call(this),Ho(this),delete this.g};class Yo extends Ps{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Xo(this)}M(){super.M(),this.g&&(Ts.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Jo(e){Ps.call(this),this.h=e,this.g={}}Os(Jo,Ps);var Zo=[];function ea(e,t,n,r){Array.isArray(n)||(n&&(Zo[0]=n.toString()),n=Zo);for(var i=0;i<n.length;i++){var s=Eo(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function ta(e){mo(e.g,(function(e,t){this.g.hasOwnProperty(t)&&Co(e)}),e),e.g={}}function na(){this.g=!0}function ra(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return Fo(n)}catch(e){return t}}(e,n)+(r?" "+r:"")}))}Jo.prototype.M=function(){Jo.X.M.call(this),ta(this)},Jo.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},na.prototype.Aa=function(){this.g=!1},na.prototype.info=function(){};var ia={},sa=null;function oa(){return sa=sa||new Po}function aa(e){Vs.call(this,ia.Pa,e)}function ca(e){const t=oa();Lo(t,new aa(t))}function ua(e,t){Vs.call(this,ia.STAT_EVENT,e),this.stat=t}function la(e){const t=oa();Lo(t,new ua(t,e))}function ha(e,t){Vs.call(this,ia.Qa,e),this.size=t}function da(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return Ts.setTimeout((function(){e()}),t)}ia.Pa="serverreachability",Os(aa,Vs),ia.STAT_EVENT="statevent",Os(ua,Vs),ia.Qa="timingevent",Os(ha,Vs);var fa={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},pa={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function ma(){}function ga(e){return e.h||(e.h=e.i())}function ya(){}ma.prototype.h=null;var va,wa={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function Ia(){Vs.call(this,"d")}function ba(){Vs.call(this,"c")}function _a(){}function Ta(e,t,n,r){this.l=e,this.j=t,this.m=n,this.U=r||1,this.S=new Jo(this),this.O=Sa,e=Ys?125:void 0,this.T=new Wo(e),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new Ea}function Ea(){this.i=null,this.g="",this.h=!1}Os(Ia,Vs),Os(ba,Vs),Os(_a,ma),_a.prototype.g=function(){return new XMLHttpRequest},_a.prototype.i=function(){return{}},va=new _a;var Sa=45e3,ka={},Aa={};function Ca(e,t,n){e.K=1,e.v=Wa(ja(t)),e.s=n,e.P=!0,Na(e,null)}function Na(e,t){e.F=Date.now(),Oa(e),e.A=ja(e.v);var n=e.A,r=e.U;Array.isArray(r)||(r=[String(r)]),oc(n.i,"t",r),e.C=0,n=e.l.H,e.h=new Ea,e.g=su(e.l,n?t:null,!e.s),0<e.N&&(e.L=new Yo(xs(e.La,e,e.g),e.N)),ea(e.S,e.g,"readystatechange",e.ib),t=e.H?go(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.da(e.A,e.u,e.s,t)):(e.u="GET",e.g.da(e.A,e.u,null,t)),ca(),function(e,t,n,r,i,s){e.info((function(){if(e.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+u+"&":o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o}))}(e.j,e.u,e.A,e.m,e.U,e.s)}function Da(e){return!!e.g&&"GET"==e.u&&2!=e.K&&e.l.Da}function xa(e,t,n){let r,i=!0;for(;!e.I&&e.C<n.length;){if(r=Ra(e,n),r==Aa){4==t&&(e.o=4,la(14),i=!1),ra(e.j,e.m,null,"[Incomplete Response]");break}if(r==ka){e.o=4,la(15),ra(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}ra(e.j,e.m,r,null),Va(e,r)}Da(e)&&r!=Aa&&r!=ka&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,la(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.$&&(e.$=!0,(t=e.l).g==e&&t.$&&!t.K&&(t.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),Yc(t),t.K=!0,la(11))):(ra(e.j,e.m,n,"[Invalid Chunked Response]"),Fa(e),Ma(e))}function Ra(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?Aa:(n=Number(t.substring(n,r)),isNaN(n)?ka:(r+=1)+n>t.length?Aa:(t=t.substr(r,n),e.C=r+n,t))}function Oa(e){e.V=Date.now()+e.O,Pa(e,e.O)}function Pa(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=da(xs(e.gb,e),t)}function La(e){e.B&&(Ts.clearTimeout(e.B),e.B=null)}function Ma(e){0==e.l.G||e.I||eu(e.l,e)}function Fa(e){La(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,Ho(e.T),ta(e.S),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function Va(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||dc(n.h,e)))if(!e.J&&dc(n.h,e)&&3==n.G){try{var r=n.Fa.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;Zc(n),Kc(n)}Xc(n),la(18)}}else n.Ba=i[1],0<n.Ba-n.T&&37500>i[2]&&n.L&&0==n.A&&!n.v&&(n.v=da(xs(n.cb,n),6e3));if(1>=hc(n.h)&&n.ja){try{n.ja()}catch(e){}n.ja=void 0}}else nu(n,11)}else if((e.J||n.g==e)&&Zc(n),!qs(t))for(i=n.Fa.g.parse(t),t=0;t<i.length;t++){let u=i[t];if(n.T=u[0],u=u[1],2==n.G)if("c"==u[0]){n.I=u[1],n.ka=u[2];const t=u[3];null!=t&&(n.ma=t,n.j.info("VER="+n.ma));const i=u[4];null!=i&&(n.Ca=i,n.j.info("SVER="+n.Ca));const l=u[5];null!=l&&"number"==typeof l&&0<l&&(r=1.5*l,n.J=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(fc(s,s.h),s.h=null))}if(r.D){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.za=e,$a(r.F,r.D,e))}}n.G=3,n.l&&n.l.xa(),n.$&&(n.P=Date.now()-e.F,n.j.info("Handshake RTT: "+n.P+"ms"));var o=e;if((r=n).sa=iu(r,r.H?r.ka:null,r.V),o.J){pc(r.h,o);var a=o,c=r.J;c&&a.setTimeout(c),a.B&&(La(a),Oa(a)),r.g=o}else Qc(r);0<n.i.length&&zc(n)}else"stop"!=u[0]&&"close"!=u[0]||nu(n,7);else 3==n.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?nu(n,7):jc(n):"noop"!=u[0]&&n.l&&n.l.wa(u),n.A=0)}ca()}catch(e){}}function Ua(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(Ss(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.oa&&"function"==typeof e.oa)return e.oa();if(!e.W||"function"!=typeof e.W){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(Ss(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.W&&"function"==typeof e.W)return e.W();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(Ss(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}(ws=Ta.prototype).setTimeout=function(e){this.O=e},ws.ib=function(e){e=e.target;const t=this.L;t&&3==Mc(e)?t.l():this.La(e)},ws.La=function(e){try{if(e==this.g)e:{const l=Mc(this.g);var t=this.g.Ea();if(this.g.aa(),!(3>l)&&(3!=l||Ys||this.g&&(this.h.h||this.g.fa()||Fc(this.g)))){this.I||4!=l||7==t||ca(),La(this);var n=this.g.aa();this.Y=n;t:if(Da(this)){var r=Fc(this.g);e="";var i=r.length,s=4==Mc(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Fa(this),Ma(this);var o="";break t}this.h.i=new Ts.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.splice(0,i),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.fa();if(this.i=200==n,function(e,t,n,r,i,s,o){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+o}))}(this.j,this.u,this.A,this.m,this.U,l,n),this.i){if(this.Z&&!this.J){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!qs(a)){var u=a;break t}}u=null}if(!(n=u)){this.i=!1,this.o=3,la(12),Fa(this),Ma(this);break e}ra(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Va(this,n)}this.P?(xa(this,l,o),Ys&&this.i&&3==l&&(ea(this.S,this.T,"tick",this.hb),this.T.start())):(ra(this.j,this.m,o,null),Va(this,o)),4==l&&Fa(this),this.i&&!this.I&&(4==l?eu(this.l,this):(this.i=!1,Oa(this)))}else 400==n&&0<o.indexOf("Unknown SID")?(this.o=3,la(12)):(this.o=0,la(13)),Fa(this),Ma(this)}}}catch(e){}},ws.hb=function(){if(this.g){var e=Mc(this.g),t=this.g.fa();this.C<t.length&&(La(this),xa(this,e,t),this.i&&4!=e&&Oa(this))}},ws.cancel=function(){this.I=!0,Fa(this)},ws.gb=function(){this.B=null;const e=Date.now();0<=e-this.V?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.A),2!=this.K&&(ca(),la(17)),Fa(this),this.o=2,Ma(this)):Pa(this,this.V-e)};var qa=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ba(e,t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof Ba){this.h=void 0!==t?t:e.h,Ka(this,e.j),this.s=e.s,this.g=e.g,Ga(this,e.m),this.l=e.l,t=e.i;var n=new nc;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),za(this,n),this.o=e.o}else e&&(n=String(e).match(qa))?(this.h=!!t,Ka(this,n[1]||"",!0),this.s=Ha(n[2]||""),this.g=Ha(n[3]||"",!0),Ga(this,n[4]),this.l=Ha(n[5]||"",!0),za(this,n[6]||"",!0),this.o=Ha(n[7]||"")):(this.h=!!t,this.i=new nc(null,this.h))}function ja(e){return new Ba(e)}function Ka(e,t,n){e.j=n?Ha(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Ga(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function za(e,t,n){t instanceof nc?(e.i=t,function(e,t){t&&!e.j&&(rc(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(ic(this,t),oc(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=Qa(t,ec)),e.i=new nc(t,e.h))}function $a(e,t,n){e.i.set(t,n)}function Wa(e){return $a(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Ha(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Qa(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,Xa),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function Xa(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Ba.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Qa(t,Ya,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(Qa(t,Ya,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(Qa(n,"/"==n.charAt(0)?Za:Ja,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",Qa(n,tc)),e.join("")};var Ya=/[#\/\?@]/g,Ja=/[#\?:]/g,Za=/[#\?]/g,ec=/[#\?@]/g,tc=/#/g;function nc(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function rc(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function ic(e,t){rc(e),t=ac(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function sc(e,t){return rc(e),t=ac(e,t),e.g.has(t)}function oc(e,t,n){ic(e,t),0<n.length&&(e.i=null,e.g.set(ac(e,t),Ms(n)),e.h+=n.length)}function ac(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function cc(e){this.l=e||uc,e=Ts.PerformanceNavigationTiming?0<(e=Ts.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(Ts.g&&Ts.g.Ga&&Ts.g.Ga()&&Ts.g.Ga().$b),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(ws=nc.prototype).add=function(e,t){rc(this),this.i=null,e=ac(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},ws.forEach=function(e,t){rc(this),this.g.forEach((function(n,r){n.forEach((function(n){e.call(t,n,r,this)}),this)}),this)},ws.oa=function(){rc(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){const i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},ws.W=function(e){rc(this);let t=[];if("string"==typeof e)sc(this,e)&&(t=t.concat(this.g.get(ac(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},ws.set=function(e,t){return rc(this),this.i=null,sc(this,e=ac(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},ws.get=function(e,t){return e&&0<(e=this.W(e)).length?String(e[0]):t},ws.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];const s=encodeURIComponent(String(r)),o=this.W(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),e.push(i)}}return this.i=e.join("&")};var uc=10;function lc(e){return!!e.h||!!e.g&&e.g.size>=e.j}function hc(e){return e.h?1:e.g?e.g.size:0}function dc(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function fc(e,t){e.g?e.g.add(t):e.h=t}function pc(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function mc(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return Ms(e.i)}function gc(){}function yc(){this.g=new gc}function vc(e,t,n){const r=n||"";try{Ua(e,(function(e,n){let i=e;ks(e)&&(i=Fo(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}function wc(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function Ic(e){this.l=e.ac||null,this.j=e.jb||!1}function bc(e,t){Po.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=_c,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}cc.prototype.cancel=function(){if(this.i=mc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}},gc.prototype.stringify=function(e){return Ts.JSON.stringify(e,void 0)},gc.prototype.parse=function(e){return Ts.JSON.parse(e,void 0)},Os(Ic,ma),Ic.prototype.g=function(){return new bc(this.l,this.j)},Ic.prototype.i=function(e){return function(){return e}}({}),Os(bc,Po);var _c=0;function Tc(e){e.j.read().then(e.Ta.bind(e)).catch(e.ga.bind(e))}function Ec(e){e.readyState=4,e.l=null,e.j=null,e.A=null,Sc(e)}function Sc(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(ws=bc.prototype).open=function(e,t){if(this.readyState!=_c)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,Sc(this)},ws.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||Ts).fetch(new Request(this.B,t)).then(this.Wa.bind(this),this.ga.bind(this))},ws.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Ec(this)),this.readyState=_c},ws.Wa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Sc(this)),this.g&&(this.readyState=3,Sc(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(void 0!==Ts.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Tc(this)}else e.text().then(this.Va.bind(this),this.ga.bind(this))},ws.Ta=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Ec(this):Sc(this),3==this.readyState&&Tc(this)}},ws.Va=function(e){this.g&&(this.response=this.responseText=e,Ec(this))},ws.Ua=function(e){this.g&&(this.response=e,Ec(this))},ws.ga=function(){this.g&&Ec(this)},ws.setRequestHeader=function(e,t){this.v.append(e,t)},ws.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},ws.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(bc.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var kc=Ts.JSON.parse;function Ac(e){Po.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Cc,this.K=this.L=!1}Os(Ac,Po);var Cc="",Nc=/^https?$/i,Dc=["POST","PUT"];function xc(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,Rc(e),Pc(e)}function Rc(e){e.D||(e.D=!0,Lo(e,"complete"),Lo(e,"error"))}function Oc(e){if(e.h&&void 0!==_s&&(!e.C[1]||4!=Mc(e)||2!=e.aa()))if(e.v&&4==Mc(e))Qo(e.Ha,0,e);else if(Lo(e,"readystatechange"),4==Mc(e)){e.h=!1;try{const a=e.aa();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===a){var i=String(e.H).match(qa)[1]||null;if(!i&&Ts.self&&Ts.self.location){var s=Ts.self.location.protocol;i=s.substr(0,s.length-1)}r=!Nc.test(i?i.toLowerCase():"")}n=r}if(n)Lo(e,"complete"),Lo(e,"success");else{e.m=6;try{var o=2<Mc(e)?e.g.statusText:""}catch(e){o=""}e.j=o+" ["+e.aa()+"]",Rc(e)}}finally{Pc(e)}}}function Pc(e,t){if(e.g){Lc(e);const n=e.g,r=e.C[0]?Es:null;e.g=null,e.C=null,t||Lo(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function Lc(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(Ts.clearTimeout(e.A),e.A=null)}function Mc(e){return e.g?e.g.readyState:0}function Fc(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case Cc:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Vc(e){let t="";return mo(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function Uc(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Vc(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):$a(e,t,n))}function qc(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Bc(e){this.Ca=0,this.i=[],this.j=new na,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=qc("failFast",!1,e),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=qc("baseRetryDelayMs",5e3,e),this.bb=qc("retryDelaySeedMs",1e4,e),this.$a=qc("forwardChannelMaxRetries",2,e),this.ta=qc("forwardChannelRequestTimeoutMs",2e4,e),this.ra=e&&e.xmlHttpFactory||void 0,this.Da=e&&e.Zb||!1,this.J=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.I="",this.h=new cc(e&&e.concurrentRequestLimit),this.Fa=new yc,this.O=e&&e.fastHandshake||!1,this.N=e&&e.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=e&&e.Xb||!1,e&&e.Aa&&this.j.Aa(),e&&e.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&e&&e.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}function jc(e){if(Gc(e),3==e.G){var t=e.U++,n=ja(e.F);$a(n,"SID",e.I),$a(n,"RID",t),$a(n,"TYPE","terminate"),Wc(e,n),(t=new Ta(e,e.j,t,void 0)).K=2,t.v=Wa(ja(n)),n=!1,Ts.navigator&&Ts.navigator.sendBeacon&&(n=Ts.navigator.sendBeacon(t.v.toString(),"")),!n&&Ts.Image&&((new Image).src=t.v,n=!0),n||(t.g=su(t.l,null),t.g.da(t.v)),t.F=Date.now(),Oa(t)}ru(e)}function Kc(e){e.g&&(Yc(e),e.g.cancel(),e.g=null)}function Gc(e){Kc(e),e.u&&(Ts.clearTimeout(e.u),e.u=null),Zc(e),e.h.cancel(),e.m&&("number"==typeof e.m&&Ts.clearTimeout(e.m),e.m=null)}function zc(e){lc(e.h)||e.m||(e.m=!0,Ko(e.Ja,e),e.C=0)}function $c(e,t){var n;n=t?t.m:e.U++;const r=ja(e.F);$a(r,"SID",e.I),$a(r,"RID",n),$a(r,"AID",e.T),Wc(e,r),e.o&&e.s&&Uc(r,e.o,e.s),n=new Ta(e,e.j,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.i=t.D.concat(e.i)),t=Hc(e,n,1e3),n.setTimeout(Math.round(.5*e.ta)+Math.round(.5*e.ta*Math.random())),fc(e.h,n),Ca(n,r,t)}function Wc(e,t){e.ia&&mo(e.ia,(function(e,n){$a(t,n,e)})),e.l&&Ua({},(function(e,n){$a(t,n,e)}))}function Hc(e,t,n){n=Math.min(e.i.length,n);var r=e.l?xs(e.l.Ra,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].h,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=i[o].h;const a=i[o].g;if(n-=t,0>n)t=Math.max(0,i[o].h-100),s=!1;else try{vc(a,e,"req"+n+"_")}catch(e){r&&r(a)}}if(s){r=e.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,r}function Qc(e){e.g||e.u||(e.Z=1,Ko(e.Ia,e),e.A=0)}function Xc(e){return!(e.g||e.u||3<=e.A||(e.Z++,e.u=da(xs(e.Ia,e),tu(e,e.A)),e.A++,0))}function Yc(e){null!=e.B&&(Ts.clearTimeout(e.B),e.B=null)}function Jc(e){e.g=new Ta(e,e.j,"rpc",e.Z),null===e.o&&(e.g.H=e.s),e.g.N=0;var t=ja(e.sa);$a(t,"RID","rpc"),$a(t,"SID",e.I),$a(t,"CI",e.L?"0":"1"),$a(t,"AID",e.T),$a(t,"TYPE","xmlhttp"),Wc(e,t),e.o&&e.s&&Uc(t,e.o,e.s),e.J&&e.g.setTimeout(e.J);var n=e.g;e=e.ka,n.K=1,n.v=Wa(ja(t)),n.s=null,n.P=!0,Na(n,e)}function Zc(e){null!=e.v&&(Ts.clearTimeout(e.v),e.v=null)}function eu(e,t){var n=null;if(e.g==t){Zc(e),Yc(e),e.g=null;var r=2}else{if(!dc(e.h,t))return;n=t.D,pc(e.h,t),r=1}if(0!=e.G)if(e.pa=t.Y,t.i)if(1==r){n=t.s?t.s.length:0,t=Date.now()-t.F;var i=e.C;Lo(r=oa(),new ha(r,n)),zc(e)}else Qc(e);else if(3==(i=t.o)||0==i&&0<e.pa||!(1==r&&function(e,t){return!(hc(e.h)>=e.h.j-(e.m?1:0)||(e.m?(e.i=t.D.concat(e.i),0):1==e.G||2==e.G||e.C>=(e.Za?0:e.$a)||(e.m=da(xs(e.Ja,e,t),tu(e,e.C)),e.C++,0)))}(e,t)||2==r&&Xc(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),i){case 1:nu(e,5);break;case 4:nu(e,10);break;case 3:nu(e,6);break;default:nu(e,2)}}function tu(e,t){let n=e.Xa+Math.floor(Math.random()*e.bb);return e.l||(n*=2),n*t}function nu(e,t){if(e.j.info("Error code "+t),2==t){var n=null;e.l&&(n=null);var r=xs(e.kb,e);n||(n=new Ba("//www.google.com/images/cleardot.gif"),Ts.location&&"http"==Ts.location.protocol||Ka(n,"https"),Wa(n)),function(e,t){const n=new na;if(Ts.Image){const r=new Image;r.onload=Rs(wc,n,r,"TestLoadImage: loaded",!0,t),r.onerror=Rs(wc,n,r,"TestLoadImage: error",!1,t),r.onabort=Rs(wc,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=Rs(wc,n,r,"TestLoadImage: timeout",!1,t),Ts.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(n.toString(),r)}else la(2);e.G=0,e.l&&e.l.va(t),ru(e),Gc(e)}function ru(e){if(e.G=0,e.la=[],e.l){const t=mc(e.h);0==t.length&&0==e.i.length||(Fs(e.la,t),Fs(e.la,e.i),e.h.i.length=0,Ms(e.i),e.i.length=0),e.l.ua()}}function iu(e,t,n){var r=n instanceof Ba?ja(n):new Ba(n,void 0);if(""!=r.g)t&&(r.g=t+"."+r.g),Ga(r,r.m);else{var i=Ts.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new Ba(null,void 0);r&&Ka(s,r),t&&(s.g=t),i&&Ga(s,i),n&&(s.l=n),r=s}return n=e.D,t=e.za,n&&t&&$a(r,n,t),$a(r,"VER",e.ma),Wc(e,r),r}function su(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Da&&!e.ra?new Ac(new Ic({jb:!0})):new Ac(e.ra)).Ka(e.H),t}function ou(){}function au(){if(Qs&&!(10<=Number(ao)))throw Error("Environmental error: no available transport.")}function cu(e,t){Po.call(this),this.g=new Bc(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.S=e,(e=t&&t.Yb)&&!qs(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!qs(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new hu(this)}function uu(e){Ia.call(this);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function lu(){ba.call(this),this.status=1}function hu(e){this.g=e}(ws=Ac.prototype).Ka=function(e){this.L=e},ws.da=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():va.g(),this.C=this.u?ga(this.u):ga(va),this.g.onreadystatechange=xs(this.Ha,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(e){return void xc(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),i=Ts.FormData&&e instanceof Ts.FormData,!(0<=Ls(Dc,t))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of n)this.g.setRequestHeader(e,t);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Lc(this),0<this.B&&((this.K=function(e){return Qs&&oo()&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=xs(this.qa,this)):this.A=Qo(this.qa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){xc(this,e)}},ws.qa=function(){void 0!==_s&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Lo(this,"timeout"),this.abort(8))},ws.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,Lo(this,"complete"),Lo(this,"abort"),Pc(this))},ws.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Pc(this,!0)),Ac.X.M.call(this)},ws.Ha=function(){this.s||(this.F||this.v||this.l?Oc(this):this.fb())},ws.fb=function(){Oc(this)},ws.aa=function(){try{return 2<Mc(this)?this.g.status:-1}catch(e){return-1}},ws.fa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},ws.Sa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),kc(t)}},ws.Ea=function(){return this.m},ws.Oa=function(){return"string"==typeof this.j?this.j:String(this.j)},(ws=Bc.prototype).ma=8,ws.G=1,ws.Ja=function(e){if(this.m)if(this.m=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const i=new Ta(this,this.j,e,void 0);let s=this.s;if(this.S&&(s?(s=go(s),vo(s,this.S)):s=this.S),null!==this.o||this.N||(i.H=s,s=null),this.O)e:{for(var t=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.g&&"string"==typeof(r=r.g.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=Hc(this,i,t),$a(n=ja(this.F),"RID",e),$a(n,"CVER",22),this.D&&$a(n,"X-HTTP-Session-Id",this.D),Wc(this,n),s&&(this.N?t="headers="+encodeURIComponent(String(Vc(s)))+"&"+t:this.o&&Uc(n,this.o,s)),fc(this.h,i),this.Ya&&$a(n,"TYPE","init"),this.O?($a(n,"$req",t),$a(n,"SID","null"),i.Z=!0,Ca(i,n,null)):Ca(i,n,t),this.G=2}}else 3==this.G&&(e?$c(this,e):0==this.i.length||lc(this.h)||$c(this))},ws.Ia=function(){if(this.u=null,Jc(this),this.$&&!(this.K||null==this.g||0>=this.P)){var e=2*this.P;this.j.info("BP detection timer enabled: "+e),this.B=da(xs(this.eb,this),e)}},ws.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,la(10),Kc(this),Jc(this))},ws.cb=function(){null!=this.v&&(this.v=null,Kc(this),Xc(this),la(19))},ws.kb=function(e){e?(this.j.info("Successfully pinged google.com"),la(2)):(this.j.info("Failed to ping google.com"),la(1))},(ws=ou.prototype).xa=function(){},ws.wa=function(){},ws.va=function(){},ws.ua=function(){},ws.Ra=function(){},au.prototype.g=function(e,t){return new cu(e,t)},Os(cu,Po),cu.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;la(0),e.V=t,e.ia=n||{},e.L=e.Y,e.F=iu(e,null,e.V),zc(e)},cu.prototype.close=function(){jc(this.g)},cu.prototype.u=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=Fo(e),e=n);t.i.push(new class{constructor(e,t){this.h=e,this.g=t}}(t.ab++,e)),3==t.G&&zc(t)},cu.prototype.M=function(){this.g.l=null,delete this.j,jc(this.g),delete this.g,cu.X.M.call(this)},Os(uu,Ia),Os(lu,ba),Os(hu,ou),hu.prototype.xa=function(){Lo(this.g,"a")},hu.prototype.wa=function(e){Lo(this.g,new uu(e))},hu.prototype.va=function(e){Lo(this.g,new lu)},hu.prototype.ua=function(){Lo(this.g,"b")},au.prototype.createWebChannel=au.prototype.g,cu.prototype.send=cu.prototype.u,cu.prototype.open=cu.prototype.m,cu.prototype.close=cu.prototype.close,fa.NO_ERROR=0,fa.TIMEOUT=8,fa.HTTP_ERROR=6,pa.COMPLETE="complete",ya.EventType=wa,wa.OPEN="a",wa.CLOSE="b",wa.ERROR="c",wa.MESSAGE="d",Po.prototype.listen=Po.prototype.N,Ac.prototype.listenOnce=Ac.prototype.O,Ac.prototype.getLastError=Ac.prototype.Oa,Ac.prototype.getLastErrorCode=Ac.prototype.Ea,Ac.prototype.getStatus=Ac.prototype.aa,Ac.prototype.getResponseJson=Ac.prototype.Sa,Ac.prototype.getResponseText=Ac.prototype.fa,Ac.prototype.send=Ac.prototype.da,Ac.prototype.setWithCredentials=Ac.prototype.Ka;var du=bs.createWebChannelTransport=function(){return new au},fu=bs.getStatEventTarget=function(){return oa()},pu=bs.ErrorCode=fa,mu=bs.EventType=pa,gu=bs.Event=ia,yu=bs.Stat={sb:0,vb:1,wb:2,Pb:3,Ub:4,Rb:5,Sb:6,Qb:7,Ob:8,Tb:9,PROXY:10,NOPROXY:11,Mb:12,Ib:13,Jb:14,Hb:15,Kb:16,Lb:17,ob:18,nb:19,pb:20},vu=bs.FetchXmlHttpFactory=Ic,wu=bs.WebChannel=ya,Iu=bs.XhrIo=Ac;const bu="@firebase/firestore";class _u{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}_u.UNAUTHENTICATED=new _u(null),_u.GOOGLE_CREDENTIALS=new _u("google-credentials-uid"),_u.FIRST_PARTY=new _u("first-party-uid"),_u.MOCK_USER=new _u("mock-user");let Tu="9.17.2";const Eu=new q("@firebase/firestore");function Su(){return Eu.logLevel}function ku(e,...t){if(Eu.logLevel<=L.DEBUG){const n=t.map(Nu);Eu.debug(`Firestore (${Tu}): ${e}`,...n)}}function Au(e,...t){if(Eu.logLevel<=L.ERROR){const n=t.map(Nu);Eu.error(`Firestore (${Tu}): ${e}`,...n)}}function Cu(e,...t){if(Eu.logLevel<=L.WARN){const n=t.map(Nu);Eu.warn(`Firestore (${Tu}): ${e}`,...n)}}function Nu(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(t){return e}var t}function Du(e="Unexpected state"){const t=`FIRESTORE (${Tu}) INTERNAL ASSERTION FAILED: `+e;throw Au(t),new Error(t)}function xu(e,t){e||Du()}function Ru(e,t){return e}const Ou={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Pu extends y{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Lu{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class Mu{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Fu{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(_u.UNAUTHENTICATED)))}shutdown(){}}class Vu{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class Uu{constructor(e){this.t=e,this.currentUser=_u.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new Lu;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Lu,e.enqueueRetryable((()=>r(this.currentUser)))};const s=()=>{const t=i;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},o=e=>{ku("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(ku("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Lu)}}),0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(ku("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(xu("string"==typeof t.accessToken),new Mu(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return xu(null===e||"string"==typeof e),new _u(e)}}class qu{constructor(e,t,n,r){this.h=e,this.l=t,this.m=n,this.g=r,this.type="FirstParty",this.user=_u.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(xu(!("object"!=typeof this.h||null===this.h||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.p.set("Authorization",e),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class Bu{constructor(e,t,n,r){this.h=e,this.l=t,this.m=n,this.g=r}getToken(){return Promise.resolve(new qu(this.h,this.l,this.m,this.g))}start(e,t){e.enqueueRetryable((()=>t(_u.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class ju{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Ku{constructor(e){this.T=e,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(e,t){const n=e=>{null!=e.error&&ku("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.A;return this.A=e.token,ku("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const r=e=>{ku("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.T.onInit((e=>r(e))),setTimeout((()=>{if(!this.appCheck){const e=this.T.getImmediate({optional:!0});e?r(e):ku("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(xu("string"==typeof e.token),this.A=e.token,new ju(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Gu(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}class zu{static R(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let n="";for(;n.length<20;){const r=Gu(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length))}return n}}function $u(e,t){return e<t?-1:e>t?1:0}function Wu(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}function Hu(e){return e+"\0"}class Qu{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Pu(Ou.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Pu(Ou.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Pu(Ou.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Pu(Ou.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Qu.fromMillis(Date.now())}static fromDate(e){return Qu.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new Qu(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?$u(this.nanoseconds,e.nanoseconds):$u(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Xu{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Xu(e)}static min(){return new Xu(new Qu(0,0))}static max(){return new Xu(new Qu(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Yu{constructor(e,t,n){void 0===t?t=0:t>e.length&&Du(),void 0===n?n=e.length-t:n>e.length-t&&Du(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Yu.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Yu?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Ju extends Yu{construct(e,t,n){return new Ju(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new Pu(Ou.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new Ju(t)}static emptyPath(){return new Ju([])}}const Zu=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class el extends Yu{construct(e,t,n){return new el(e,t,n)}static isValidIdentifier(e){return Zu.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),el.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new el(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new Pu(Ou.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new Pu(Ou.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new Pu(Ou.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new Pu(Ou.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new el(t)}static emptyPath(){return new el([])}}class tl{constructor(e){this.path=e}static fromPath(e){return new tl(Ju.fromString(e))}static fromName(e){return new tl(Ju.fromString(e).popFirst(5))}static empty(){return new tl(Ju.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Ju.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Ju.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new tl(new Ju(e.slice()))}}class nl{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function rl(e){return e.fields.find((e=>2===e.kind))}function il(e){return e.fields.filter((e=>2!==e.kind))}nl.UNKNOWN_ID=-1;class sl{constructor(e,t){this.fieldPath=e,this.kind=t}}class ol{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new ol(0,ul.min())}}function al(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=Xu.fromTimestamp(1e9===r?new Qu(n+1,0):new Qu(n,r));return new ul(i,tl.empty(),t)}function cl(e){return new ul(e.readTime,e.key,-1)}class ul{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new ul(Xu.min(),tl.empty(),-1)}static max(){return new ul(Xu.max(),tl.empty(),-1)}}function ll(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=tl.comparator(e.documentKey,t.documentKey),0!==n?n:$u(e.largestBatchId,t.largestBatchId))}const hl="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class dl{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function fl(e){if(e.code!==Ou.FAILED_PRECONDITION||e.message!==hl)throw e;ku("LocalStore","Unexpectedly lost primary lease")}class pl{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Du(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new pl(((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof pl?t:pl.resolve(t)}catch(e){return pl.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):pl.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):pl.reject(t)}static resolve(e){return new pl(((t,n)=>{t(e)}))}static reject(e){return new pl(((t,n)=>{n(e)}))}static waitFor(e){return new pl(((t,n)=>{let r=0,i=0,s=!1;e.forEach((e=>{++r,e.next((()=>{++i,s&&i===r&&t()}),(e=>n(e)))})),s=!0,i===r&&t()}))}static or(e){let t=pl.resolve(!1);for(const n of e)t=t.next((e=>e?pl.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}static mapArray(e,t){return new pl(((n,r)=>{const i=e.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const c=a;t(e[c]).next((e=>{s[c]=e,++o,o===i&&n(s)}),(e=>r(e)))}}))}static doWhile(e,t){return new pl(((n,r)=>{const i=()=>{!0===e()?t().next((()=>{i()}),r):n()};i()}))}}class ml{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.v=new Lu,this.transaction.oncomplete=()=>{this.v.resolve()},this.transaction.onabort=()=>{t.error?this.v.reject(new vl(e,t.error)):this.v.resolve()},this.transaction.onerror=t=>{const n=Tl(t.target.error);this.v.reject(new vl(e,n))}}static open(e,t,n,r){try{return new ml(t,e.transaction(r,n))}catch(e){throw new vl(t,e)}}get P(){return this.v.promise}abort(e){e&&this.v.reject(e),this.aborted||(ku("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}V(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new Il(t)}}class gl{constructor(e,t,n){this.name=e,this.version=t,this.S=n,12.2===gl.D(h())&&Au("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return ku("SimpleDb","Removing database:",e),bl(window.indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!g())return!1;if(gl.N())return!0;const e=h(),t=gl.D(e),n=0<t&&t<10,r=gl.k(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||i)}static N(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.O)}static M(e,t){return e.store(t)}static D(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static k(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async F(e){return this.db||(ku("SimpleDb","Opening database:",this.name),this.db=await new Promise(((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{const n=e.target.result;t(n)},r.onblocked=()=>{n(new vl(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{const r=t.target.error;"VersionError"===r.name?n(new Pu(Ou.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new Pu(Ou.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new vl(e,r))},r.onupgradeneeded=e=>{ku("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);const t=e.target.result;this.S.$(t,r.transaction,e.oldVersion,this.version).next((()=>{ku("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.B&&(this.db.onversionchange=e=>this.B(e)),this.db}L(e){this.B=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){const i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.F(e);const t=ml.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next((e=>(t.V(),e))).catch((e=>(t.abort(e),pl.reject(e)))).toPromise();return s.catch((()=>{})),await t.P,s}catch(e){const t=e,n="FirebaseError"!==t.name&&s<3;if(ku("SimpleDb","Transaction failed with error:",t.message,"Retrying:",n),this.close(),!n)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class yl{constructor(e){this.q=e,this.U=!1,this.K=null}get isDone(){return this.U}get G(){return this.K}set cursor(e){this.q=e}done(){this.U=!0}j(e){this.K=e}delete(){return bl(this.q.delete())}}class vl extends Pu{constructor(e,t){super(Ou.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function wl(e){return"IndexedDbTransactionError"===e.name}class Il{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(ku("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(ku("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),bl(n)}add(e){return ku("SimpleDb","ADD",this.store.name,e,e),bl(this.store.add(e))}get(e){return bl(this.store.get(e)).next((t=>(void 0===t&&(t=null),ku("SimpleDb","GET",this.store.name,e,t),t)))}delete(e){return ku("SimpleDb","DELETE",this.store.name,e),bl(this.store.delete(e))}count(){return ku("SimpleDb","COUNT",this.store.name),bl(this.store.count())}W(e,t){const n=this.options(e,t);if(n.index||"function"!=typeof this.store.getAll){const e=this.cursor(n),t=[];return this.H(e,((e,n)=>{t.push(n)})).next((()=>t))}{const e=this.store.getAll(n.range);return new pl(((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}}))}}J(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new pl(((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}}))}Y(e,t){ku("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.Z=!1;const r=this.cursor(n);return this.H(r,((e,t,n)=>n.delete()))}X(e,t){let n;t?n=e:(n={},t=e);const r=this.cursor(n);return this.H(r,t)}tt(e){const t=this.cursor({});return new pl(((n,r)=>{t.onerror=e=>{const t=Tl(e.target.error);r(t)},t.onsuccess=t=>{const r=t.target.result;r?e(r.primaryKey,r.value).next((e=>{e?r.continue():n()})):n()}}))}H(e,t){const n=[];return new pl(((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{const i=e.target.result;if(!i)return void r();const s=new yl(i),o=t(i.primaryKey,i.value,s);if(o instanceof pl){const e=o.catch((e=>(s.done(),pl.reject(e))));n.push(e)}s.isDone?r():null===s.G?i.continue():i.continue(s.G)}})).next((()=>pl.waitFor(n)))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.Z?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function bl(e){return new pl(((t,n)=>{e.onsuccess=e=>{const n=e.target.result;t(n)},e.onerror=e=>{const t=Tl(e.target.error);n(t)}}))}let _l=!1;function Tl(e){const t=gl.D(h());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new Pu("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return _l||(_l=!0,setTimeout((()=>{throw e}),0)),e}}return e}class El{constructor(e,t){this.asyncQueue=e,this.et=t,this.task=null}start(){this.nt(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}nt(e){ku("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{ku("IndexBackiller",`Documents written: ${await this.et.st()}`)}catch(e){wl(e)?ku("IndexBackiller","Ignoring IndexedDB error during index backfill: ",e):await fl(e)}await this.nt(6e4)}))}}class Sl{constructor(e,t){this.localStore=e,this.persistence=t}async st(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.it(t,e)))}it(e,t){const n=new Set;let r=t,i=!0;return pl.doWhile((()=>!0===i&&r>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((t=>{if(null!==t&&!n.has(t))return ku("IndexBackiller",`Processing collection: ${t}`),this.rt(e,t,r).next((e=>{r-=e,n.add(t)}));i=!1})))).next((()=>t-r))}rt(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next((n=>{const i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next((()=>this.ot(r,n))).next((n=>(ku("IndexBackiller",`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n)))).next((()=>i.size))}))))}ot(e,t){let n=e;return t.changes.forEach(((e,t)=>{const r=cl(t);ll(r,n)>0&&(n=r)})),new ul(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class kl{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ut(e),this.ct=e=>t.writeSequenceNumber(e))}ut(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ct&&this.ct(e),e}}kl.at=-1;class Al{constructor(e,t,n,r,i,s,o,a){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class Cl{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Cl("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Cl&&e.projectId===this.projectId&&e.database===this.database}}function Nl(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Dl(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function xl(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function Rl(e){return null==e}function Ol(e){return 0===e&&1/e==-1/0}function Pl(e){return"number"==typeof e&&Number.isInteger(e)&&!Ol(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}class Ll extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Ml{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw e instanceof DOMException?new Ll("Invalid base64 string: "+e):e}}(e);return new Ml(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Ml(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return $u(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ml.EMPTY_BYTE_STRING=new Ml("");const Fl=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Vl(e){if(xu(!!e),"string"==typeof e){let t=0;const n=Fl.exec(e);if(xu(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:Ul(e.seconds),nanos:Ul(e.nanos)}}function Ul(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function ql(e){return"string"==typeof e?Ml.fromBase64String(e):Ml.fromUint8Array(e)}function Bl(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function jl(e){const t=e.mapValue.fields.__previous_value__;return Bl(t)?jl(t):t}function Kl(e){const t=Vl(e.mapValue.fields.__local_write_time__.timestampValue);return new Qu(t.seconds,t.nanos)}const Gl={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},zl={nullValue:"NULL_VALUE"};function $l(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Bl(e)?4:oh(e)?9007199254740991:10:Du()}function Wl(e,t){if(e===t)return!0;const n=$l(e);if(n!==$l(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Kl(e).isEqual(Kl(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=Vl(e.timestampValue),r=Vl(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return ql(e.bytesValue).isEqual(ql(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Ul(e.geoPointValue.latitude)===Ul(t.geoPointValue.latitude)&&Ul(e.geoPointValue.longitude)===Ul(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Ul(e.integerValue)===Ul(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=Ul(e.doubleValue),r=Ul(t.doubleValue);return n===r?Ol(n)===Ol(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return Wu(e.arrayValue.values||[],t.arrayValue.values||[],Wl);case 10:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(Nl(n)!==Nl(r))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!Wl(n[e],r[e])))return!1;return!0}(e,t);default:return Du()}}function Hl(e,t){return void 0!==(e.values||[]).find((e=>Wl(e,t)))}function Ql(e,t){if(e===t)return 0;const n=$l(e),r=$l(t);if(n!==r)return $u(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return $u(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=Ul(e.integerValue||e.doubleValue),r=Ul(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return Xl(e.timestampValue,t.timestampValue);case 4:return Xl(Kl(e),Kl(t));case 5:return $u(e.stringValue,t.stringValue);case 6:return function(e,t){const n=ql(e),r=ql(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=$u(n[e],r[e]);if(0!==t)return t}return $u(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=$u(Ul(e.latitude),Ul(t.latitude));return 0!==n?n:$u(Ul(e.longitude),Ul(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=Ql(n[e],r[e]);if(t)return t}return $u(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===Gl.mapValue&&t===Gl.mapValue)return 0;if(e===Gl.mapValue)return 1;if(t===Gl.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){const t=$u(r[e],s[e]);if(0!==t)return t;const o=Ql(n[r[e]],i[s[e]]);if(0!==o)return o}return $u(r.length,s.length)}(e.mapValue,t.mapValue);default:throw Du()}}function Xl(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return $u(e,t);const n=Vl(e),r=Vl(t),i=$u(n.seconds,r.seconds);return 0!==i?i:$u(n.nanos,r.nanos)}function Yl(e){return Jl(e)}function Jl(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Vl(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?ql(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,tl.fromName(n).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=Jl(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${Jl(e.fields[i])}`;return n+"}"}(e.mapValue):Du();var t,n}function Zl(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function eh(e){return!!e&&"integerValue"in e}function th(e){return!!e&&"arrayValue"in e}function nh(e){return!!e&&"nullValue"in e}function rh(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function ih(e){return!!e&&"mapValue"in e}function sh(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return Dl(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=sh(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=sh(e.arrayValue.values[n]);return t}return Object.assign({},e)}function oh(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function ah(e){return"nullValue"in e?zl:"booleanValue"in e?{booleanValue:!1}:"integerValue"in e||"doubleValue"in e?{doubleValue:NaN}:"timestampValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in e?{stringValue:""}:"bytesValue"in e?{bytesValue:""}:"referenceValue"in e?Zl(Cl.empty(),tl.empty()):"geoPointValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in e?{arrayValue:{}}:"mapValue"in e?{mapValue:{}}:Du()}function ch(e){return"nullValue"in e?{booleanValue:!1}:"booleanValue"in e?{doubleValue:NaN}:"integerValue"in e||"doubleValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in e?{stringValue:""}:"stringValue"in e?{bytesValue:""}:"bytesValue"in e?Zl(Cl.empty(),tl.empty()):"referenceValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in e?{arrayValue:{}}:"arrayValue"in e?{mapValue:{}}:"mapValue"in e?Gl:Du()}function uh(e,t){const n=Ql(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function lh(e,t){const n=Ql(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class hh{constructor(e,t){this.position=e,this.inclusive=t}}function dh(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?tl.comparator(tl.fromName(o.referenceValue),n.key):Ql(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function fh(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Wl(e.position[n],t.position[n]))return!1;return!0}class ph{}class mh extends ph{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new Sh(e,t,n):"array-contains"===t?new Nh(e,n):"in"===t?new Dh(e,n):"not-in"===t?new xh(e,n):"array-contains-any"===t?new Rh(e,n):new mh(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new kh(e,n):new Ah(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Ql(t,this.value)):null!==t&&$l(this.value)===$l(t)&&this.matchesComparison(Ql(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Du()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class gh extends ph{constructor(e,t){super(),this.filters=e,this.op=t,this.ft=null}static create(e,t){return new gh(e,t)}matches(e){return yh(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.ft||(this.ft=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.ft}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.dt((e=>e.isInequality()));return null!==e?e.field:null}dt(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function yh(e){return"and"===e.op}function vh(e){return"or"===e.op}function wh(e){return Ih(e)&&yh(e)}function Ih(e){for(const t of e.filters)if(t instanceof gh)return!1;return!0}function bh(e){if(e instanceof mh)return e.field.canonicalString()+e.op.toString()+Yl(e.value);if(wh(e))return e.filters.map((e=>bh(e))).join(",");{const t=e.filters.map((e=>bh(e))).join(",");return`${e.op}(${t})`}}function _h(e,t){return e instanceof mh?function(e,t){return t instanceof mh&&e.op===t.op&&e.field.isEqual(t.field)&&Wl(e.value,t.value)}(e,t):e instanceof gh?function(e,t){return t instanceof gh&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,r)=>e&&_h(n,t.filters[r])),!0)}(e,t):void Du()}function Th(e,t){const n=e.filters.concat(t);return gh.create(n,e.op)}function Eh(e){return e instanceof mh?function(e){return`${e.field.canonicalString()} ${e.op} ${Yl(e.value)}`}(e):e instanceof gh?function(e){return e.op.toString()+" {"+e.getFilters().map(Eh).join(" ,")+"}"}(e):"Filter"}class Sh extends mh{constructor(e,t,n){super(e,t,n),this.key=tl.fromName(n.referenceValue)}matches(e){const t=tl.comparator(e.key,this.key);return this.matchesComparison(t)}}class kh extends mh{constructor(e,t){super(e,"in",t),this.keys=Ch(0,t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class Ah extends mh{constructor(e,t){super(e,"not-in",t),this.keys=Ch(0,t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Ch(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>tl.fromName(e.referenceValue)))}class Nh extends mh{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return th(t)&&Hl(t.arrayValue,this.value)}}class Dh extends mh{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Hl(this.value.arrayValue,t)}}class xh extends mh{constructor(e,t){super(e,"not-in",t)}matches(e){if(Hl(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Hl(this.value.arrayValue,t)}}class Rh extends mh{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!th(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>Hl(this.value.arrayValue,e)))}}class Oh{constructor(e,t="asc"){this.field=e,this.dir=t}}function Ph(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class Lh{constructor(e,t){this.comparator=e,this.root=t||Fh.EMPTY}insert(e,t){return new Lh(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Fh.BLACK,null,null))}remove(e){return new Lh(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Fh.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Mh(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Mh(this.root,e,this.comparator,!1)}getReverseIterator(){return new Mh(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Mh(this.root,e,this.comparator,!0)}}class Mh{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Fh{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:Fh.RED,this.left=null!=r?r:Fh.EMPTY,this.right=null!=i?i:Fh.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new Fh(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Fh.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return Fh.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Fh.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Fh.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Du();if(this.right.isRed())throw Du();const e=this.left.check();if(e!==this.right.check())throw Du();return e+(this.isRed()?0:1)}}Fh.EMPTY=null,Fh.RED=!0,Fh.BLACK=!1,Fh.EMPTY=new class{constructor(){this.size=0}get key(){throw Du()}get value(){throw Du()}get color(){throw Du()}get left(){throw Du()}get right(){throw Du()}copy(e,t,n,r,i){return this}insert(e,t,n){return new Fh(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Vh{constructor(e){this.comparator=e,this.data=new Lh(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Uh(this.data.getIterator())}getIteratorFrom(e){return new Uh(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof Vh))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Vh(this.comparator);return t.data=e,t}}class Uh{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function qh(e){return e.hasNext()?e.getNext():void 0}class Bh{constructor(e){this.fields=e,e.sort(el.comparator)}static empty(){return new Bh([])}unionWith(e){let t=new Vh(el.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new Bh(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Wu(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class jh{constructor(e){this.value=e}static empty(){return new jh({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!ih(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=sh(t)}setAll(e){let t=el.emptyPath(),n={},r=[];e.forEach(((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=sh(e):r.push(i.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());ih(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Wl(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];ih(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){Dl(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new jh(sh(this.value))}}function Kh(e){const t=[];return Dl(e.fields,((e,n)=>{const r=new el([e]);if(ih(n)){const e=Kh(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)})),new Bh(t)}class Gh{constructor(e,t,n,r,i,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(e){return new Gh(e,0,Xu.min(),Xu.min(),Xu.min(),jh.empty(),0)}static newFoundDocument(e,t,n,r){return new Gh(e,1,t,Xu.min(),n,r,0)}static newNoDocument(e,t){return new Gh(e,2,t,Xu.min(),Xu.min(),jh.empty(),0)}static newUnknownDocument(e,t){return new Gh(e,3,t,Xu.min(),Xu.min(),jh.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Xu.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=jh.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=jh.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Xu.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Gh&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Gh(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class zh{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this._t=null}}function $h(e,t=null,n=[],r=[],i=null,s=null,o=null){return new zh(e,t,n,r,i,s,o)}function Wh(e){const t=Ru(e);if(null===t._t){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>bh(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),Rl(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>Yl(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>Yl(e))).join(",")),t._t=e}return t._t}function Hh(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!Ph(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!_h(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!fh(e.startAt,t.startAt)&&fh(e.endAt,t.endAt)}function Qh(e){return tl.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function Xh(e,t){return e.filters.filter((e=>e instanceof mh&&e.field.isEqual(t)))}function Yh(e,t,n){let r=zl,i=!0;for(const n of Xh(e,t)){let e=zl,t=!0;switch(n.op){case"<":case"<=":e=ah(n.value);break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=zl}uh({value:r,inclusive:i},{value:e,inclusive:t})<0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];uh({value:r,inclusive:i},{value:e,inclusive:n.inclusive})<0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}function Jh(e,t,n){let r=Gl,i=!0;for(const n of Xh(e,t)){let e=Gl,t=!0;switch(n.op){case">=":case">":e=ch(n.value),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=Gl}lh({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];lh({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}class Zh{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.wt=null,this.gt=null,this.startAt,this.endAt}}function ed(e,t,n,r,i,s,o,a){return new Zh(e,t,n,r,i,s,o,a)}function td(e){return new Zh(e)}function nd(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function rd(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function id(e){for(const t of e.filters){const e=t.getFirstInequalityField();if(null!==e)return e}return null}function sd(e){return null!==e.collectionGroup}function od(e){const t=Ru(e);if(null===t.wt){t.wt=[];const e=id(t),n=rd(t);if(null!==e&&null===n)e.isKeyField()||t.wt.push(new Oh(e)),t.wt.push(new Oh(el.keyField(),"asc"));else{let e=!1;for(const n of t.explicitOrderBy)t.wt.push(n),n.field.isKeyField()&&(e=!0);if(!e){const e=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.wt.push(new Oh(el.keyField(),e))}}}return t.wt}function ad(e){const t=Ru(e);if(!t.gt)if("F"===t.limitType)t.gt=$h(t.path,t.collectionGroup,od(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const n of od(t)){const t="desc"===n.dir?"asc":"desc";e.push(new Oh(n.field,t))}const n=t.endAt?new hh(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new hh(t.startAt.position,t.startAt.inclusive):null;t.gt=$h(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}return t.gt}function cd(e,t){t.getFirstInequalityField(),id(e);const n=e.filters.concat([t]);return new Zh(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function ud(e,t,n){return new Zh(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function ld(e,t){return Hh(ad(e),ad(t))&&e.limitType===t.limitType}function hd(e){return`${Wh(ad(e))}|lt:${e.limitType}`}function dd(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>Eh(e))).join(", ")}]`),Rl(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>Yl(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>Yl(e))).join(",")),`Target(${t})`}(ad(e))}; limitType=${e.limitType})`}function fd(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):tl.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of od(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=dh(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,od(e),t)||e.endAt&&!function(e,t,n){const r=dh(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,od(e),t))}(e,t)}function pd(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function md(e){return(t,n)=>{let r=!1;for(const i of od(e)){const e=gd(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function gd(e,t,n){const r=e.field.isKeyField()?tl.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?Ql(r,i):Du()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return Du()}}function yd(e,t){if(e.yt){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ol(t)?"-0":t}}function vd(e){return{integerValue:""+e}}function wd(e,t){return Pl(t)?vd(t):yd(e,t)}class Id{constructor(){this._=void 0}}function bd(e,t,n){return e instanceof Ed?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof Sd?kd(e,t):e instanceof Ad?Cd(e,t):function(e,t){const n=Td(e,t),r=Dd(n)+Dd(e.It);return eh(n)&&eh(e.It)?vd(r):yd(e.Tt,r)}(e,t)}function _d(e,t,n){return e instanceof Sd?kd(e,t):e instanceof Ad?Cd(e,t):n}function Td(e,t){return e instanceof Nd?eh(n=t)||function(e){return!!e&&"doubleValue"in e}(n)?t:{integerValue:0}:null;var n}class Ed extends Id{}class Sd extends Id{constructor(e){super(),this.elements=e}}function kd(e,t){const n=xd(t);for(const t of e.elements)n.some((e=>Wl(e,t)))||n.push(t);return{arrayValue:{values:n}}}class Ad extends Id{constructor(e){super(),this.elements=e}}function Cd(e,t){let n=xd(t);for(const t of e.elements)n=n.filter((e=>!Wl(e,t)));return{arrayValue:{values:n}}}class Nd extends Id{constructor(e,t){super(),this.Tt=e,this.It=t}}function Dd(e){return Ul(e.integerValue||e.doubleValue)}function xd(e){return th(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Rd{constructor(e,t){this.field=e,this.transform=t}}class Od{constructor(e,t){this.version=e,this.transformResults=t}}class Pd{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Pd}static exists(e){return new Pd(void 0,e)}static updateTime(e){return new Pd(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ld(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Md{}function Fd(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Wd(e.key,Pd.none()):new jd(e.key,e.data,Pd.none());{const n=e.data,r=jh.empty();let i=new Vh(el.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new Kd(e.key,r,new Bh(i.toArray()),Pd.none())}}function Vd(e,t,n){e instanceof jd?function(e,t,n){const r=e.value.clone(),i=zd(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof Kd?function(e,t,n){if(!Ld(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=zd(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(Gd(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Ud(e,t,n,r){return e instanceof jd?function(e,t,n,r){if(!Ld(e.precondition,t))return n;const i=e.value.clone(),s=$d(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof Kd?function(e,t,n,r){if(!Ld(e.precondition,t))return n;const i=$d(e.fieldTransforms,r,t),s=t.data;return s.setAll(Gd(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,r):function(e,t,n){return Ld(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function qd(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=Td(r.transform,e||null);null!=i&&(null===n&&(n=jh.empty()),n.set(r.field,i))}return n||null}function Bd(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&Wu(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Sd&&t instanceof Sd||e instanceof Ad&&t instanceof Ad?Wu(e.elements,t.elements,Wl):e instanceof Nd&&t instanceof Nd?Wl(e.It,t.It):e instanceof Ed&&t instanceof Ed}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class jd extends Md{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Kd extends Md{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Gd(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}})),t}function zd(e,t,n){const r=new Map;xu(e.length===n.length);for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,_d(o,a,n[i]))}return r}function $d(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,bd(e,s,t))}return r}class Wd extends Md{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Hd extends Md{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Qd{constructor(e){this.count=e}}var Xd,Yd;function Jd(e){switch(e){default:return Du();case Ou.CANCELLED:case Ou.UNKNOWN:case Ou.DEADLINE_EXCEEDED:case Ou.RESOURCE_EXHAUSTED:case Ou.INTERNAL:case Ou.UNAVAILABLE:case Ou.UNAUTHENTICATED:return!1;case Ou.INVALID_ARGUMENT:case Ou.NOT_FOUND:case Ou.ALREADY_EXISTS:case Ou.PERMISSION_DENIED:case Ou.FAILED_PRECONDITION:case Ou.ABORTED:case Ou.OUT_OF_RANGE:case Ou.UNIMPLEMENTED:case Ou.DATA_LOSS:return!0}}function Zd(e){if(void 0===e)return Au("GRPC error has no .code"),Ou.UNKNOWN;switch(e){case Xd.OK:return Ou.OK;case Xd.CANCELLED:return Ou.CANCELLED;case Xd.UNKNOWN:return Ou.UNKNOWN;case Xd.DEADLINE_EXCEEDED:return Ou.DEADLINE_EXCEEDED;case Xd.RESOURCE_EXHAUSTED:return Ou.RESOURCE_EXHAUSTED;case Xd.INTERNAL:return Ou.INTERNAL;case Xd.UNAVAILABLE:return Ou.UNAVAILABLE;case Xd.UNAUTHENTICATED:return Ou.UNAUTHENTICATED;case Xd.INVALID_ARGUMENT:return Ou.INVALID_ARGUMENT;case Xd.NOT_FOUND:return Ou.NOT_FOUND;case Xd.ALREADY_EXISTS:return Ou.ALREADY_EXISTS;case Xd.PERMISSION_DENIED:return Ou.PERMISSION_DENIED;case Xd.FAILED_PRECONDITION:return Ou.FAILED_PRECONDITION;case Xd.ABORTED:return Ou.ABORTED;case Xd.OUT_OF_RANGE:return Ou.OUT_OF_RANGE;case Xd.UNIMPLEMENTED:return Ou.UNIMPLEMENTED;case Xd.DATA_LOSS:return Ou.DATA_LOSS;default:return Du()}}(Yd=Xd||(Xd={}))[Yd.OK=0]="OK",Yd[Yd.CANCELLED=1]="CANCELLED",Yd[Yd.UNKNOWN=2]="UNKNOWN",Yd[Yd.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Yd[Yd.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Yd[Yd.NOT_FOUND=5]="NOT_FOUND",Yd[Yd.ALREADY_EXISTS=6]="ALREADY_EXISTS",Yd[Yd.PERMISSION_DENIED=7]="PERMISSION_DENIED",Yd[Yd.UNAUTHENTICATED=16]="UNAUTHENTICATED",Yd[Yd.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Yd[Yd.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Yd[Yd.ABORTED=10]="ABORTED",Yd[Yd.OUT_OF_RANGE=11]="OUT_OF_RANGE",Yd[Yd.UNIMPLEMENTED=12]="UNIMPLEMENTED",Yd[Yd.INTERNAL=13]="INTERNAL",Yd[Yd.UNAVAILABLE=14]="UNAVAILABLE",Yd[Yd.DATA_LOSS=15]="DATA_LOSS";class ef{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Dl(this.inner,((t,n)=>{for(const[t,r]of n)e(t,r)}))}isEmpty(){return xl(this.inner)}size(){return this.innerSize}}const tf=new Lh(tl.comparator);function nf(){return tf}const rf=new Lh(tl.comparator);function sf(...e){let t=rf;for(const n of e)t=t.insert(n.key,n);return t}function of(e){let t=rf;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function af(){return uf()}function cf(){return uf()}function uf(){return new ef((e=>e.toString()),((e,t)=>e.isEqual(t)))}const lf=new Lh(tl.comparator),hf=new Vh(tl.comparator);function df(...e){let t=hf;for(const n of e)t=t.add(n);return t}const ff=new Vh($u);function pf(){return ff}class mf{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,gf.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new mf(Xu.min(),r,pf(),nf(),df())}}class gf{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new gf(n,t,df(),df(),df())}}class yf{constructor(e,t,n,r){this.Et=e,this.removedTargetIds=t,this.key=n,this.At=r}}class vf{constructor(e,t){this.targetId=e,this.Rt=t}}class wf{constructor(e,t,n=Ml.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class If{constructor(){this.bt=0,this.vt=Tf(),this.Pt=Ml.EMPTY_BYTE_STRING,this.Vt=!1,this.St=!0}get current(){return this.Vt}get resumeToken(){return this.Pt}get Dt(){return 0!==this.bt}get Ct(){return this.St}xt(e){e.approximateByteSize()>0&&(this.St=!0,this.Pt=e)}Nt(){let e=df(),t=df(),n=df();return this.vt.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:Du()}})),new gf(this.Pt,this.Vt,e,t,n)}kt(){this.St=!1,this.vt=Tf()}Ot(e,t){this.St=!0,this.vt=this.vt.insert(e,t)}Mt(e){this.St=!0,this.vt=this.vt.remove(e)}Ft(){this.bt+=1}$t(){this.bt-=1}Bt(){this.St=!0,this.Vt=!0}}class bf{constructor(e){this.Lt=e,this.qt=new Map,this.Ut=nf(),this.Kt=_f(),this.Gt=new Vh($u)}Qt(e){for(const t of e.Et)e.At&&e.At.isFoundDocument()?this.jt(t,e.At):this.zt(t,e.key,e.At);for(const t of e.removedTargetIds)this.zt(t,e.key,e.At)}Wt(e){this.forEachTarget(e,(t=>{const n=this.Ht(t);switch(e.state){case 0:this.Jt(t)&&n.xt(e.resumeToken);break;case 1:n.$t(),n.Dt||n.kt(),n.xt(e.resumeToken);break;case 2:n.$t(),n.Dt||this.removeTarget(t);break;case 3:this.Jt(t)&&(n.Bt(),n.xt(e.resumeToken));break;case 4:this.Jt(t)&&(this.Yt(t),n.xt(e.resumeToken));break;default:Du()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.qt.forEach(((e,n)=>{this.Jt(n)&&t(n)}))}Zt(e){const t=e.targetId,n=e.Rt.count,r=this.Xt(t);if(r){const e=r.target;if(Qh(e))if(0===n){const n=new tl(e.path);this.zt(t,n,Gh.newNoDocument(n,Xu.min()))}else xu(1===n);else this.te(t)!==n&&(this.Yt(t),this.Gt=this.Gt.add(t))}}ee(e){const t=new Map;this.qt.forEach(((n,r)=>{const i=this.Xt(r);if(i){if(n.current&&Qh(i.target)){const t=new tl(i.target.path);null!==this.Ut.get(t)||this.ne(r,t)||this.zt(r,t,Gh.newNoDocument(t,e))}n.Ct&&(t.set(r,n.Nt()),n.kt())}}));let n=df();this.Kt.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{const t=this.Xt(e);return!t||2===t.purpose||(r=!1,!1)})),r&&(n=n.add(e))})),this.Ut.forEach(((t,n)=>n.setReadTime(e)));const r=new mf(e,t,this.Gt,this.Ut,n);return this.Ut=nf(),this.Kt=_f(),this.Gt=new Vh($u),r}jt(e,t){if(!this.Jt(e))return;const n=this.ne(e,t.key)?2:0;this.Ht(e).Ot(t.key,n),this.Ut=this.Ut.insert(t.key,t),this.Kt=this.Kt.insert(t.key,this.se(t.key).add(e))}zt(e,t,n){if(!this.Jt(e))return;const r=this.Ht(e);this.ne(e,t)?r.Ot(t,1):r.Mt(t),this.Kt=this.Kt.insert(t,this.se(t).delete(e)),n&&(this.Ut=this.Ut.insert(t,n))}removeTarget(e){this.qt.delete(e)}te(e){const t=this.Ht(e).Nt();return this.Lt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ft(e){this.Ht(e).Ft()}Ht(e){let t=this.qt.get(e);return t||(t=new If,this.qt.set(e,t)),t}se(e){let t=this.Kt.get(e);return t||(t=new Vh($u),this.Kt=this.Kt.insert(e,t)),t}Jt(e){const t=null!==this.Xt(e);return t||ku("WatchChangeAggregator","Detected inactive target",e),t}Xt(e){const t=this.qt.get(e);return t&&t.Dt?null:this.Lt.ie(e)}Yt(e){this.qt.set(e,new If),this.Lt.getRemoteKeysForTarget(e).forEach((t=>{this.zt(e,t,null)}))}ne(e,t){return this.Lt.getRemoteKeysForTarget(e).has(t)}}function _f(){return new Lh(tl.comparator)}function Tf(){return new Lh(tl.comparator)}const Ef={asc:"ASCENDING",desc:"DESCENDING"},Sf={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},kf={and:"AND",or:"OR"};class Af{constructor(e,t){this.databaseId=e,this.yt=t}}function Cf(e,t){return e.yt?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Nf(e,t){return e.yt?t.toBase64():t.toUint8Array()}function Df(e,t){return Cf(e,t.toTimestamp())}function xf(e){return xu(!!e),Xu.fromTimestamp(function(e){const t=Vl(e);return new Qu(t.seconds,t.nanos)}(e))}function Rf(e,t){return function(e){return new Ju(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function Of(e){const t=Ju.fromString(e);return xu(tp(t)),t}function Pf(e,t){return Rf(e.databaseId,t.path)}function Lf(e,t){const n=Of(t);if(n.get(1)!==e.databaseId.projectId)throw new Pu(Ou.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new Pu(Ou.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new tl(Uf(n))}function Mf(e,t){return Rf(e.databaseId,t)}function Ff(e){const t=Of(e);return 4===t.length?Ju.emptyPath():Uf(t)}function Vf(e){return new Ju(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Uf(e){return xu(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function qf(e,t,n){return{name:Pf(e,t),fields:n.value.mapValue.fields}}function Bf(e,t,n){const r=Lf(e,t.name),i=xf(t.updateTime),s=t.createTime?xf(t.createTime):Xu.min(),o=new jh({mapValue:{fields:t.fields}}),a=Gh.newFoundDocument(r,i,s,o);return n&&a.setHasCommittedMutations(),n?a.setHasCommittedMutations():a}function jf(e,t){let n;if(t instanceof jd)n={update:qf(e,t.key,t.value)};else if(t instanceof Wd)n={delete:Pf(e,t.key)};else if(t instanceof Kd)n={update:qf(e,t.key,t.data),updateMask:ep(t.fieldMask)};else{if(!(t instanceof Hd))return Du();n={verify:Pf(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof Ed)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Sd)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Ad)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Nd)return{fieldPath:t.field.canonicalString(),increment:n.It};throw Du()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Df(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Du()}(e,t.precondition)),n}function Kf(e,t){const n=t.currentDocument?function(e){return void 0!==e.updateTime?Pd.updateTime(xf(e.updateTime)):void 0!==e.exists?Pd.exists(e.exists):Pd.none()}(t.currentDocument):Pd.none(),r=t.updateTransforms?t.updateTransforms.map((t=>function(e,t){let n=null;if("setToServerValue"in t)xu("REQUEST_TIME"===t.setToServerValue),n=new Ed;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new Sd(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new Ad(e)}else"increment"in t?n=new Nd(e,t.increment):Du();const r=el.fromServerFormat(t.fieldPath);return new Rd(r,n)}(e,t))):[];if(t.update){t.update.name;const i=Lf(e,t.update.name),s=new jh({mapValue:{fields:t.update.fields}});if(t.updateMask){const e=function(e){const t=e.fieldPaths||[];return new Bh(t.map((e=>el.fromServerFormat(e))))}(t.updateMask);return new Kd(i,s,e,n,r)}return new jd(i,s,n,r)}if(t.delete){const r=Lf(e,t.delete);return new Wd(r,n)}if(t.verify){const r=Lf(e,t.verify);return new Hd(r,n)}return Du()}function Gf(e,t){return{documents:[Mf(e,t.path)]}}function zf(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=Mf(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=Mf(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(e){if(0!==e.length)return Zf(gh.create(e,"and"))}(t.filters);i&&(n.structuredQuery.where=i);const s=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:Yf(e.field),direction:Hf(e.dir)}}(e)))}(t.orderBy);s&&(n.structuredQuery.orderBy=s);const o=function(e,t){return e.yt||Rl(t)?t:{value:t}}(e,t.limit);var a;return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt={before:(a=t.startAt).inclusive,values:a.position}),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),n}function $f(e){let t=Ff(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){xu(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=function(e){const t=Wf(e);return t instanceof gh&&wh(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((e=>function(e){return new Oh(Jf(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,Rl(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new hh(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new hh(n,t)}(n.endAt)),ed(t,i,o,s,a,"F",c,u)}function Wf(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Jf(e.unaryFilter.field);return mh.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Jf(e.unaryFilter.field);return mh.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Jf(e.unaryFilter.field);return mh.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Jf(e.unaryFilter.field);return mh.create(i,"!=",{nullValue:"NULL_VALUE"});default:return Du()}}(e):void 0!==e.fieldFilter?function(e){return mh.create(Jf(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Du()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return gh.create(e.compositeFilter.filters.map((e=>Wf(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return Du()}}(e.compositeFilter.op))}(e):Du()}function Hf(e){return Ef[e]}function Qf(e){return Sf[e]}function Xf(e){return kf[e]}function Yf(e){return{fieldPath:e.canonicalString()}}function Jf(e){return el.fromServerFormat(e.fieldPath)}function Zf(e){return e instanceof mh?function(e){if("=="===e.op){if(rh(e.value))return{unaryFilter:{field:Yf(e.field),op:"IS_NAN"}};if(nh(e.value))return{unaryFilter:{field:Yf(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(rh(e.value))return{unaryFilter:{field:Yf(e.field),op:"IS_NOT_NAN"}};if(nh(e.value))return{unaryFilter:{field:Yf(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Yf(e.field),op:Qf(e.op),value:e.value}}}(e):e instanceof gh?function(e){const t=e.getFilters().map((e=>Zf(e)));return 1===t.length?t[0]:{compositeFilter:{op:Xf(e.op),filters:t}}}(e):Du()}function ep(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function tp(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function np(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=ip(t)),t=rp(e.get(n),t);return ip(t)}function rp(e,t){let n=t;const r=e.length;for(let t=0;t<r;t++){const r=e.charAt(t);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}function ip(e){return e+""}function sp(e){const t=e.length;if(xu(t>=2),2===t)return xu(""===e.charAt(0)&&""===e.charAt(1)),Ju.emptyPath();const n=t-2,r=[];let i="";for(let s=0;s<t;){const t=e.indexOf("",s);switch((t<0||t>n)&&Du(),e.charAt(t+1)){case"":const n=e.substring(s,t);let o;0===i.length?o=n:(i+=n,o=i,i=""),r.push(o);break;case"":i+=e.substring(s,t),i+="\0";break;case"":i+=e.substring(s,t+1);break;default:Du()}s=t+2}return new Ju(r)}const op=["userId","batchId"];function ap(e,t){return[e,np(t)]}function cp(e,t,n){return[e,np(t),n]}const up={},lp=["prefixPath","collectionGroup","readTime","documentId"],hp=["prefixPath","collectionGroup","documentId"],dp=["collectionGroup","readTime","prefixPath","documentId"],fp=["canonicalId","targetId"],pp=["targetId","path"],mp=["path","targetId"],gp=["collectionId","parent"],yp=["indexId","uid"],vp=["uid","sequenceNumber"],wp=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Ip=["indexId","uid","orderedDocumentKey"],bp=["userId","collectionPath","documentId"],_p=["userId","collectionPath","largestBatchId"],Tp=["userId","collectionGroup","largestBatchId"],Ep=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Sp=[...Ep,"documentOverlays"],kp=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Ap=kp,Cp=[...Ap,"indexConfiguration","indexState","indexEntries"];class Np extends dl{constructor(e,t){super(),this.re=e,this.currentSequenceNumber=t}}function Dp(e,t){const n=Ru(e);return gl.M(n.re,t)}class xp{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const r=this.mutations[t];r.key.isEqual(e.key)&&Vd(r,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Ud(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Ud(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=cf();return this.mutations.forEach((r=>{const i=e.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=t.has(r.key)?null:o;const a=Fd(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(Xu.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),df())}isEqual(e){return this.batchId===e.batchId&&Wu(this.mutations,e.mutations,((e,t)=>Bd(e,t)))&&Wu(this.baseMutations,e.baseMutations,((e,t)=>Bd(e,t)))}}class Rp{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){xu(e.mutations.length===n.length);let r=lf;const i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new Rp(e,t,n,r)}}class Op{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Pp{constructor(e,t,n,r,i=Xu.min(),s=Xu.min(),o=Ml.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o}withSequenceNumber(e){return new Pp(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new Pp(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new Pp(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class Lp{constructor(e){this.oe=e}}function Mp(e,t){const n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Fp(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=function(e,t){return{name:Pf(e,t.key),fields:t.data.value.mapValue.fields,updateTime:Cf(e,t.version.toTimestamp()),createTime:Cf(e,t.createTime.toTimestamp())}}(e.oe,t);else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:Vp(t.version)};else{if(!t.isUnknownDocument())return Du();r.unknownDocument={path:n.path.toArray(),version:Vp(t.version)}}return r}function Fp(e){const t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function Vp(e){const t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function Up(e){const t=new Qu(e.seconds,e.nanoseconds);return Xu.fromTimestamp(t)}function qp(e,t){const n=(t.baseMutations||[]).map((t=>Kf(e.oe,t)));for(let e=0;e<t.mutations.length-1;++e){const n=t.mutations[e];if(e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform){const r=t.mutations[e+1];n.updateTransforms=r.transform.fieldTransforms,t.mutations.splice(e+1,1),++e}}const r=t.mutations.map((t=>Kf(e.oe,t))),i=Qu.fromMillis(t.localWriteTimeMs);return new xp(t.batchId,i,n,r)}function Bp(e){const t=Up(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?Up(e.lastLimboFreeSnapshotVersion):Xu.min();let r;var i;return void 0!==e.query.documents?(xu(1===(i=e.query).documents.length),r=ad(td(Ff(i.documents[0])))):r=function(e){return ad($f(e))}(e.query),new Pp(r,e.targetId,0,e.lastListenSequenceNumber,t,n,Ml.fromBase64String(e.resumeToken))}function jp(e,t){const n=Vp(t.snapshotVersion),r=Vp(t.lastLimboFreeSnapshotVersion);let i;i=Qh(t.target)?Gf(e.oe,t.target):zf(e.oe,t.target);const s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:Wh(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function Kp(e){const t=$f({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?ud(t,t.limit,"L"):t}function Gp(e,t){return new Op(t.largestBatchId,Kf(e.oe,t.overlayMutation))}function zp(e,t){const n=t.path.lastSegment();return[e,np(t.path.popLast()),n]}function $p(e,t,n,r){return{indexId:e,uid:t.uid||"",sequenceNumber:n,readTime:Vp(r.readTime),documentKey:np(r.documentKey.path),largestBatchId:r.largestBatchId}}class Wp{getBundleMetadata(e,t){return Hp(e).get(t).next((e=>{if(e)return{id:(t=e).bundleId,createTime:Up(t.createTime),version:t.version};var t}))}saveBundleMetadata(e,t){return Hp(e).put({bundleId:(n=t).id,createTime:Vp(xf(n.createTime)),version:n.version});var n}getNamedQuery(e,t){return Qp(e).get(t).next((e=>{if(e)return{name:(t=e).name,query:Kp(t.bundledQuery),readTime:Up(t.readTime)};var t}))}saveNamedQuery(e,t){return Qp(e).put(function(e){return{name:e.name,readTime:Vp(xf(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}function Hp(e){return Dp(e,"bundles")}function Qp(e){return Dp(e,"namedQueries")}class Xp{constructor(e,t){this.Tt=e,this.userId=t}static ue(e,t){const n=t.uid||"";return new Xp(e,n)}getOverlay(e,t){return Yp(e).get(zp(this.userId,t)).next((e=>e?Gp(this.Tt,e):null))}getOverlays(e,t){const n=af();return pl.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){const r=[];return n.forEach(((n,i)=>{const s=new Op(t,i);r.push(this.ce(e,s))})),pl.waitFor(r)}removeOverlaysForBatchId(e,t,n){const r=new Set;t.forEach((e=>r.add(np(e.getCollectionPath()))));const i=[];return r.forEach((t=>{const r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(Yp(e).Y("collectionPathOverlayIndex",r))})),pl.waitFor(i)}getOverlaysForCollection(e,t,n){const r=af(),i=np(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Yp(e).W("collectionPathOverlayIndex",s).next((e=>{for(const t of e){const e=Gp(this.Tt,t);r.set(e.getKey(),e)}return r}))}getOverlaysForCollectionGroup(e,t,n,r){const i=af();let s;const o=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Yp(e).X({index:"collectionGroupOverlayIndex",range:o},((e,t,n)=>{const o=Gp(this.Tt,t);i.size()<r||o.largestBatchId===s?(i.set(o.getKey(),o),s=o.largestBatchId):n.done()})).next((()=>i))}ce(e,t){return Yp(e).put(function(e,t,n){const[r,i,s]=zp(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:jf(e.oe,n.mutation)}}(this.Tt,this.userId,t))}}function Yp(e){return Dp(e,"documentOverlays")}class Jp{constructor(){}ae(e,t){this.he(e,t),t.le()}he(e,t){if("nullValue"in e)this.fe(t,5);else if("booleanValue"in e)this.fe(t,10),t.de(e.booleanValue?1:0);else if("integerValue"in e)this.fe(t,15),t.de(Ul(e.integerValue));else if("doubleValue"in e){const n=Ul(e.doubleValue);isNaN(n)?this.fe(t,13):(this.fe(t,15),Ol(n)?t.de(0):t.de(n))}else if("timestampValue"in e){const n=e.timestampValue;this.fe(t,20),"string"==typeof n?t._e(n):(t._e(`${n.seconds||""}`),t.de(n.nanos||0))}else if("stringValue"in e)this.we(e.stringValue,t),this.me(t);else if("bytesValue"in e)this.fe(t,30),t.ge(ql(e.bytesValue)),this.me(t);else if("referenceValue"in e)this.ye(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.fe(t,45),t.de(n.latitude||0),t.de(n.longitude||0)}else"mapValue"in e?oh(e)?this.fe(t,Number.MAX_SAFE_INTEGER):(this.pe(e.mapValue,t),this.me(t)):"arrayValue"in e?(this.Ie(e.arrayValue,t),this.me(t)):Du()}we(e,t){this.fe(t,25),this.Te(e,t)}Te(e,t){t._e(e)}pe(e,t){const n=e.fields||{};this.fe(t,55);for(const e of Object.keys(n))this.we(e,t),this.he(n[e],t)}Ie(e,t){const n=e.values||[];this.fe(t,50);for(const e of n)this.he(e,t)}ye(e,t){this.fe(t,37),tl.fromName(e).path.forEach((e=>{this.fe(t,60),this.Te(e,t)}))}fe(e,t){e.de(t)}me(e){e.de(2)}}function Zp(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}function em(e){const t=64-function(e){let t=0;for(let n=0;n<8;++n){const r=Zp(255&e[n]);if(t+=r,8!==r)break}return t}(e);return Math.ceil(t/8)}Jp.Ee=new Jp;class tm{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ae(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Re(n.value),n=t.next();this.be()}ve(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Pe(n.value),n=t.next();this.Ve()}Se(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Re(e);else if(e<2048)this.Re(960|e>>>6),this.Re(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Re(480|e>>>12),this.Re(128|63&e>>>6),this.Re(128|63&e);else{const e=t.codePointAt(0);this.Re(240|e>>>18),this.Re(128|63&e>>>12),this.Re(128|63&e>>>6),this.Re(128|63&e)}}this.be()}De(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Pe(e);else if(e<2048)this.Pe(960|e>>>6),this.Pe(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Pe(480|e>>>12),this.Pe(128|63&e>>>6),this.Pe(128|63&e);else{const e=t.codePointAt(0);this.Pe(240|e>>>18),this.Pe(128|63&e>>>12),this.Pe(128|63&e>>>6),this.Pe(128|63&e)}}this.Ve()}Ce(e){const t=this.xe(e),n=em(t);this.Ne(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}ke(e){const t=this.xe(e),n=em(t);this.Ne(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}Oe(){this.Me(255),this.Me(255)}Fe(){this.$e(255),this.$e(255)}reset(){this.position=0}seed(e){this.Ne(e.length),this.buffer.set(e,this.position),this.position+=e.length}Be(){return this.buffer.slice(0,this.position)}xe(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(let e=1;e<t.length;++e)t[e]^=n?255:0;return t}Re(e){const t=255&e;0===t?(this.Me(0),this.Me(255)):255===t?(this.Me(255),this.Me(0)):this.Me(t)}Pe(e){const t=255&e;0===t?(this.$e(0),this.$e(255)):255===t?(this.$e(255),this.$e(0)):this.$e(e)}be(){this.Me(0),this.Me(1)}Ve(){this.$e(0),this.$e(1)}Me(e){this.Ne(1),this.buffer[this.position++]=e}$e(e){this.Ne(1),this.buffer[this.position++]=~e}Ne(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class nm{constructor(e){this.Le=e}ge(e){this.Le.Ae(e)}_e(e){this.Le.Se(e)}de(e){this.Le.Ce(e)}le(){this.Le.Oe()}}class rm{constructor(e){this.Le=e}ge(e){this.Le.ve(e)}_e(e){this.Le.De(e)}de(e){this.Le.ke(e)}le(){this.Le.Fe()}}class im{constructor(){this.Le=new tm,this.qe=new nm(this.Le),this.Ue=new rm(this.Le)}seed(e){this.Le.seed(e)}Ke(e){return 0===e?this.qe:this.Ue}Be(){return this.Le.Be()}reset(){this.Le.reset()}}class sm{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}Ge(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new sm(this.indexId,this.documentKey,this.arrayValue,n)}}function om(e,t){let n=e.indexId-t.indexId;return 0!==n?n:(n=am(e.arrayValue,t.arrayValue),0!==n?n:(n=am(e.directionalValue,t.directionalValue),0!==n?n:tl.comparator(e.documentKey,t.documentKey)))}function am(e,t){for(let n=0;n<e.length&&n<t.length;++n){const r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}class cm{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Qe=e.orderBy,this.je=[];for(const t of e.filters){const e=t;e.isInequality()?this.ze=e:this.je.push(e)}}We(e){xu(e.collectionGroup===this.collectionId);const t=rl(e);if(void 0!==t&&!this.He(t))return!1;const n=il(e);let r=0,i=0;for(;r<n.length&&this.He(n[r]);++r);if(r===n.length)return!0;if(void 0!==this.ze){const e=n[r];if(!this.Je(this.ze,e)||!this.Ye(this.Qe[i++],e))return!1;++r}for(;r<n.length;++r){const e=n[r];if(i>=this.Qe.length||!this.Ye(this.Qe[i++],e))return!1}return!0}He(e){for(const t of this.je)if(this.Je(t,e))return!0;return!1}Je(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;const n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}Ye(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function um(e){var t,n;if(xu(e instanceof mh||e instanceof gh),e instanceof mh){if(e instanceof Dh){const r=(null===(n=null===(t=e.value.arrayValue)||void 0===t?void 0:t.values)||void 0===n?void 0:n.map((t=>mh.create(e.field,"==",t))))||[];return gh.create(r,"or")}return e}const r=e.filters.map((e=>um(e)));return gh.create(r,e.op)}function lm(e){if(0===e.getFilters().length)return[];const t=pm(um(e));return xu(fm(t)),hm(t)||dm(t)?[t]:t.getFilters()}function hm(e){return e instanceof mh}function dm(e){return e instanceof gh&&wh(e)}function fm(e){return hm(e)||dm(e)||function(e){if(e instanceof gh&&vh(e)){for(const t of e.getFilters())if(!hm(t)&&!dm(t))return!1;return!0}return!1}(e)}function pm(e){if(xu(e instanceof mh||e instanceof gh),e instanceof mh)return e;if(1===e.filters.length)return pm(e.filters[0]);const t=e.filters.map((e=>pm(e)));let n=gh.create(t,e.op);return n=ym(n),fm(n)?n:(xu(n instanceof gh),xu(yh(n)),xu(n.filters.length>1),n.filters.reduce(((e,t)=>mm(e,t))))}function mm(e,t){let n;return xu(e instanceof mh||e instanceof gh),xu(t instanceof mh||t instanceof gh),n=e instanceof mh?t instanceof mh?function(e,t){return gh.create([e,t],"and")}(e,t):gm(e,t):t instanceof mh?gm(t,e):function(e,t){if(xu(e.filters.length>0&&t.filters.length>0),yh(e)&&yh(t))return Th(e,t.getFilters());const n=vh(e)?e:t,r=vh(e)?t:e,i=n.filters.map((e=>mm(e,r)));return gh.create(i,"or")}(e,t),ym(n)}function gm(e,t){if(yh(t))return Th(t,e.getFilters());{const n=t.filters.map((t=>mm(e,t)));return gh.create(n,"or")}}function ym(e){if(xu(e instanceof mh||e instanceof gh),e instanceof mh)return e;const t=e.getFilters();if(1===t.length)return ym(t[0]);if(Ih(e))return e;const n=t.map((e=>ym(e))),r=[];return n.forEach((t=>{t instanceof mh?r.push(t):t instanceof gh&&(t.op===e.op?r.push(...t.filters):r.push(t))})),1===r.length?r[0]:gh.create(r,e.op)}class vm{constructor(){this.Ze=new wm}addToCollectionParentIndex(e,t){return this.Ze.add(t),pl.resolve()}getCollectionParents(e,t){return pl.resolve(this.Ze.getEntries(t))}addFieldIndex(e,t){return pl.resolve()}deleteFieldIndex(e,t){return pl.resolve()}getDocumentsMatchingTarget(e,t){return pl.resolve(null)}getIndexType(e,t){return pl.resolve(0)}getFieldIndexes(e,t){return pl.resolve([])}getNextCollectionGroupToUpdate(e){return pl.resolve(null)}getMinOffset(e,t){return pl.resolve(ul.min())}getMinOffsetFromCollectionGroup(e,t){return pl.resolve(ul.min())}updateCollectionGroup(e,t,n){return pl.resolve()}updateIndexEntries(e,t){return pl.resolve()}}class wm{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Vh(Ju.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new Vh(Ju.comparator)).toArray()}}const Im=new Uint8Array(0);class bm{constructor(e,t){this.user=e,this.databaseId=t,this.Xe=new wm,this.tn=new ef((e=>Wh(e)),((e,t)=>Hh(e,t))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Xe.has(t)){const n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener((()=>{this.Xe.add(t)}));const i={collectionId:n,parent:np(r)};return _m(e).put(i)}return pl.resolve()}getCollectionParents(e,t){const n=[],r=IDBKeyRange.bound([t,""],[Hu(t),""],!1,!0);return _m(e).W(r).next((e=>{for(const r of e){if(r.collectionId!==t)break;n.push(sp(r.parent))}return n}))}addFieldIndex(e,t){const n=Em(e),r=function(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map((e=>[e.fieldPath.canonicalString(),e.kind]))}}(t);delete r.indexId;const i=n.add(r);if(t.indexState){const n=Sm(e);return i.next((e=>{n.put($p(e,this.user,t.indexState.sequenceNumber,t.indexState.offset))}))}return i.next()}deleteFieldIndex(e,t){const n=Em(e),r=Sm(e),i=Tm(e);return n.delete(t.indexId).next((()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}getDocumentsMatchingTarget(e,t){const n=Tm(e);let r=!0;const i=new Map;return pl.forEach(this.en(t),(t=>this.nn(e,t).next((e=>{r&&(r=!!e),i.set(t,e)})))).next((()=>{if(r){let e=df();const r=[];return pl.forEach(i,((i,s)=>{var o;ku("IndexedDbIndexManager",`Using index ${o=i,`id=${o.indexId}|cg=${o.collectionGroup}|f=${o.fields.map((e=>`${e.fieldPath}:${e.kind}`)).join(",")}`} to execute ${Wh(t)}`);const a=function(e,t){const n=rl(t);if(void 0===n)return null;for(const t of Xh(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),c=function(e,t){const n=new Map;for(const r of il(t))for(const t of Xh(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(s,i),u=function(e,t){const n=[];let r=!0;for(const i of il(t)){const t=0===i.kind?Yh(e,i.fieldPath,e.startAt):Jh(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new hh(n,r)}(s,i),l=function(e,t){const n=[];let r=!0;for(const i of il(t)){const t=0===i.kind?Jh(e,i.fieldPath,e.endAt):Yh(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new hh(n,r)}(s,i),h=this.sn(i,s,u),d=this.sn(i,s,l),f=this.rn(i,s,c),p=this.on(i.indexId,a,h,u.inclusive,d,l.inclusive,f);return pl.forEach(p,(i=>n.J(i,t.limit).next((t=>{t.forEach((t=>{const n=tl.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))}))}))))})).next((()=>r))}return pl.resolve(null)}))}en(e){let t=this.tn.get(e);return t||(t=0===e.filters.length?[e]:lm(gh.create(e.filters,"and")).map((t=>$h(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt))),this.tn.set(e,t),t)}on(e,t,n,r,i,s,o){const a=(null!=t?t.length:1)*Math.max(n.length,i.length),c=a/(null!=t?t.length:1),u=[];for(let l=0;l<a;++l){const a=t?this.un(t[l/c]):Im,h=this.cn(e,a,n[l%c],r),d=this.an(e,a,i[l%c],s),f=o.map((t=>this.cn(e,a,t,!0)));u.push(...this.createRange(h,d,f))}return u}cn(e,t,n,r){const i=new sm(e,tl.empty(),t,n);return r?i:i.Ge()}an(e,t,n,r){const i=new sm(e,tl.empty(),t,n);return r?i.Ge():i}nn(e,t){const n=new cm(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next((e=>{let t=null;for(const r of e)n.We(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t}))}getIndexType(e,t){let n=2;const r=this.en(t);return pl.forEach(r,(t=>this.nn(e,t).next((e=>{e?0!==n&&e.fields.length<function(e){let t=new Vh(el.comparator),n=!1;for(const r of e.filters)for(const e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(const n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})))).next((()=>function(e){return null!==e.limit}(t)&&r.length>1&&2===n?1:n))}hn(e,t){const n=new im;for(const r of il(e)){const e=t.data.field(r.fieldPath);if(null==e)return null;const i=n.Ke(r.kind);Jp.Ee.ae(e,i)}return n.Be()}un(e){const t=new im;return Jp.Ee.ae(e,t.Ke(0)),t.Be()}ln(e,t){const n=new im;return Jp.Ee.ae(Zl(this.databaseId,t),n.Ke(function(e){const t=il(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.Be()}rn(e,t,n){if(null===n)return[];let r=[];r.push(new im);let i=0;for(const s of il(e)){const e=n[i++];for(const n of r)if(this.fn(t,s.fieldPath)&&th(e))r=this.dn(r,s,e);else{const t=n.Ke(s.kind);Jp.Ee.ae(e,t)}}return this._n(r)}sn(e,t,n){return this.rn(e,t,n.position)}_n(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Be();return t}dn(e,t,n){const r=[...e],i=[];for(const e of n.arrayValue.values||[])for(const n of r){const r=new im;r.seed(n.Be()),Jp.Ee.ae(e,r.Ke(t.kind)),i.push(r)}return i}fn(e,t){return!!e.filters.find((e=>e instanceof mh&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op)))}getFieldIndexes(e,t){const n=Em(e),r=Sm(e);return(t?n.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.W()).next((e=>{const t=[];return pl.forEach(e,(e=>r.get([e.indexId,this.uid]).next((n=>{t.push(function(e,t){const n=t?new ol(t.sequenceNumber,new ul(Up(t.readTime),new tl(sp(t.documentKey)),t.largestBatchId)):ol.empty(),r=e.fields.map((([e,t])=>new sl(el.fromServerFormat(e),t)));return new nl(e.indexId,e.collectionGroup,r,n)}(e,n))})))).next((()=>t))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((e=>0===e.length?null:(e.sort(((e,t)=>{const n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:$u(e.collectionGroup,t.collectionGroup)})),e[0].collectionGroup)))}updateCollectionGroup(e,t,n){const r=Em(e),i=Sm(e);return this.wn(e).next((e=>r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next((t=>pl.forEach(t,(t=>i.put($p(t.indexId,this.user,e,n))))))))}updateIndexEntries(e,t){const n=new Map;return pl.forEach(t,((t,r)=>{const i=n.get(t.collectionGroup);return(i?pl.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next((i=>(n.set(t.collectionGroup,i),pl.forEach(i,(n=>this.mn(e,t,n).next((t=>{const i=this.gn(r,n);return t.isEqual(i)?pl.resolve():this.yn(e,r,n,t,i)})))))))}))}pn(e,t,n,r){return Tm(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.ln(n,t.key),documentKey:t.key.path.toArray()})}In(e,t,n,r){return Tm(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.ln(n,t.key),t.key.path.toArray()])}mn(e,t,n){const r=Tm(e);let i=new Vh(om);return r.X({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.ln(n,t)])},((e,r)=>{i=i.add(new sm(n.indexId,t,r.arrayValue,r.directionalValue))})).next((()=>i))}gn(e,t){let n=new Vh(om);const r=this.hn(t,e);if(null==r)return n;const i=rl(t);if(null!=i){const s=e.data.field(i.fieldPath);if(th(s))for(const i of s.arrayValue.values||[])n=n.add(new sm(t.indexId,e.key,this.un(i),r))}else n=n.add(new sm(t.indexId,e.key,Im,r));return n}yn(e,t,n,r,i){ku("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const s=[];return function(e,t,n,r,i){const s=e.getIterator(),o=t.getIterator();let a=qh(s),c=qh(o);for(;a||c;){let e=!1,t=!1;if(a&&c){const r=n(a,c);r<0?t=!0:r>0&&(e=!0)}else null!=a?t=!0:e=!0;e?(r(c),c=qh(o)):t?(i(a),a=qh(s)):(a=qh(s),c=qh(o))}}(r,i,om,(r=>{s.push(this.pn(e,t,n,r))}),(r=>{s.push(this.In(e,t,n,r))})),pl.waitFor(s)}wn(e){let t=1;return Sm(e).X({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((e,n,r)=>{r.done(),t=n.sequenceNumber+1})).next((()=>t))}createRange(e,t,n){n=n.sort(((e,t)=>om(e,t))).filter(((e,t,n)=>!t||0!==om(e,n[t-1])));const r=[];r.push(e);for(const i of n){const n=om(i,e),s=om(i,t);if(0===n)r[0]=e.Ge();else if(n>0&&s<0)r.push(i),r.push(i.Ge());else if(s>0)break}r.push(t);const i=[];for(let e=0;e<r.length;e+=2){if(this.Tn(r[e],r[e+1]))return[];const t=[r[e].indexId,this.uid,r[e].arrayValue,r[e].directionalValue,Im,[]],n=[r[e+1].indexId,this.uid,r[e+1].arrayValue,r[e+1].directionalValue,Im,[]];i.push(IDBKeyRange.bound(t,n))}return i}Tn(e,t){return om(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(km)}getMinOffset(e,t){return pl.mapArray(this.en(t),(t=>this.nn(e,t).next((e=>e||Du())))).next(km)}}function _m(e){return Dp(e,"collectionParents")}function Tm(e){return Dp(e,"indexEntries")}function Em(e){return Dp(e,"indexConfiguration")}function Sm(e){return Dp(e,"indexState")}function km(e){xu(0!==e.length);let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){const i=e[r].indexState.offset;ll(i,t)<0&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new ul(t.readTime,t.documentKey,n)}const Am={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Cm{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new Cm(e,Cm.DEFAULT_COLLECTION_PERCENTILE,Cm.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Nm(e,t,n){const r=e.store("mutations"),i=e.store("documentMutations"),s=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=r.X({range:o},((e,t,n)=>(a++,n.delete())));s.push(c.next((()=>{xu(1===a)})));const u=[];for(const e of n.mutations){const r=cp(t,e.key.path,n.batchId);s.push(i.delete(r)),u.push(e.key)}return pl.waitFor(s).next((()=>u))}function Dm(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw Du();t=e.noDocument}return JSON.stringify(t).length}Cm.DEFAULT_COLLECTION_PERCENTILE=10,Cm.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Cm.DEFAULT=new Cm(41943040,Cm.DEFAULT_COLLECTION_PERCENTILE,Cm.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Cm.DISABLED=new Cm(-1,0,0);class xm{constructor(e,t,n,r){this.userId=e,this.Tt=t,this.indexManager=n,this.referenceDelegate=r,this.En={}}static ue(e,t,n,r){xu(""!==e.uid);const i=e.isAuthenticated()?e.uid:"";return new xm(i,t,n,r)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Om(e).X({index:"userMutationsIndex",range:n},((e,n,r)=>{t=!1,r.done()})).next((()=>t))}addMutationBatch(e,t,n,r){const i=Pm(e),s=Om(e);return s.add({}).next((o=>{xu("number"==typeof o);const a=new xp(o,t,n,r),c=function(e,t,n){const r=n.baseMutations.map((t=>jf(e.oe,t))),i=n.mutations.map((t=>jf(e.oe,t)));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}(this.Tt,this.userId,a),u=[];let l=new Vh(((e,t)=>$u(e.canonicalString(),t.canonicalString())));for(const e of r){const t=cp(this.userId,e.key.path,o);l=l.add(e.key.path.popLast()),u.push(s.put(c)),u.push(i.put(t,up))}return l.forEach((t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))})),e.addOnCommittedListener((()=>{this.En[o]=a.keys()})),pl.waitFor(u).next((()=>a))}))}lookupMutationBatch(e,t){return Om(e).get(t).next((e=>e?(xu(e.userId===this.userId),qp(this.Tt,e)):null))}An(e,t){return this.En[t]?pl.resolve(this.En[t]):this.lookupMutationBatch(e,t).next((e=>{if(e){const n=e.keys();return this.En[t]=n,n}return null}))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return Om(e).X({index:"userMutationsIndex",range:r},((e,t,r)=>{t.userId===this.userId&&(xu(t.batchId>=n),i=qp(this.Tt,t)),r.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return Om(e).X({index:"userMutationsIndex",range:t,reverse:!0},((e,t,r)=>{n=t.batchId,r.done()})).next((()=>n))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Om(e).W("userMutationsIndex",t).next((e=>e.map((e=>qp(this.Tt,e)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=ap(this.userId,t.path),r=IDBKeyRange.lowerBound(n),i=[];return Pm(e).X({range:r},((n,r,s)=>{const[o,a,c]=n,u=sp(a);if(o===this.userId&&t.path.isEqual(u))return Om(e).get(c).next((e=>{if(!e)throw Du();xu(e.userId===this.userId),i.push(qp(this.Tt,e))}));s.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Vh($u);const r=[];return t.forEach((t=>{const i=ap(this.userId,t.path),s=IDBKeyRange.lowerBound(i),o=Pm(e).X({range:s},((e,r,i)=>{const[s,o,a]=e,c=sp(o);s===this.userId&&t.path.isEqual(c)?n=n.add(a):i.done()}));r.push(o)})),pl.waitFor(r).next((()=>this.Rn(e,n)))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1,i=ap(this.userId,n),s=IDBKeyRange.lowerBound(i);let o=new Vh($u);return Pm(e).X({range:s},((e,t,i)=>{const[s,a,c]=e,u=sp(a);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(o=o.add(c)):i.done()})).next((()=>this.Rn(e,o)))}Rn(e,t){const n=[],r=[];return t.forEach((t=>{r.push(Om(e).get(t).next((e=>{if(null===e)throw Du();xu(e.userId===this.userId),n.push(qp(this.Tt,e))})))})),pl.waitFor(r).next((()=>n))}removeMutationBatch(e,t){return Nm(e.re,this.userId,t).next((n=>(e.addOnCommittedListener((()=>{this.bn(t.batchId)})),pl.forEach(n,(t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))))}bn(e){delete this.En[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return pl.resolve();const n=IDBKeyRange.lowerBound([this.userId]),r=[];return Pm(e).X({range:n},((e,t,n)=>{if(e[0]===this.userId){const t=sp(e[1]);r.push(t)}else n.done()})).next((()=>{xu(0===r.length)}))}))}containsKey(e,t){return Rm(e,this.userId,t)}vn(e){return Lm(e).get(this.userId).next((e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""}))}}function Rm(e,t,n){const r=ap(t,n.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return Pm(e).X({range:s,Z:!0},((e,n,r)=>{const[s,a,c]=e;s===t&&a===i&&(o=!0),r.done()})).next((()=>o))}function Om(e){return Dp(e,"mutations")}function Pm(e){return Dp(e,"documentMutations")}function Lm(e){return Dp(e,"mutationQueues")}class Mm{constructor(e){this.Pn=e}next(){return this.Pn+=2,this.Pn}static Vn(){return new Mm(0)}static Sn(){return new Mm(-1)}}class Fm{constructor(e,t){this.referenceDelegate=e,this.Tt=t}allocateTargetId(e){return this.Dn(e).next((t=>{const n=new Mm(t.highestTargetId);return t.highestTargetId=n.next(),this.Cn(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.Dn(e).next((e=>Xu.fromTimestamp(new Qu(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.Dn(e).next((e=>e.highestListenSequenceNumber))}setTargetsMetadata(e,t,n){return this.Dn(e).next((r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.Cn(e,r))))}addTargetData(e,t){return this.xn(e,t).next((()=>this.Dn(e).next((n=>(n.targetCount+=1,this.Nn(t,n),this.Cn(e,n))))))}updateTargetData(e,t){return this.xn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>Vm(e).delete(t.targetId))).next((()=>this.Dn(e))).next((t=>(xu(t.targetCount>0),t.targetCount-=1,this.Cn(e,t))))}removeTargets(e,t,n){let r=0;const i=[];return Vm(e).X(((s,o)=>{const a=Bp(o);a.sequenceNumber<=t&&null===n.get(a.targetId)&&(r++,i.push(this.removeTargetData(e,a)))})).next((()=>pl.waitFor(i))).next((()=>r))}forEachTarget(e,t){return Vm(e).X(((e,n)=>{const r=Bp(n);t(r)}))}Dn(e){return Um(e).get("targetGlobalKey").next((e=>(xu(null!==e),e)))}Cn(e,t){return Um(e).put("targetGlobalKey",t)}xn(e,t){return Vm(e).put(jp(this.Tt,t))}Nn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.Dn(e).next((e=>e.targetCount))}getTargetData(e,t){const n=Wh(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return Vm(e).X({range:r,index:"queryTargetsIndex"},((e,n,r)=>{const s=Bp(n);Hh(t,s.target)&&(i=s,r.done())})).next((()=>i))}addMatchingKeys(e,t,n){const r=[],i=qm(e);return t.forEach((t=>{const s=np(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))})),pl.waitFor(r)}removeMatchingKeys(e,t,n){const r=qm(e);return pl.forEach(t,(t=>{const i=np(t.path);return pl.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])}))}removeMatchingKeysForTargetId(e,t){const n=qm(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=qm(e);let i=df();return r.X({range:n,Z:!0},((e,t,n)=>{const r=sp(e[1]),s=new tl(r);i=i.add(s)})).next((()=>i))}containsKey(e,t){const n=np(t.path),r=IDBKeyRange.bound([n],[Hu(n)],!1,!0);let i=0;return qm(e).X({index:"documentTargetsIndex",Z:!0,range:r},(([e,t],n,r)=>{0!==e&&(i++,r.done())})).next((()=>i>0))}ie(e,t){return Vm(e).get(t).next((e=>e?Bp(e):null))}}function Vm(e){return Dp(e,"targets")}function Um(e){return Dp(e,"targetGlobal")}function qm(e){return Dp(e,"targetDocuments")}function Bm([e,t],[n,r]){const i=$u(e,n);return 0===i?$u(t,r):i}class jm{constructor(e){this.kn=e,this.buffer=new Vh(Bm),this.On=0}Mn(){return++this.On}Fn(e){const t=[e,this.Mn()];if(this.buffer.size<this.kn)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();Bm(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Km{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.$n=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Bn(6e4)}stop(){this.$n&&(this.$n.cancel(),this.$n=null)}get started(){return null!==this.$n}Bn(e){ku("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.$n=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.$n=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){wl(e)?ku("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await fl(e)}await this.Bn(3e5)}))}}class Gm{constructor(e,t){this.Ln=e,this.params=t}calculateTargetCount(e,t){return this.Ln.qn(e).next((e=>Math.floor(t/100*e)))}nthSequenceNumber(e,t){if(0===t)return pl.resolve(kl.at);const n=new jm(t);return this.Ln.forEachTarget(e,(e=>n.Fn(e.sequenceNumber))).next((()=>this.Ln.Un(e,(e=>n.Fn(e))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.Ln.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Ln.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(ku("LruGarbageCollector","Garbage collection skipped; disabled"),pl.resolve(Am)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(ku("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Am):this.Kn(e,t)))}getCacheSize(e){return this.Ln.getCacheSize(e)}Kn(e,t){let n,r,i,s,o,a,c;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((t=>(t>this.params.maximumSequenceNumbersToCollect?(ku("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r)))).next((r=>(n=r,o=Date.now(),this.removeTargets(e,n,t)))).next((t=>(i=t,a=Date.now(),this.removeOrphanedDocuments(e,n)))).next((e=>(c=Date.now(),Su()<=L.DEBUG&&ku("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${s-u}ms\n\tDetermined least recently used ${r} in `+(o-s)+"ms\n"+`\tRemoved ${i} targets in `+(a-o)+"ms\n"+`\tRemoved ${e} documents in `+(c-a)+"ms\n"+`Total Duration: ${c-u}ms`),pl.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e}))))}}class zm{constructor(e,t){this.db=e,this.garbageCollector=function(e,t){return new Gm(e,t)}(this,t)}qn(e){const t=this.Gn(e);return this.db.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}Gn(e){let t=0;return this.Un(e,(e=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Un(e,t){return this.Qn(e,((e,n)=>t(n)))}addReference(e,t,n){return $m(e,n)}removeReference(e,t,n){return $m(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return $m(e,t)}jn(e,t){return function(e,t){let n=!1;return Lm(e).tt((r=>Rm(e,r,t).next((e=>(e&&(n=!0),pl.resolve(!e)))))).next((()=>n))}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let i=0;return this.Qn(e,((s,o)=>{if(o<=t){const t=this.jn(e,s).next((t=>{if(!t)return i++,n.getEntry(e,s).next((()=>(n.removeEntry(s,Xu.min()),qm(e).delete([0,np(s.path)]))))}));r.push(t)}})).next((()=>pl.waitFor(r))).next((()=>n.apply(e))).next((()=>i))}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return $m(e,t)}Qn(e,t){const n=qm(e);let r,i=kl.at;return n.X({index:"documentTargetsIndex"},(([e,n],{path:s,sequenceNumber:o})=>{0===e?(i!==kl.at&&t(new tl(sp(r)),i),i=o,r=s):i=kl.at})).next((()=>{i!==kl.at&&t(new tl(sp(r)),i)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function $m(e,t){return qm(e).put(function(e,t){return{targetId:0,path:np(e.path),sequenceNumber:t}}(t,e.currentSequenceNumber))}class Wm{constructor(){this.changes=new ef((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Gh.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?pl.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Hm{constructor(e){this.Tt=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return Jm(e).put(n)}removeEntry(e,t,n){return Jm(e).delete(function(e,t){const n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],Fp(t),n[n.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next((n=>(n.byteSize+=t,this.zn(e,n))))}getEntry(e,t){let n=Gh.newInvalidDocument(t);return Jm(e).X({index:"documentKeyIndex",range:IDBKeyRange.only(Zm(t))},((e,r)=>{n=this.Wn(t,r)})).next((()=>n))}Hn(e,t){let n={size:0,document:Gh.newInvalidDocument(t)};return Jm(e).X({index:"documentKeyIndex",range:IDBKeyRange.only(Zm(t))},((e,r)=>{n={document:this.Wn(t,r),size:Dm(r)}})).next((()=>n))}getEntries(e,t){let n=nf();return this.Jn(e,t,((e,t)=>{const r=this.Wn(e,t);n=n.insert(e,r)})).next((()=>n))}Yn(e,t){let n=nf(),r=new Lh(tl.comparator);return this.Jn(e,t,((e,t)=>{const i=this.Wn(e,t);n=n.insert(e,i),r=r.insert(e,Dm(t))})).next((()=>({documents:n,Zn:r})))}Jn(e,t,n){if(t.isEmpty())return pl.resolve();let r=new Vh(tg);t.forEach((e=>r=r.add(e)));const i=IDBKeyRange.bound(Zm(r.first()),Zm(r.last())),s=r.getIterator();let o=s.getNext();return Jm(e).X({index:"documentKeyIndex",range:i},((e,t,r)=>{const i=tl.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;o&&tg(o,i)<0;)n(o,null),o=s.getNext();o&&o.isEqual(i)&&(n(o,t),o=s.hasNext()?s.getNext():null),o?r.j(Zm(o)):r.done()})).next((()=>{for(;o;)n(o,null),o=s.hasNext()?s.getNext():null}))}getDocumentsMatchingQuery(e,t,n,r){const i=t.path,s=[i.popLast().toArray(),i.lastSegment(),Fp(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],o=[i.popLast().toArray(),i.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Jm(e).W(IDBKeyRange.bound(s,o,!0)).next((e=>{let n=nf();for(const i of e){const e=this.Wn(tl.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(fd(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n}))}getAllFromCollectionGroup(e,t,n,r){let i=nf();const s=eg(t,n),o=eg(t,ul.max());return Jm(e).X({index:"collectionGroupIndex",range:IDBKeyRange.bound(s,o,!0)},((e,t,n)=>{const s=this.Wn(tl.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);i=i.insert(s.key,s),i.size===r&&n.done()})).next((()=>i))}newChangeBuffer(e){return new Xm(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((e=>e.byteSize))}getMetadata(e){return Ym(e).get("remoteDocumentGlobalKey").next((e=>(xu(!!e),e)))}zn(e,t){return Ym(e).put("remoteDocumentGlobalKey",t)}Wn(e,t){if(t){const e=function(e,t){let n;if(t.document)n=Bf(e.oe,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=tl.fromSegments(t.noDocument.path),r=Up(t.noDocument.readTime);n=Gh.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return Du();{const e=tl.fromSegments(t.unknownDocument.path),r=Up(t.unknownDocument.version);n=Gh.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime(function(e){const t=new Qu(e[0],e[1]);return Xu.fromTimestamp(t)}(t.readTime)),n}(this.Tt,t);if(!e.isNoDocument()||!e.version.isEqual(Xu.min()))return e}return Gh.newInvalidDocument(e)}}function Qm(e){return new Hm(e)}class Xm extends Wm{constructor(e,t){super(),this.Xn=e,this.trackRemovals=t,this.ts=new ef((e=>e.toString()),((e,t)=>e.isEqual(t)))}applyChanges(e){const t=[];let n=0,r=new Vh(((e,t)=>$u(e.canonicalString(),t.canonicalString())));return this.changes.forEach(((i,s)=>{const o=this.ts.get(i);if(t.push(this.Xn.removeEntry(e,i,o.readTime)),s.isValidDocument()){const a=Mp(this.Xn.Tt,s);r=r.add(i.path.popLast());const c=Dm(a);n+=c-o.size,t.push(this.Xn.addEntry(e,i,a))}else if(n-=o.size,this.trackRemovals){const n=Mp(this.Xn.Tt,s.convertToNoDocument(Xu.min()));t.push(this.Xn.addEntry(e,i,n))}})),r.forEach((n=>{t.push(this.Xn.indexManager.addToCollectionParentIndex(e,n))})),t.push(this.Xn.updateMetadata(e,n)),pl.waitFor(t)}getFromCache(e,t){return this.Xn.Hn(e,t).next((e=>(this.ts.set(t,{size:e.size,readTime:e.document.readTime}),e.document)))}getAllFromCache(e,t){return this.Xn.Yn(e,t).next((({documents:e,Zn:t})=>(t.forEach(((t,n)=>{this.ts.set(t,{size:n,readTime:e.get(t).readTime})})),e)))}}function Ym(e){return Dp(e,"remoteDocumentGlobal")}function Jm(e){return Dp(e,"remoteDocumentsV14")}function Zm(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function eg(e,t){const n=t.documentKey.path.toArray();return[e,Fp(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function tg(e,t){const n=e.path.toArray(),r=t.path.toArray();let i=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(i=$u(n[e],r[e]),i)return i;return i=$u(n.length,r.length),i||(i=$u(n[n.length-2],r[r.length-2]),i||$u(n[n.length-1],r[r.length-1]))}class ng{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class rg{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(n=r,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&Ud(n.mutation,e,Bh.empty(),Qu.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,df()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=df()){const r=af();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,n).next((e=>{let t=sf();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=af();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,df())))}populateOverlays(e,t,n){const r=[];return n.forEach((e=>{t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,r){let i=nf();const s=uf(),o=uf();return t.forEach(((e,t)=>{const o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof Kd)?i=i.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),Ud(o.mutation,t,o.mutation.getFieldMask(),Qu.now())):s.set(t.key,Bh.empty())})),this.recalculateAndSaveOverlays(e,i).next((e=>(e.forEach(((e,t)=>s.set(e,t))),t.forEach(((e,t)=>{var n;return o.set(e,new ng(t,null!==(n=s.get(e))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(e,t){const n=uf();let r=new Lh(((e,t)=>e-t)),i=df();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const i of e)i.keys().forEach((e=>{const s=t.get(e);if(null===s)return;let o=n.get(e)||Bh.empty();o=i.applyToLocalView(s,o),n.set(e,o);const a=(r.get(i.batchId)||df()).add(e);r=r.insert(i.batchId,a)}))})).next((()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=cf();c.forEach((e=>{if(!i.has(e)){const r=Fd(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}})),s.push(this.documentOverlayCache.saveOverlays(e,a,u))}return pl.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n){return function(e){return tl.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):sd(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):pl.resolve(af());let o=-1,a=i;return s.next((t=>pl.forEach(t,((t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?pl.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{a=a.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,i))).next((()=>this.computeViews(e,a,t,df()))).next((e=>({batchId:o,changes:of(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new tl(t)).next((e=>{let t=sf();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n){const r=t.collectionGroup;let i=sf();return this.indexManager.getCollectionParents(e,r).next((s=>pl.forEach(s,(s=>{const o=function(e,t){return new Zh(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,s.child(r));return this.getDocumentsMatchingCollectionQuery(e,o,n).next((e=>{e.forEach(((e,t)=>{i=i.insert(e,t)}))}))})).next((()=>i))))}getDocumentsMatchingCollectionQuery(e,t,n){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((i=>(r=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,r)))).next((e=>{r.forEach(((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,Gh.newInvalidDocument(r)))}));let n=sf();return e.forEach(((e,i)=>{const s=r.get(e);void 0!==s&&Ud(s.mutation,i,Bh.empty(),Qu.now()),fd(t,i)&&(n=n.insert(e,i))})),n}))}}class ig{constructor(e){this.Tt=e,this.es=new Map,this.ns=new Map}getBundleMetadata(e,t){return pl.resolve(this.es.get(t))}saveBundleMetadata(e,t){var n;return this.es.set(t.id,{id:(n=t).id,version:n.version,createTime:xf(n.createTime)}),pl.resolve()}getNamedQuery(e,t){return pl.resolve(this.ns.get(t))}saveNamedQuery(e,t){return this.ns.set(t.name,function(e){return{name:e.name,query:Kp(e.bundledQuery),readTime:xf(e.readTime)}}(t)),pl.resolve()}}class sg{constructor(){this.overlays=new Lh(tl.comparator),this.ss=new Map}getOverlay(e,t){return pl.resolve(this.overlays.get(t))}getOverlays(e,t){const n=af();return pl.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,r)=>{this.ce(e,t,r)})),pl.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.ss.get(n);return void 0!==r&&(r.forEach((e=>this.overlays=this.overlays.remove(e))),this.ss.delete(n)),pl.resolve()}getOverlaysForCollection(e,t,n){const r=af(),i=t.length+1,s=new tl(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return pl.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new Lh(((e,t)=>e-t));const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=af(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=af(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=r)););return pl.resolve(o)}ce(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.ss.get(r.largestBatchId).delete(n.key);this.ss.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Op(t,n));let i=this.ss.get(t);void 0===i&&(i=df(),this.ss.set(t,i)),this.ss.set(t,i.add(n.key))}}class og{constructor(){this.rs=new Vh(ag.os),this.us=new Vh(ag.cs)}isEmpty(){return this.rs.isEmpty()}addReference(e,t){const n=new ag(e,t);this.rs=this.rs.add(n),this.us=this.us.add(n)}hs(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.ls(new ag(e,t))}fs(e,t){e.forEach((e=>this.removeReference(e,t)))}ds(e){const t=new tl(new Ju([])),n=new ag(t,e),r=new ag(t,e+1),i=[];return this.us.forEachInRange([n,r],(e=>{this.ls(e),i.push(e.key)})),i}_s(){this.rs.forEach((e=>this.ls(e)))}ls(e){this.rs=this.rs.delete(e),this.us=this.us.delete(e)}ws(e){const t=new tl(new Ju([])),n=new ag(t,e),r=new ag(t,e+1);let i=df();return this.us.forEachInRange([n,r],(e=>{i=i.add(e.key)})),i}containsKey(e){const t=new ag(e,0),n=this.rs.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class ag{constructor(e,t){this.key=e,this.gs=t}static os(e,t){return tl.comparator(e.key,t.key)||$u(e.gs,t.gs)}static cs(e,t){return $u(e.gs,t.gs)||tl.comparator(e.key,t.key)}}class cg{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.ys=1,this.ps=new Vh(ag.os)}checkEmpty(e){return pl.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.ys;this.ys++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new xp(i,t,n,r);this.mutationQueue.push(s);for(const t of r)this.ps=this.ps.add(new ag(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return pl.resolve(s)}lookupMutationBatch(e,t){return pl.resolve(this.Is(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.Ts(n),i=r<0?0:r;return pl.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return pl.resolve(0===this.mutationQueue.length?-1:this.ys-1)}getAllMutationBatches(e){return pl.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new ag(t,0),r=new ag(t,Number.POSITIVE_INFINITY),i=[];return this.ps.forEachInRange([n,r],(e=>{const t=this.Is(e.gs);i.push(t)})),pl.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Vh($u);return t.forEach((e=>{const t=new ag(e,0),r=new ag(e,Number.POSITIVE_INFINITY);this.ps.forEachInRange([t,r],(e=>{n=n.add(e.gs)}))})),pl.resolve(this.Es(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;tl.isDocumentKey(i)||(i=i.child(""));const s=new ag(new tl(i),0);let o=new Vh($u);return this.ps.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.gs)),!0)}),s),pl.resolve(this.Es(o))}Es(e){const t=[];return e.forEach((e=>{const n=this.Is(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){xu(0===this.As(t.batchId,"removed")),this.mutationQueue.shift();let n=this.ps;return pl.forEach(t.mutations,(r=>{const i=new ag(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.ps=n}))}bn(e){}containsKey(e,t){const n=new ag(t,0),r=this.ps.firstAfterOrEqual(n);return pl.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,pl.resolve()}As(e,t){return this.Ts(e)}Ts(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Is(e){const t=this.Ts(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class ug{constructor(e){this.Rs=e,this.docs=new Lh(tl.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.Rs(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return pl.resolve(n?n.document.mutableCopy():Gh.newInvalidDocument(t))}getEntries(e,t){let n=nf();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():Gh.newInvalidDocument(e))})),pl.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=nf();const s=t.path,o=new tl(s.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||ll(cl(o),n)<=0||(r.has(o.key)||fd(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return pl.resolve(i)}getAllFromCollectionGroup(e,t,n,r){Du()}bs(e,t){return pl.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new lg(this)}getSize(e){return pl.resolve(this.size)}}class lg extends Wm{constructor(e){super(),this.Xn=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.Xn.addEntry(e,r)):this.Xn.removeEntry(n)})),pl.waitFor(t)}getFromCache(e,t){return this.Xn.getEntry(e,t)}getAllFromCache(e,t){return this.Xn.getEntries(e,t)}}class hg{constructor(e){this.persistence=e,this.vs=new ef((e=>Wh(e)),Hh),this.lastRemoteSnapshotVersion=Xu.min(),this.highestTargetId=0,this.Ps=0,this.Vs=new og,this.targetCount=0,this.Ss=Mm.Vn()}forEachTarget(e,t){return this.vs.forEach(((e,n)=>t(n))),pl.resolve()}getLastRemoteSnapshotVersion(e){return pl.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return pl.resolve(this.Ps)}allocateTargetId(e){return this.highestTargetId=this.Ss.next(),pl.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Ps&&(this.Ps=t),pl.resolve()}xn(e){this.vs.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Ss=new Mm(t),this.highestTargetId=t),e.sequenceNumber>this.Ps&&(this.Ps=e.sequenceNumber)}addTargetData(e,t){return this.xn(t),this.targetCount+=1,pl.resolve()}updateTargetData(e,t){return this.xn(t),pl.resolve()}removeTargetData(e,t){return this.vs.delete(t.target),this.Vs.ds(t.targetId),this.targetCount-=1,pl.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.vs.forEach(((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.vs.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)})),pl.waitFor(i).next((()=>r))}getTargetCount(e){return pl.resolve(this.targetCount)}getTargetData(e,t){const n=this.vs.get(t)||null;return pl.resolve(n)}addMatchingKeys(e,t,n){return this.Vs.hs(t,n),pl.resolve()}removeMatchingKeys(e,t,n){this.Vs.fs(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((t=>{i.push(r.markPotentiallyOrphaned(e,t))})),pl.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Vs.ds(t),pl.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Vs.ws(t);return pl.resolve(n)}containsKey(e,t){return pl.resolve(this.Vs.containsKey(t))}}class dg{constructor(e,t){this.Ds={},this.overlays={},this.Cs=new kl(0),this.xs=!1,this.xs=!0,this.referenceDelegate=e(this),this.Ns=new hg(this),this.indexManager=new vm,this.remoteDocumentCache=function(e){return new ug(e)}((e=>this.referenceDelegate.ks(e))),this.Tt=new Lp(t),this.Os=new ig(this.Tt)}start(){return Promise.resolve()}shutdown(){return this.xs=!1,Promise.resolve()}get started(){return this.xs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new sg,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Ds[e.toKey()];return n||(n=new cg(t,this.referenceDelegate),this.Ds[e.toKey()]=n),n}getTargetCache(){return this.Ns}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Os}runTransaction(e,t,n){ku("MemoryPersistence","Starting transaction:",e);const r=new fg(this.Cs.next());return this.referenceDelegate.Ms(),n(r).next((e=>this.referenceDelegate.Fs(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}$s(e,t){return pl.or(Object.values(this.Ds).map((n=>()=>n.containsKey(e,t))))}}class fg extends dl{constructor(e){super(),this.currentSequenceNumber=e}}class pg{constructor(e){this.persistence=e,this.Bs=new og,this.Ls=null}static qs(e){return new pg(e)}get Us(){if(this.Ls)return this.Ls;throw Du()}addReference(e,t,n){return this.Bs.addReference(n,t),this.Us.delete(n.toString()),pl.resolve()}removeReference(e,t,n){return this.Bs.removeReference(n,t),this.Us.add(n.toString()),pl.resolve()}markPotentiallyOrphaned(e,t){return this.Us.add(t.toString()),pl.resolve()}removeTarget(e,t){this.Bs.ds(t.targetId).forEach((e=>this.Us.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.Us.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}Ms(){this.Ls=new Set}Fs(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return pl.forEach(this.Us,(n=>{const r=tl.fromPath(n);return this.Ks(e,r).next((e=>{e||t.removeEntry(r,Xu.min())}))})).next((()=>(this.Ls=null,t.apply(e))))}updateLimboDocument(e,t){return this.Ks(e,t).next((e=>{e?this.Us.delete(t.toString()):this.Us.add(t.toString())}))}ks(e){return 0}Ks(e,t){return pl.or([()=>pl.resolve(this.Bs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.$s(e,t)])}}class mg{constructor(e){this.Tt=e}$(e,t,n,r){const i=new ml("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore("owner")}(e),function(e){e.createObjectStore("mutationQueues",{keyPath:"userId"}),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",op,{unique:!0}),e.createObjectStore("documentMutations")}(e),gg(e),function(e){e.createObjectStore("remoteDocuments")}(e));let s=pl.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore("targetDocuments"),e.deleteObjectStore("targets"),e.deleteObjectStore("targetGlobal")}(e),gg(e)),s=s.next((()=>function(e){const t=e.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Xu.min().toTimestamp(),targetCount:0};return t.put("targetGlobalKey",n)}(i)))),n<4&&r>=4&&(0!==n&&(s=s.next((()=>function(e,t){return t.store("mutations").W().next((n=>{e.deleteObjectStore("mutations"),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",op,{unique:!0});const r=t.store("mutations"),i=n.map((e=>r.put(e)));return pl.waitFor(i)}))}(e,i)))),s=s.next((()=>{!function(e){e.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)}))),n<5&&r>=5&&(s=s.next((()=>this.Gs(i)))),n<6&&r>=6&&(s=s.next((()=>(function(e){e.createObjectStore("remoteDocumentGlobal")}(e),this.Qs(i))))),n<7&&r>=7&&(s=s.next((()=>this.js(i)))),n<8&&r>=8&&(s=s.next((()=>this.zs(e,i)))),n<9&&r>=9&&(s=s.next((()=>{!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e)}))),n<10&&r>=10&&(s=s.next((()=>this.Ws(i)))),n<11&&r>=11&&(s=s.next((()=>{!function(e){e.createObjectStore("bundles",{keyPath:"bundleId"})}(e),function(e){e.createObjectStore("namedQueries",{keyPath:"name"})}(e)}))),n<12&&r>=12&&(s=s.next((()=>{!function(e){const t=e.createObjectStore("documentOverlays",{keyPath:bp});t.createIndex("collectionPathOverlayIndex",_p,{unique:!1}),t.createIndex("collectionGroupOverlayIndex",Tp,{unique:!1})}(e)}))),n<13&&r>=13&&(s=s.next((()=>function(e){const t=e.createObjectStore("remoteDocumentsV14",{keyPath:lp});t.createIndex("documentKeyIndex",hp),t.createIndex("collectionGroupIndex",dp)}(e))).next((()=>this.Hs(e,i))).next((()=>e.deleteObjectStore("remoteDocuments")))),n<14&&r>=14&&(s=s.next((()=>this.Js(e,i)))),n<15&&r>=15&&(s=s.next((()=>function(e){e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:yp}).createIndex("sequenceNumberIndex",vp,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:wp}).createIndex("documentKeyIndex",Ip,{unique:!1})}(e)))),s}Qs(e){let t=0;return e.store("remoteDocuments").X(((e,n)=>{t+=Dm(n)})).next((()=>{const n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)}))}Gs(e){const t=e.store("mutationQueues"),n=e.store("mutations");return t.W().next((t=>pl.forEach(t,(t=>{const r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.W("userMutationsIndex",r).next((n=>pl.forEach(n,(n=>{xu(n.userId===t.userId);const r=qp(this.Tt,n);return Nm(e,t.userId,r).next((()=>{}))}))))}))))}js(e){const t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next((e=>{const r=[];return n.X(((n,i)=>{const s=new Ju(n),o=function(e){return[0,np(e)]}(s);r.push(t.get(o).next((n=>n?pl.resolve():(n=>t.put({targetId:0,path:np(n),sequenceNumber:e.highestListenSequenceNumber}))(s))))})).next((()=>pl.waitFor(r)))}))}zs(e,t){e.createObjectStore("collectionParents",{keyPath:gp});const n=t.store("collectionParents"),r=new wm,i=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:np(r)})}};return t.store("remoteDocuments").X({Z:!0},((e,t)=>{const n=new Ju(e);return i(n.popLast())})).next((()=>t.store("documentMutations").X({Z:!0},(([e,t,n],r)=>{const s=sp(t);return i(s.popLast())}))))}Ws(e){const t=e.store("targets");return t.X(((e,n)=>{const r=Bp(n),i=jp(this.Tt,r);return t.put(i)}))}Hs(e,t){const n=t.store("remoteDocuments"),r=[];return n.X(((e,n)=>{const i=t.store("remoteDocumentsV14"),s=(o=n,o.document?new tl(Ju.fromString(o.document.name).popFirst(5)):o.noDocument?tl.fromSegments(o.noDocument.path):o.unknownDocument?tl.fromSegments(o.unknownDocument.path):Du()).path.toArray();var o;const a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(a))})).next((()=>pl.waitFor(r)))}Js(e,t){const n=t.store("mutations"),r=Qm(this.Tt),i=new dg(pg.qs,this.Tt.oe);return n.W().next((e=>{const n=new Map;return e.forEach((e=>{var t;let r=null!==(t=n.get(e.userId))&&void 0!==t?t:df();qp(this.Tt,e).keys().forEach((e=>r=r.add(e))),n.set(e.userId,r)})),pl.forEach(n,((e,n)=>{const s=new _u(n),o=Xp.ue(this.Tt,s),a=i.getIndexManager(s),c=xm.ue(s,this.Tt,a,i.referenceDelegate);return new rg(r,c,o,a).recalculateAndSaveOverlaysForDocumentKeys(new Np(t,kl.at),e).next()}))}))}}function gg(e){e.createObjectStore("targetDocuments",{keyPath:pp}).createIndex("documentTargetsIndex",mp,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",fp,{unique:!0}),e.createObjectStore("targetGlobal")}const yg="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class vg{constructor(e,t,n,r,i,s,o,a,c,u,l=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Ys=i,this.window=s,this.document=o,this.Zs=c,this.Xs=u,this.ti=l,this.Cs=null,this.xs=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ei=null,this.inForeground=!1,this.ni=null,this.si=null,this.ii=Number.NEGATIVE_INFINITY,this.ri=e=>Promise.resolve(),!vg.C())throw new Pu(Ou.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new zm(this,r),this.oi=t+"main",this.Tt=new Lp(a),this.ui=new gl(this.oi,this.ti,new mg(this.Tt)),this.Ns=new Fm(this.referenceDelegate,this.Tt),this.remoteDocumentCache=Qm(this.Tt),this.Os=new Wp,this.window&&this.window.localStorage?this.ci=this.window.localStorage:(this.ci=null,!1===u&&Au("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ai().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Pu(Ou.FAILED_PRECONDITION,yg);return this.hi(),this.li(),this.fi(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.Ns.getHighestSequenceNumber(e)))})).then((e=>{this.Cs=new kl(e,this.Zs)})).then((()=>{this.xs=!0})).catch((e=>(this.ui&&this.ui.close(),Promise.reject(e))))}di(e){return this.ri=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.ui.L((async t=>{null===t.newVersion&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Ys.enqueueAndForget((async()=>{this.started&&await this.ai()})))}ai(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>Ig(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this._i(e).next((e=>{e||(this.isPrimary=!1,this.Ys.enqueueRetryable((()=>this.ri(!1))))}))})).next((()=>this.wi(e))).next((t=>this.isPrimary&&!t?this.mi(e).next((()=>!1)):!!t&&this.gi(e).next((()=>!0)))))).catch((e=>{if(wl(e))return ku("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return ku("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.Ys.enqueueRetryable((()=>this.ri(e))),this.isPrimary=e}))}_i(e){return wg(e).get("owner").next((e=>pl.resolve(this.yi(e))))}pi(e){return Ig(e).delete(this.clientId)}async Ii(){if(this.isPrimary&&!this.Ti(this.ii,18e5)){this.ii=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(e=>{const t=Dp(e,"clientMetadata");return t.W().next((e=>{const n=this.Ei(e,18e5),r=e.filter((e=>-1===n.indexOf(e)));return pl.forEach(r,(e=>t.delete(e.clientId))).next((()=>r))}))})).catch((()=>[]));if(this.ci)for(const t of e)this.ci.removeItem(this.Ai(t.clientId))}}fi(){this.si=this.Ys.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.ai().then((()=>this.Ii())).then((()=>this.fi()))))}yi(e){return!!e&&e.ownerId===this.clientId}wi(e){return this.Xs?pl.resolve(!0):wg(e).get("owner").next((t=>{if(null!==t&&this.Ti(t.leaseTimestampMs,5e3)&&!this.Ri(t.ownerId)){if(this.yi(t)&&this.networkEnabled)return!0;if(!this.yi(t)){if(!t.allowTabSynchronization)throw new Pu(Ou.FAILED_PRECONDITION,yg);return!1}}return!(!this.networkEnabled||!this.inForeground)||Ig(e).W().next((e=>void 0===this.Ei(e,5e3).find((e=>{if(this.clientId!==e.clientId){const t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))))})).next((e=>(this.isPrimary!==e&&ku("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e)))}async shutdown(){this.xs=!1,this.bi(),this.si&&(this.si.cancel(),this.si=null),this.vi(),this.Pi(),await this.ui.runTransaction("shutdown","readwrite",["owner","clientMetadata"],(e=>{const t=new Np(e,kl.at);return this.mi(t).next((()=>this.pi(t)))})),this.ui.close(),this.Vi()}Ei(e,t){return e.filter((e=>this.Ti(e.updateTimeMs,t)&&!this.Ri(e.clientId)))}Si(){return this.runTransaction("getActiveClients","readonly",(e=>Ig(e).W().next((e=>this.Ei(e,18e5).map((e=>e.clientId))))))}get started(){return this.xs}getMutationQueue(e,t){return xm.ue(e,this.Tt,t,this.referenceDelegate)}getTargetCache(){return this.Ns}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new bm(e,this.Tt.oe.databaseId)}getDocumentOverlayCache(e){return Xp.ue(this.Tt,e)}getBundleCache(){return this.Os}runTransaction(e,t,n){ku("IndexedDbPersistence","Starting transaction:",e);const r="readonly"===t?"readonly":"readwrite",i=15===(s=this.ti)?Cp:14===s?Ap:13===s?kp:12===s?Sp:11===s?Ep:void Du();var s;let o;return this.ui.runTransaction(e,r,i,(r=>(o=new Np(r,this.Cs?this.Cs.next():kl.at),"readwrite-primary"===t?this._i(o).next((e=>!!e||this.wi(o))).next((t=>{if(!t)throw Au(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Ys.enqueueRetryable((()=>this.ri(!1))),new Pu(Ou.FAILED_PRECONDITION,hl);return n(o)})).next((e=>this.gi(o).next((()=>e)))):this.Di(o).next((()=>n(o)))))).then((e=>(o.raiseOnCommittedEvent(),e)))}Di(e){return wg(e).get("owner").next((e=>{if(null!==e&&this.Ti(e.leaseTimestampMs,5e3)&&!this.Ri(e.ownerId)&&!this.yi(e)&&!(this.Xs||this.allowTabSynchronization&&e.allowTabSynchronization))throw new Pu(Ou.FAILED_PRECONDITION,yg)}))}gi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return wg(e).put("owner",t)}static C(){return gl.C()}mi(e){const t=wg(e);return t.get("owner").next((e=>this.yi(e)?(ku("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):pl.resolve()))}Ti(e,t){const n=Date.now();return!(e<n-t||e>n&&(Au(`Detected an update time that is in the future: ${e} > ${n}`),1))}hi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ni=()=>{this.Ys.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.ai())))},this.document.addEventListener("visibilitychange",this.ni),this.inForeground="visible"===this.document.visibilityState)}vi(){this.ni&&(this.document.removeEventListener("visibilitychange",this.ni),this.ni=null)}li(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ei=()=>{this.bi(),!d()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")&&navigator.appVersion.match(/Version\/1[45]/)&&this.Ys.enterRestrictedMode(!0),this.Ys.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.ei))}Pi(){this.ei&&(this.window.removeEventListener("pagehide",this.ei),this.ei=null)}Ri(e){var t;try{const n=null!==(null===(t=this.ci)||void 0===t?void 0:t.getItem(this.Ai(e)));return ku("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return Au("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}bi(){if(this.ci)try{this.ci.setItem(this.Ai(this.clientId),String(Date.now()))}catch(e){Au("Failed to set zombie client id.",e)}}Vi(){if(this.ci)try{this.ci.removeItem(this.Ai(this.clientId))}catch(e){}}Ai(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function wg(e){return Dp(e,"owner")}function Ig(e){return Dp(e,"clientMetadata")}function bg(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class _g{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Ci=n,this.xi=r}static Ni(e,t){let n=df(),r=df();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new _g(e,t.fromCache,n,r)}}class Tg{constructor(){this.ki=!1}initialize(e,t){this.Oi=e,this.indexManager=t,this.ki=!0}getDocumentsMatchingQuery(e,t,n,r){return this.Mi(e,t).next((i=>i||this.Fi(e,t,r,n))).next((n=>n||this.$i(e,t)))}Mi(e,t){if(nd(t))return pl.resolve(null);let n=ad(t);return this.indexManager.getIndexType(e,n).next((r=>0===r?null:(null!==t.limit&&1===r&&(t=ud(t,null,"F"),n=ad(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((r=>{const i=df(...r);return this.Oi.getDocuments(e,i).next((r=>this.indexManager.getMinOffset(e,n).next((n=>{const s=this.Bi(t,r);return this.Li(t,s,i,n.readTime)?this.Mi(e,ud(t,null,"F")):this.qi(e,s,t,n)}))))})))))}Fi(e,t,n,r){return nd(t)||r.isEqual(Xu.min())?this.$i(e,t):this.Oi.getDocuments(e,n).next((i=>{const s=this.Bi(t,i);return this.Li(t,s,n,r)?this.$i(e,t):(Su()<=L.DEBUG&&ku("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),dd(t)),this.qi(e,s,t,al(r,-1)))}))}Bi(e,t){let n=new Vh(md(e));return t.forEach(((t,r)=>{fd(e,r)&&(n=n.add(r))})),n}Li(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}$i(e,t){return Su()<=L.DEBUG&&ku("QueryEngine","Using full collection scan to execute query:",dd(t)),this.Oi.getDocumentsMatchingQuery(e,t,ul.min())}qi(e,t,n,r){return this.Oi.getDocumentsMatchingQuery(e,n,r).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}class Eg{constructor(e,t,n,r){this.persistence=e,this.Ui=t,this.Tt=r,this.Ki=new Lh($u),this.Gi=new ef((e=>Wh(e)),Hh),this.Qi=new Map,this.ji=e.getRemoteDocumentCache(),this.Ns=e.getTargetCache(),this.Os=e.getBundleCache(),this.zi(n)}zi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new rg(this.ji,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ji.setIndexManager(this.indexManager),this.Ui.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ki)))}}function Sg(e,t,n,r){return new Eg(e,t,n,r)}async function kg(e,t){const n=Ru(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next((i=>(r=i,n.zi(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const i=[],s=[];let o=df();for(const e of r){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next((e=>({Wi:e,removedBatchIds:i,addedBatchIds:s})))}))}))}function Ag(e){const t=Ru(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Ns.getLastRemoteSnapshotVersion(e)))}function Cg(e,t,n){let r=df(),i=df();return n.forEach((e=>r=r.add(e))),t.getEntries(e,r).next((e=>{let r=nf();return n.forEach(((n,s)=>{const o=e.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(Xu.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):ku("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{Hi:r,Ji:i}}))}function Ng(e,t){const n=Ru(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}function Dg(e,t){const n=Ru(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let r;return n.Ns.getTargetData(e,t).next((i=>i?(r=i,pl.resolve(r)):n.Ns.allocateTargetId(e).next((i=>(r=new Pp(t,i,0,e.currentSequenceNumber),n.Ns.addTargetData(e,r).next((()=>r)))))))})).then((e=>{const r=n.Ki.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Ki=n.Ki.insert(e.targetId,e),n.Gi.set(t,e.targetId)),e}))}async function xg(e,t,n){const r=Ru(e),i=r.Ki.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(e){if(!wl(e))throw e;ku("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.Ki=r.Ki.remove(t),r.Gi.delete(i.target)}function Rg(e,t,n){const r=Ru(e);let i=Xu.min(),s=df();return r.persistence.runTransaction("Execute query","readonly",(e=>function(e,t,n){const r=Ru(e),i=r.Gi.get(n);return void 0!==i?pl.resolve(r.Ki.get(i)):r.Ns.getTargetData(t,n)}(r,e,ad(t)).next((t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.Ns.getMatchingKeysForTargetId(e,t.targetId).next((e=>{s=e}))})).next((()=>r.Ui.getDocumentsMatchingQuery(e,t,n?i:Xu.min(),n?s:df()))).next((e=>(Lg(r,pd(t),e),{documents:e,Yi:s})))))}function Og(e,t){const n=Ru(e),r=Ru(n.Ns),i=n.Ki.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(e=>r.ie(e,t).next((e=>e?e.target:null))))}function Pg(e,t){const n=Ru(e),r=n.Qi.get(t)||Xu.min();return n.persistence.runTransaction("Get new document changes","readonly",(e=>n.ji.getAllFromCollectionGroup(e,t,al(r,-1),Number.MAX_SAFE_INTEGER))).then((e=>(Lg(n,t,e),e)))}function Lg(e,t,n){let r=e.Qi.get(t)||Xu.min();n.forEach(((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.Qi.set(t,r)}async function Mg(e,t,n=df()){const r=await Dg(e,ad(Kp(t.bundledQuery))),i=Ru(e);return i.persistence.runTransaction("Save named query","readwrite",(e=>{const s=xf(t.readTime);if(r.snapshotVersion.compareTo(s)>=0)return i.Os.saveNamedQuery(e,t);const o=r.withResumeToken(Ml.EMPTY_BYTE_STRING,s);return i.Ki=i.Ki.insert(o.targetId,o),i.Ns.updateTargetData(e,o).next((()=>i.Ns.removeMatchingKeysForTargetId(e,r.targetId))).next((()=>i.Ns.addMatchingKeys(e,n,r.targetId))).next((()=>i.Os.saveNamedQuery(e,t)))}))}function Fg(e,t){return`firestore_clients_${e}_${t}`}function Vg(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function Ug(e,t){return`firestore_targets_${e}_${t}`}class qg{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static er(e,t,n){const r=JSON.parse(n);let i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new Pu(r.error.code,r.error.message))),s?new qg(e,t,r.state,i):(Au("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}nr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Bg{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static er(e,t){const n=JSON.parse(t);let r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(r=new Pu(n.error.code,n.error.message))),i?new Bg(e,n.state,r):(Au("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}nr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class jg{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static er(e,t){const n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,i=pf();for(let e=0;r&&e<n.activeTargetIds.length;++e)r=Pl(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new jg(e,i):(Au("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Kg{constructor(e,t){this.clientId=e,this.onlineState=t}static er(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Kg(t.clientId,t.onlineState):(Au("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Gg{constructor(){this.activeTargetIds=pf()}sr(e){this.activeTargetIds=this.activeTargetIds.add(e)}ir(e){this.activeTargetIds=this.activeTargetIds.delete(e)}nr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class zg{constructor(e,t,n,r,i){this.window=e,this.Ys=t,this.persistenceKey=n,this.rr=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ur=this.cr.bind(this),this.ar=new Lh($u),this.started=!1,this.hr=[];const s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.lr=Fg(this.persistenceKey,this.rr),this.dr=function(e){return`firestore_sequence_number_${e}`}(this.persistenceKey),this.ar=this.ar.insert(this.rr,new Gg),this._r=new RegExp(`^firestore_clients_${s}_([^_]*)$`),this.wr=new RegExp(`^firestore_mutations_${s}_(\\d+)(?:_(.*))?$`),this.mr=new RegExp(`^firestore_targets_${s}_(\\d+)$`),this.gr=function(e){return`firestore_online_state_${e}`}(this.persistenceKey),this.yr=function(e){return`firestore_bundle_loaded_v2_${e}`}(this.persistenceKey),this.window.addEventListener("storage",this.ur)}static C(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Si();for(const t of e){if(t===this.rr)continue;const e=this.getItem(Fg(this.persistenceKey,t));if(e){const n=jg.er(t,e);n&&(this.ar=this.ar.insert(n.clientId,n))}}this.pr();const t=this.storage.getItem(this.gr);if(t){const e=this.Ir(t);e&&this.Tr(e)}for(const e of this.hr)this.cr(e);this.hr=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(e){this.setItem(this.dr,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Er(this.ar)}isActiveQueryTarget(e){let t=!1;return this.ar.forEach(((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)})),t}addPendingMutation(e){this.Ar(e,"pending")}updateMutationState(e,t,n){this.Ar(e,t,n),this.Rr(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const n=this.storage.getItem(Ug(this.persistenceKey,e));if(n){const r=Bg.er(e,n);r&&(t=r.state)}}return this.br.sr(e),this.pr(),t}removeLocalQueryTarget(e){this.br.ir(e),this.pr()}isLocalQueryTarget(e){return this.br.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Ug(this.persistenceKey,e))}updateQueryState(e,t,n){this.vr(e,t,n)}handleUserChange(e,t,n){t.forEach((e=>{this.Rr(e)})),this.currentUser=e,n.forEach((e=>{this.addPendingMutation(e)}))}setOnlineState(e){this.Pr(e)}notifyBundleLoaded(e){this.Vr(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ur),this.removeItem(this.lr),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return ku("SharedClientState","READ",e,t),t}setItem(e,t){ku("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){ku("SharedClientState","REMOVE",e),this.storage.removeItem(e)}cr(e){const t=e;if(t.storageArea===this.storage){if(ku("SharedClientState","EVENT",t.key,t.newValue),t.key===this.lr)return void Au("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Ys.enqueueRetryable((async()=>{if(this.started){if(null!==t.key)if(this._r.test(t.key)){if(null==t.newValue){const e=this.Sr(t.key);return this.Dr(e,null)}{const e=this.Cr(t.key,t.newValue);if(e)return this.Dr(e.clientId,e)}}else if(this.wr.test(t.key)){if(null!==t.newValue){const e=this.Nr(t.key,t.newValue);if(e)return this.kr(e)}}else if(this.mr.test(t.key)){if(null!==t.newValue){const e=this.Or(t.key,t.newValue);if(e)return this.Mr(e)}}else if(t.key===this.gr){if(null!==t.newValue){const e=this.Ir(t.newValue);if(e)return this.Tr(e)}}else if(t.key===this.dr){const e=function(e){let t=kl.at;if(null!=e)try{const n=JSON.parse(e);xu("number"==typeof n),t=n}catch(e){Au("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(t.newValue);e!==kl.at&&this.sequenceNumberHandler(e)}else if(t.key===this.yr){const e=this.Fr(t.newValue);await Promise.all(e.map((e=>this.syncEngine.$r(e))))}}else this.hr.push(t)}))}}get br(){return this.ar.get(this.rr)}pr(){this.setItem(this.lr,this.br.nr())}Ar(e,t,n){const r=new qg(this.currentUser,e,t,n),i=Vg(this.persistenceKey,this.currentUser,e);this.setItem(i,r.nr())}Rr(e){const t=Vg(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Pr(e){const t={clientId:this.rr,onlineState:e};this.storage.setItem(this.gr,JSON.stringify(t))}vr(e,t,n){const r=Ug(this.persistenceKey,e),i=new Bg(e,t,n);this.setItem(r,i.nr())}Vr(e){const t=JSON.stringify(Array.from(e));this.setItem(this.yr,t)}Sr(e){const t=this._r.exec(e);return t?t[1]:null}Cr(e,t){const n=this.Sr(e);return jg.er(n,t)}Nr(e,t){const n=this.wr.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return qg.er(new _u(i),r,t)}Or(e,t){const n=this.mr.exec(e),r=Number(n[1]);return Bg.er(r,t)}Ir(e){return Kg.er(e)}Fr(e){return JSON.parse(e)}async kr(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Br(e.batchId,e.state,e.error);ku("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Mr(e){return this.syncEngine.Lr(e.targetId,e.state,e.error)}Dr(e,t){const n=t?this.ar.insert(e,t):this.ar.remove(e),r=this.Er(this.ar),i=this.Er(n),s=[],o=[];return i.forEach((e=>{r.has(e)||s.push(e)})),r.forEach((e=>{i.has(e)||o.push(e)})),this.syncEngine.qr(s,o).then((()=>{this.ar=n}))}Tr(e){this.ar.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Er(e){let t=pf();return e.forEach(((e,n)=>{t=t.unionWith(n.activeTargetIds)})),t}}class $g{constructor(){this.Ur=new Gg,this.Kr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Ur.sr(e),this.Kr[e]||"not-current"}updateQueryState(e,t,n){this.Kr[e]=t}removeLocalQueryTarget(e){this.Ur.ir(e)}isLocalQueryTarget(e){return this.Ur.activeTargetIds.has(e)}clearQueryState(e){delete this.Kr[e]}getAllActiveQueryTargets(){return this.Ur.activeTargetIds}isActiveQueryTarget(e){return this.Ur.activeTargetIds.has(e)}start(){return this.Ur=new Gg,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Wg{Gr(e){}shutdown(){}}class Hg{constructor(){this.Qr=()=>this.jr(),this.zr=()=>this.Wr(),this.Hr=[],this.Jr()}Gr(e){this.Hr.push(e)}shutdown(){window.removeEventListener("online",this.Qr),window.removeEventListener("offline",this.zr)}Jr(){window.addEventListener("online",this.Qr),window.addEventListener("offline",this.zr)}jr(){ku("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Hr)e(0)}Wr(){ku("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Hr)e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const Qg={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Xg{constructor(e){this.Yr=e.Yr,this.Zr=e.Zr}Xr(e){this.eo=e}no(e){this.so=e}onMessage(e){this.io=e}close(){this.Zr()}send(e){this.Yr(e)}ro(){this.eo()}oo(e){this.so(e)}uo(e){this.io(e)}}class Yg extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http";this.co=t+"://"+e.host,this.ao="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get ho(){return!1}lo(e,t,n,r,i){const s=this.fo(e,t);ku("RestConnection","Sending: ",s,n);const o={};return this._o(o,r,i),this.wo(e,s,o,n).then((e=>(ku("RestConnection","Received: ",e),e)),(t=>{throw Cu("RestConnection",`${e} failed with error: `,t,"url: ",s,"request:",n),t}))}mo(e,t,n,r,i,s){return this.lo(e,t,n,r,i)}_o(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+Tu,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}fo(e,t){const n=Qg[e];return`${this.co}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}wo(e,t,n,r){return new Promise(((i,s)=>{const o=new Iu;o.setWithCredentials(!0),o.listenOnce(mu.COMPLETE,(()=>{try{switch(o.getLastErrorCode()){case pu.NO_ERROR:const t=o.getResponseJson();ku("Connection","XHR received:",JSON.stringify(t)),i(t);break;case pu.TIMEOUT:ku("Connection",'RPC "'+e+'" timed out'),s(new Pu(Ou.DEADLINE_EXCEEDED,"Request time out"));break;case pu.HTTP_ERROR:const n=o.getStatus();if(ku("Connection",'RPC "'+e+'" failed with status:',n,"response text:",o.getResponseText()),n>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(Ou).indexOf(t)>=0?t:Ou.UNKNOWN}(t.status);s(new Pu(e,t.message))}else s(new Pu(Ou.UNKNOWN,"Server responded with status "+o.getStatus()))}else s(new Pu(Ou.UNAVAILABLE,"Connection failed."));break;default:Du()}}finally{ku("Connection",'RPC "'+e+'" completed.')}}));const a=JSON.stringify(r);o.send(t,"POST",a,n,15)}))}yo(e,t,n){const r=[this.co,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=du(),s=fu(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new vu({})),this._o(o.initMessageHeaders,t,n),o.encodeInitMessageHeaders=!0;const a=r.join("");ku("Connection","Creating WebChannel: "+a,o);const c=i.createWebChannel(a,o);let u=!1,l=!1;const h=new Xg({Yr:e=>{l?ku("Connection","Not sending because WebChannel is closed:",e):(u||(ku("Connection","Opening WebChannel transport."),c.open(),u=!0),ku("Connection","WebChannel sending:",e),c.send(e))},Zr:()=>c.close()}),d=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return d(c,wu.EventType.OPEN,(()=>{l||ku("Connection","WebChannel transport opened.")})),d(c,wu.EventType.CLOSE,(()=>{l||(l=!0,ku("Connection","WebChannel transport closed"),h.oo())})),d(c,wu.EventType.ERROR,(e=>{l||(l=!0,Cu("Connection","WebChannel transport errored:",e),h.oo(new Pu(Ou.UNAVAILABLE,"The operation could not be completed")))})),d(c,wu.EventType.MESSAGE,(e=>{var t;if(!l){const n=e.data[0];xu(!!n);const r=n,i=r.error||(null===(t=r[0])||void 0===t?void 0:t.error);if(i){ku("Connection","WebChannel received error:",i);const e=i.status;let t=function(e){const t=Xd[e];if(void 0!==t)return Zd(t)}(e),n=i.message;void 0===t&&(t=Ou.INTERNAL,n="Unknown error status: "+e+" with message "+i.message),l=!0,h.oo(new Pu(t,n)),c.close()}else ku("Connection","WebChannel received:",n),h.uo(n)}})),d(s,gu.STAT_EVENT,(e=>{e.stat===yu.PROXY?ku("Connection","Detected buffering proxy"):e.stat===yu.NOPROXY&&ku("Connection","Detected no buffering proxy")})),setTimeout((()=>{h.ro()}),0),h}}function Jg(){return"undefined"!=typeof window?window:null}function Zg(){return"undefined"!=typeof document?document:null}function ey(e){return new Af(e,!0)}class ty{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Ys=e,this.timerId=t,this.po=n,this.Io=r,this.To=i,this.Eo=0,this.Ao=null,this.Ro=Date.now(),this.reset()}reset(){this.Eo=0}bo(){this.Eo=this.To}vo(e){this.cancel();const t=Math.floor(this.Eo+this.Po()),n=Math.max(0,Date.now()-this.Ro),r=Math.max(0,t-n);r>0&&ku("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Eo} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Ao=this.Ys.enqueueAfterDelay(this.timerId,r,(()=>(this.Ro=Date.now(),e()))),this.Eo*=this.Io,this.Eo<this.po&&(this.Eo=this.po),this.Eo>this.To&&(this.Eo=this.To)}Vo(){null!==this.Ao&&(this.Ao.skipDelay(),this.Ao=null)}cancel(){null!==this.Ao&&(this.Ao.cancel(),this.Ao=null)}Po(){return(Math.random()-.5)*this.Eo}}class ny{constructor(e,t,n,r,i,s,o,a){this.Ys=e,this.So=n,this.Do=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Co=0,this.xo=null,this.No=null,this.stream=null,this.ko=new ty(e,t)}Oo(){return 1===this.state||5===this.state||this.Mo()}Mo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Fo()}async stop(){this.Oo()&&await this.close(0)}$o(){this.state=0,this.ko.reset()}Bo(){this.Mo()&&null===this.xo&&(this.xo=this.Ys.enqueueAfterDelay(this.So,6e4,(()=>this.Lo())))}qo(e){this.Uo(),this.stream.send(e)}async Lo(){if(this.Mo())return this.close(0)}Uo(){this.xo&&(this.xo.cancel(),this.xo=null)}Ko(){this.No&&(this.No.cancel(),this.No=null)}async close(e,t){this.Uo(),this.Ko(),this.ko.cancel(),this.Co++,4!==e?this.ko.reset():t&&t.code===Ou.RESOURCE_EXHAUSTED?(Au(t.toString()),Au("Using maximum backoff delay to prevent overloading the backend."),this.ko.bo()):t&&t.code===Ou.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Go(),this.stream.close(),this.stream=null),this.state=e,await this.listener.no(t)}Go(){}auth(){this.state=1;const e=this.Qo(this.Co),t=this.Co;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.Co===t&&this.jo(e,n)}),(t=>{e((()=>{const e=new Pu(Ou.UNKNOWN,"Fetching auth token failed: "+t.message);return this.zo(e)}))}))}jo(e,t){const n=this.Qo(this.Co);this.stream=this.Wo(e,t),this.stream.Xr((()=>{n((()=>(this.state=2,this.No=this.Ys.enqueueAfterDelay(this.Do,1e4,(()=>(this.Mo()&&(this.state=3),Promise.resolve()))),this.listener.Xr())))})),this.stream.no((e=>{n((()=>this.zo(e)))})),this.stream.onMessage((e=>{n((()=>this.onMessage(e)))}))}Fo(){this.state=5,this.ko.vo((async()=>{this.state=0,this.start()}))}zo(e){return ku("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Qo(e){return t=>{this.Ys.enqueueAndForget((()=>this.Co===e?t():(ku("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class ry extends ny{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.Tt=i}Wo(e,t){return this.connection.yo("Listen",e,t)}onMessage(e){this.ko.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Du()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(e,t){return e.yt?(xu(void 0===t||"string"==typeof t),Ml.fromBase64String(t||"")):(xu(void 0===t||t instanceof Uint8Array),Ml.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?Ou.UNKNOWN:Zd(e.code);return new Pu(t,e.message||"")}(o);n=new wf(r,i,s,a||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=Lf(e,r.document.name),s=xf(r.document.updateTime),o=r.document.createTime?xf(r.document.createTime):Xu.min(),a=new jh({mapValue:{fields:r.document.fields}}),c=Gh.newFoundDocument(i,s,o,a),u=r.targetIds||[],l=r.removedTargetIds||[];n=new yf(u,l,c.key,c)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=Lf(e,r.document),s=r.readTime?xf(r.readTime):Xu.min(),o=Gh.newNoDocument(i,s),a=r.removedTargetIds||[];n=new yf([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=Lf(e,r.document),s=r.removedTargetIds||[];n=new yf([],s,i,null)}else{if(!("filter"in t))return Du();{t.filter;const e=t.filter;e.targetId;const r=e.count||0,i=new Qd(r),s=e.targetId;n=new vf(s,i)}}return n}(this.Tt,e),n=function(e){if(!("targetChange"in e))return Xu.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?Xu.min():t.readTime?xf(t.readTime):Xu.min()}(e);return this.listener.Ho(t,n)}Jo(e){const t={};t.database=Vf(this.Tt),t.addTarget=function(e,t){let n;const r=t.target;return n=Qh(r)?{documents:Gf(e,r)}:{query:zf(e,r)},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0?n.resumeToken=Nf(e,t.resumeToken):t.snapshotVersion.compareTo(Xu.min())>0&&(n.readTime=Cf(e,t.snapshotVersion.toTimestamp())),n}(this.Tt,e);const n=function(e,t){const n=function(e,t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Du()}}(0,t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.Tt,e);n&&(t.labels=n),this.qo(t)}Yo(e){const t={};t.database=Vf(this.Tt),t.removeTarget=e,this.qo(t)}}class iy extends ny{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.Tt=i,this.Zo=!1}get Xo(){return this.Zo}start(){this.Zo=!1,this.lastStreamToken=void 0,super.start()}Go(){this.Zo&&this.tu([])}Wo(e,t){return this.connection.yo("Write",e,t)}onMessage(e){if(xu(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Zo){this.ko.reset();const t=function(e,t){return e&&e.length>0?(xu(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?xf(e.updateTime):xf(t);return n.isEqual(Xu.min())&&(n=xf(t)),new Od(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=xf(e.commitTime);return this.listener.eu(n,t)}return xu(!e.writeResults||0===e.writeResults.length),this.Zo=!0,this.listener.nu()}su(){const e={};e.database=Vf(this.Tt),this.qo(e)}tu(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>jf(this.Tt,e)))};this.qo(t)}}class sy extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.Tt=r,this.iu=!1}ru(){if(this.iu)throw new Pu(Ou.FAILED_PRECONDITION,"The client has already been terminated.")}lo(e,t,n){return this.ru(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,i])=>this.connection.lo(e,t,n,r,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===Ou.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Pu(Ou.UNKNOWN,e.toString())}))}mo(e,t,n,r){return this.ru(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection.mo(e,t,n,i,s,r))).catch((e=>{throw"FirebaseError"===e.name?(e.code===Ou.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Pu(Ou.UNKNOWN,e.toString())}))}terminate(){this.iu=!0}}class oy{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.ou=0,this.uu=null,this.cu=!0}au(){0===this.ou&&(this.hu("Unknown"),this.uu=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.uu=null,this.lu("Backend didn't respond within 10 seconds."),this.hu("Offline"),Promise.resolve()))))}fu(e){"Online"===this.state?this.hu("Unknown"):(this.ou++,this.ou>=1&&(this.du(),this.lu(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.hu("Offline")))}set(e){this.du(),this.ou=0,"Online"===e&&(this.cu=!1),this.hu(e)}hu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}lu(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.cu?(Au(t),this.cu=!1):ku("OnlineStateTracker",t)}du(){null!==this.uu&&(this.uu.cancel(),this.uu=null)}}class ay{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this._u=[],this.wu=new Map,this.mu=new Set,this.gu=[],this.yu=i,this.yu.Gr((e=>{n.enqueueAndForget((async()=>{gy(this)&&(ku("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=Ru(e);t.mu.add(4),await uy(t),t.pu.set("Unknown"),t.mu.delete(4),await cy(t)}(this))}))})),this.pu=new oy(n,r)}}async function cy(e){if(gy(e))for(const t of e.gu)await t(!0)}async function uy(e){for(const t of e.gu)await t(!1)}function ly(e,t){const n=Ru(e);n.wu.has(t.targetId)||(n.wu.set(t.targetId,t),my(n)?py(n):Py(n).Mo()&&dy(n,t))}function hy(e,t){const n=Ru(e),r=Py(n);n.wu.delete(t),r.Mo()&&fy(n,t),0===n.wu.size&&(r.Mo()?r.Bo():gy(n)&&n.pu.set("Unknown"))}function dy(e,t){e.Iu.Ft(t.targetId),Py(e).Jo(t)}function fy(e,t){e.Iu.Ft(t),Py(e).Yo(t)}function py(e){e.Iu=new bf({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),ie:t=>e.wu.get(t)||null}),Py(e).start(),e.pu.au()}function my(e){return gy(e)&&!Py(e).Oo()&&e.wu.size>0}function gy(e){return 0===Ru(e).mu.size}function yy(e){e.Iu=void 0}async function vy(e){e.wu.forEach(((t,n)=>{dy(e,t)}))}async function wy(e,t){yy(e),my(e)?(e.pu.fu(t),py(e)):e.pu.set("Unknown")}async function Iy(e,t,n){if(e.pu.set("Online"),t instanceof wf&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.wu.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.wu.delete(r),e.Iu.removeTarget(r))}(e,t)}catch(n){ku("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await by(e,n)}else if(t instanceof yf?e.Iu.Qt(t):t instanceof vf?e.Iu.Zt(t):e.Iu.Wt(t),!n.isEqual(Xu.min()))try{const t=await Ag(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.Iu.ee(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.wu.get(r);i&&e.wu.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach((t=>{const n=e.wu.get(t);if(!n)return;e.wu.set(t,n.withResumeToken(Ml.EMPTY_BYTE_STRING,n.snapshotVersion)),fy(e,t);const r=new Pp(n.target,t,1,n.sequenceNumber);dy(e,r)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){ku("RemoteStore","Failed to raise snapshot:",t),await by(e,t)}}async function by(e,t,n){if(!wl(t))throw t;e.mu.add(1),await uy(e),e.pu.set("Offline"),n||(n=()=>Ag(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{ku("RemoteStore","Retrying IndexedDB access"),await n(),e.mu.delete(1),await cy(e)}))}function _y(e,t){return t().catch((n=>by(e,n,t)))}async function Ty(e){const t=Ru(e),n=Ly(t);let r=t._u.length>0?t._u[t._u.length-1].batchId:-1;for(;Ey(t);)try{const e=await Ng(t.localStore,r);if(null===e){0===t._u.length&&n.Bo();break}r=e.batchId,Sy(t,e)}catch(e){await by(t,e)}ky(t)&&Ay(t)}function Ey(e){return gy(e)&&e._u.length<10}function Sy(e,t){e._u.push(t);const n=Ly(e);n.Mo()&&n.Xo&&n.tu(t.mutations)}function ky(e){return gy(e)&&!Ly(e).Oo()&&e._u.length>0}function Ay(e){Ly(e).start()}async function Cy(e){Ly(e).su()}async function Ny(e){const t=Ly(e);for(const n of e._u)t.tu(n.mutations)}async function Dy(e,t,n){const r=e._u.shift(),i=Rp.from(r,t,n);await _y(e,(()=>e.remoteSyncer.applySuccessfulWrite(i))),await Ty(e)}async function xy(e,t){t&&Ly(e).Xo&&await async function(e,t){if(Jd(n=t.code)&&n!==Ou.ABORTED){const n=e._u.shift();Ly(e).$o(),await _y(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await Ty(e)}var n}(e,t),ky(e)&&Ay(e)}async function Ry(e,t){const n=Ru(e);n.asyncQueue.verifyOperationInProgress(),ku("RemoteStore","RemoteStore received new credentials");const r=gy(n);n.mu.add(3),await uy(n),r&&n.pu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.mu.delete(3),await cy(n)}async function Oy(e,t){const n=Ru(e);t?(n.mu.delete(2),await cy(n)):t||(n.mu.add(2),await uy(n),n.pu.set("Unknown"))}function Py(e){return e.Tu||(e.Tu=function(e,t,n){const r=Ru(e);return r.ru(),new ry(t,r.connection,r.authCredentials,r.appCheckCredentials,r.Tt,n)}(e.datastore,e.asyncQueue,{Xr:vy.bind(null,e),no:wy.bind(null,e),Ho:Iy.bind(null,e)}),e.gu.push((async t=>{t?(e.Tu.$o(),my(e)?py(e):e.pu.set("Unknown")):(await e.Tu.stop(),yy(e))}))),e.Tu}function Ly(e){return e.Eu||(e.Eu=function(e,t,n){const r=Ru(e);return r.ru(),new iy(t,r.connection,r.authCredentials,r.appCheckCredentials,r.Tt,n)}(e.datastore,e.asyncQueue,{Xr:Cy.bind(null,e),no:xy.bind(null,e),nu:Ny.bind(null,e),eu:Dy.bind(null,e)}),e.gu.push((async t=>{t?(e.Eu.$o(),await Ty(e)):(await e.Eu.stop(),e._u.length>0&&(ku("RemoteStore",`Stopping write stream with ${e._u.length} pending writes`),e._u=[]))}))),e.Eu}class My{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Lu,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new My(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Pu(Ou.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Fy(e,t){if(Au("AsyncQueue",`${t}: ${e}`),wl(e))return new Pu(Ou.UNAVAILABLE,`${t}: ${e}`);throw e}class Vy{constructor(e){this.comparator=e?(t,n)=>e(t,n)||tl.comparator(t.key,n.key):(e,t)=>tl.comparator(e.key,t.key),this.keyedMap=sf(),this.sortedSet=new Lh(this.comparator)}static emptySet(e){return new Vy(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Vy))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Vy;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Uy{constructor(){this.Au=new Lh(tl.comparator)}track(e){const t=e.doc.key,n=this.Au.get(t);n?0!==e.type&&3===n.type?this.Au=this.Au.insert(t,e):3===e.type&&1!==n.type?this.Au=this.Au.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Au=this.Au.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Au=this.Au.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Au=this.Au.remove(t):1===e.type&&2===n.type?this.Au=this.Au.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Au=this.Au.insert(t,{type:2,doc:e.doc}):Du():this.Au=this.Au.insert(t,e)}Ru(){const e=[];return this.Au.inorderTraversal(((t,n)=>{e.push(n)})),e}}class qy{constructor(e,t,n,r,i,s,o,a,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach((e=>{s.push({type:0,doc:e})})),new qy(e,t,Vy.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ld(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class By{constructor(){this.bu=void 0,this.listeners=[]}}class jy{constructor(){this.queries=new ef((e=>hd(e)),ld),this.onlineState="Unknown",this.vu=new Set}}async function Ky(e,t){const n=Ru(e),r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new By),i)try{s.bu=await n.onListen(r)}catch(e){const n=Fy(e,`Initialization of query '${dd(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,s),s.listeners.push(t),t.Pu(n.onlineState),s.bu&&t.Vu(s.bu)&&Wy(n)}async function Gy(e,t){const n=Ru(e),r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function zy(e,t){const n=Ru(e);let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.listeners)t.Vu(e)&&(r=!0);i.bu=e}}r&&Wy(n)}function $y(e,t,n){const r=Ru(e),i=r.queries.get(t);if(i)for(const e of i.listeners)e.onError(n);r.queries.delete(t)}function Wy(e){e.vu.forEach((e=>{e.next()}))}class Hy{constructor(e,t,n){this.query=e,this.Su=t,this.Du=!1,this.Cu=null,this.onlineState="Unknown",this.options=n||{}}Vu(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new qy(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Du?this.xu(e)&&(this.Su.next(e),t=!0):this.Nu(e,this.onlineState)&&(this.ku(e),t=!0),this.Cu=e,t}onError(e){this.Su.error(e)}Pu(e){this.onlineState=e;let t=!1;return this.Cu&&!this.Du&&this.Nu(this.Cu,e)&&(this.ku(this.Cu),t=!0),t}Nu(e,t){if(!e.fromCache)return!0;const n="Offline"!==t;return(!this.options.Ou||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}xu(e){if(e.docChanges.length>0)return!0;const t=this.Cu&&this.Cu.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ku(e){e=qy.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Du=!0,this.Su.next(e)}}class Qy{constructor(e,t){this.Mu=e,this.byteLength=t}Fu(){return"metadata"in this.Mu}}class Xy{constructor(e){this.Tt=e}Zi(e){return Lf(this.Tt,e)}Xi(e){return e.metadata.exists?Bf(this.Tt,e.document,!1):Gh.newNoDocument(this.Zi(e.metadata.name),this.tr(e.metadata.readTime))}tr(e){return xf(e)}}class Yy{constructor(e,t,n){this.$u=e,this.localStore=t,this.Tt=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Jy(e)}Bu(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Mu.namedQuery)this.queries.push(e.Mu.namedQuery);else if(e.Mu.documentMetadata){this.documents.push({metadata:e.Mu.documentMetadata}),e.Mu.documentMetadata.exists||++t;const n=Ju.fromString(e.Mu.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.Mu.document&&(this.documents[this.documents.length-1].document=e.Mu.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}Lu(e){const t=new Map,n=new Xy(this.Tt);for(const r of e)if(r.metadata.queries){const e=n.Zi(r.metadata.name);for(const n of r.metadata.queries){const r=(t.get(n)||df()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const i=Ru(e);let s=df(),o=nf();for(const e of n){const n=t.Zi(e.metadata.name);e.document&&(s=s.add(n));const r=t.Xi(e);r.setReadTime(t.tr(e.metadata.readTime)),o=o.insert(n,r)}const a=i.ji.newChangeBuffer({trackRemovals:!0}),c=await Dg(i,function(e){return ad(td(Ju.fromString(`__bundle__/docs/${e}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",(e=>Cg(e,a,o).next((t=>(a.apply(e),t))).next((t=>i.Ns.removeMatchingKeysForTargetId(e,c.targetId).next((()=>i.Ns.addMatchingKeys(e,s,c.targetId))).next((()=>i.localDocuments.getLocalViewOfDocuments(e,t.Hi,t.Ji))).next((()=>t.Hi))))))}(this.localStore,new Xy(this.Tt),this.documents,this.$u.id),t=this.Lu(this.documents);for(const e of this.queries)await Mg(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,qu:this.collectionGroups,Uu:e}}}function Jy(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class Zy{constructor(e){this.key=e}}class ev{constructor(e){this.key=e}}class tv{constructor(e,t){this.query=e,this.Ku=t,this.Gu=null,this.hasCachedResults=!1,this.current=!1,this.Qu=df(),this.mutatedKeys=df(),this.ju=md(e),this.zu=new Vy(this.ju)}get Wu(){return this.Ku}Hu(e,t){const n=t?t.Ju:new Uy,r=t?t.zu:this.zu;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{const u=r.get(e),l=fd(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;u&&l?u.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.Yu(u,l)||(n.track({type:2,doc:l}),f=!0,(a&&this.ju(l,a)>0||c&&this.ju(l,c)<0)&&(o=!0)):!u&&l?(n.track({type:0,doc:l}),f=!0):u&&!l&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(l?(s=s.add(l),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{zu:s,Ju:n,Li:o,mutatedKeys:i}}Yu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){const r=this.zu;this.zu=e.zu,this.mutatedKeys=e.mutatedKeys;const i=e.Ju.Ru();i.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Du()}};return n(e)-n(t)}(e.type,t.type)||this.ju(e.doc,t.doc))),this.Zu(n);const s=t?this.Xu():[],o=0===this.Qu.size&&this.current?1:0,a=o!==this.Gu;return this.Gu=o,0!==i.length||a?{snapshot:new qy(this.query,e.zu,r,i,e.mutatedKeys,0===o,a,!1,!!n&&n.resumeToken.approximateByteSize()>0),tc:s}:{tc:s}}Pu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({zu:this.zu,Ju:new Uy,mutatedKeys:this.mutatedKeys,Li:!1},!1)):{tc:[]}}ec(e){return!this.Ku.has(e)&&!!this.zu.has(e)&&!this.zu.get(e).hasLocalMutations}Zu(e){e&&(e.addedDocuments.forEach((e=>this.Ku=this.Ku.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.Ku=this.Ku.delete(e))),this.current=e.current)}Xu(){if(!this.current)return[];const e=this.Qu;this.Qu=df(),this.zu.forEach((e=>{this.ec(e.key)&&(this.Qu=this.Qu.add(e.key))}));const t=[];return e.forEach((e=>{this.Qu.has(e)||t.push(new ev(e))})),this.Qu.forEach((n=>{e.has(n)||t.push(new Zy(n))})),t}nc(e){this.Ku=e.Yi,this.Qu=df();const t=this.Hu(e.documents);return this.applyChanges(t,!0)}sc(){return qy.fromInitialDocuments(this.query,this.zu,this.mutatedKeys,0===this.Gu,this.hasCachedResults)}}class nv{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class rv{constructor(e){this.key=e,this.ic=!1}}class iv{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.rc={},this.oc=new ef((e=>hd(e)),ld),this.uc=new Map,this.cc=new Set,this.ac=new Lh(tl.comparator),this.hc=new Map,this.lc=new og,this.fc={},this.dc=new Map,this._c=Mm.Sn(),this.onlineState="Unknown",this.wc=void 0}get isPrimaryClient(){return!0===this.wc}}async function sv(e,t){const n=xv(e);let r,i;const s=n.oc.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.sc();else{const e=await Dg(n.localStore,ad(t));n.isPrimaryClient&&ly(n.remoteStore,e);const s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=await ov(n,t,r,"current"===s,e.resumeToken)}return i}async function ov(e,t,n,r,i){e.mc=(t,n,r)=>async function(e,t,n,r){let i=t.view.Hu(n);i.Li&&(i=await Rg(e.localStore,t.query,!1).then((({documents:e})=>t.view.Hu(e,i))));const s=r&&r.targetChanges.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s);return yv(e,t.targetId,o.tc),o.snapshot}(e,t,n,r);const s=await Rg(e.localStore,t,!0),o=new tv(t,s.Yi),a=o.Hu(s.documents),c=gf.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=o.applyChanges(a,e.isPrimaryClient,c);yv(e,n,u.tc);const l=new nv(t,n,o);return e.oc.set(t,l),e.uc.has(n)?e.uc.get(n).push(t):e.uc.set(n,[t]),u.snapshot}async function av(e,t){const n=Ru(e),r=n.oc.get(t),i=n.uc.get(r.targetId);if(i.length>1)return n.uc.set(r.targetId,i.filter((e=>!ld(e,t)))),void n.oc.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await xg(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),hy(n.remoteStore,r.targetId),mv(n,r.targetId)})).catch(fl)):(mv(n,r.targetId),await xg(n.localStore,r.targetId,!0))}async function cv(e,t){const n=Ru(e);try{const e=await function(e,t){const n=Ru(e),r=t.snapshotVersion;let i=n.Ki;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const s=n.ji.newChangeBuffer({trackRemovals:!0});i=n.Ki;const o=[];t.targetChanges.forEach(((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.Ns.removeMatchingKeys(e,s.removedDocuments,a).next((()=>n.Ns.addMatchingKeys(e,s.addedDocuments,a))));let u=c.withSequenceNumber(e.currentSequenceNumber);t.targetMismatches.has(a)?u=u.withResumeToken(Ml.EMPTY_BYTE_STRING,Xu.min()).withLastLimboFreeSnapshotVersion(Xu.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&o.push(n.Ns.updateTargetData(e,u))}));let a=nf(),c=df();if(t.documentUpdates.forEach((r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push(Cg(e,s,t.documentUpdates).next((e=>{a=e.Hi,c=e.Ji}))),!r.isEqual(Xu.min())){const t=n.Ns.getLastRemoteSnapshotVersion(e).next((t=>n.Ns.setTargetsMetadata(e,e.currentSequenceNumber,r)));o.push(t)}return pl.waitFor(o).next((()=>s.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,a,c))).next((()=>a))})).then((e=>(n.Ki=i,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const r=n.hc.get(t);r&&(xu(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.ic=!0:e.modifiedDocuments.size>0?xu(r.ic):e.removedDocuments.size>0&&(xu(r.ic),r.ic=!1))})),await Iv(n,e,t)}catch(e){await fl(e)}}function uv(e,t,n){const r=Ru(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.oc.forEach(((n,r)=>{const i=r.view.Pu(t);i.snapshot&&e.push(i.snapshot)})),function(e,t){const n=Ru(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(const e of n.listeners)e.Pu(t)&&(r=!0)})),r&&Wy(n)}(r.eventManager,t),e.length&&r.rc.Ho(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function lv(e,t,n){const r=Ru(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.hc.get(t),s=i&&i.key;if(s){let e=new Lh(tl.comparator);e=e.insert(s,Gh.newNoDocument(s,Xu.min()));const n=df().add(s),i=new mf(Xu.min(),new Map,new Vh($u),e,n);await cv(r,i),r.ac=r.ac.remove(s),r.hc.delete(t),wv(r)}else await xg(r.localStore,t,!1).then((()=>mv(r,t,n))).catch(fl)}async function hv(e,t){const n=Ru(e),r=t.batch.batchId;try{const e=await function(e,t){const n=Ru(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const r=t.batch.keys(),i=n.ji.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let o=pl.resolve();return s.forEach((e=>{o=o.next((()=>r.getEntry(t,e))).next((t=>{const s=n.docVersions.get(e);xu(null!==s),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),o.next((()=>e.mutationQueue.removeMutationBatch(t,i)))}(n,e,t,i).next((()=>i.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=df();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(n.localStore,t);pv(n,r,null),fv(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Iv(n,e)}catch(e){await fl(e)}}async function dv(e,t,n){const r=Ru(e);try{const e=await function(e,t){const n=Ru(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(xu(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(r.localStore,t);pv(r,t,n),fv(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await Iv(r,e)}catch(n){await fl(n)}}function fv(e,t){(e.dc.get(t)||[]).forEach((e=>{e.resolve()})),e.dc.delete(t)}function pv(e,t,n){const r=Ru(e);let i=r.fc[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.fc[r.currentUser.toKey()]=i}}function mv(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.uc.get(t))e.oc.delete(r),n&&e.rc.gc(r,n);e.uc.delete(t),e.isPrimaryClient&&e.lc.ds(t).forEach((t=>{e.lc.containsKey(t)||gv(e,t)}))}function gv(e,t){e.cc.delete(t.path.canonicalString());const n=e.ac.get(t);null!==n&&(hy(e.remoteStore,n),e.ac=e.ac.remove(t),e.hc.delete(n),wv(e))}function yv(e,t,n){for(const r of n)r instanceof Zy?(e.lc.addReference(r.key,t),vv(e,r)):r instanceof ev?(ku("SyncEngine","Document no longer in limbo: "+r.key),e.lc.removeReference(r.key,t),e.lc.containsKey(r.key)||gv(e,r.key)):Du()}function vv(e,t){const n=t.key,r=n.path.canonicalString();e.ac.get(n)||e.cc.has(r)||(ku("SyncEngine","New document in limbo: "+n),e.cc.add(r),wv(e))}function wv(e){for(;e.cc.size>0&&e.ac.size<e.maxConcurrentLimboResolutions;){const t=e.cc.values().next().value;e.cc.delete(t);const n=new tl(Ju.fromString(t)),r=e._c.next();e.hc.set(r,new rv(n)),e.ac=e.ac.insert(n,r),ly(e.remoteStore,new Pp(ad(td(n.path)),r,2,kl.at))}}async function Iv(e,t,n){const r=Ru(e),i=[],s=[],o=[];r.oc.isEmpty()||(r.oc.forEach(((e,a)=>{o.push(r.mc(a,t,n).then((e=>{if((e||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,(null==e?void 0:e.fromCache)?"not-current":"current"),e){i.push(e);const t=_g.Ni(a.targetId,e);s.push(t)}})))})),await Promise.all(o),r.rc.Ho(i),await async function(e,t){const n=Ru(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>pl.forEach(t,(t=>pl.forEach(t.Ci,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>pl.forEach(t.xi,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!wl(e))throw e;ku("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.Ki.get(t),r=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(r);n.Ki=n.Ki.insert(t,i)}}}(r.localStore,s))}async function bv(e,t){const n=Ru(e);if(!n.currentUser.isEqual(t)){ku("SyncEngine","User change. New user:",t.toKey());const e=await kg(n.localStore,t);n.currentUser=t,function(e,t){e.dc.forEach((e=>{e.forEach((e=>{e.reject(new Pu(Ou.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.dc.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Iv(n,e.Wi)}}function _v(e,t){const n=Ru(e),r=n.hc.get(t);if(r&&r.ic)return df().add(r.key);{let e=df();const r=n.uc.get(t);if(!r)return e;for(const t of r){const r=n.oc.get(t);e=e.unionWith(r.view.Wu)}return e}}async function Tv(e,t){const n=Ru(e),r=await Rg(n.localStore,t.query,!0),i=t.view.nc(r);return n.isPrimaryClient&&yv(n,t.targetId,i.tc),i}async function Ev(e,t){const n=Ru(e);return Pg(n.localStore,t).then((e=>Iv(n,e)))}async function Sv(e,t,n,r){const i=Ru(e),s=await function(e,t){const n=Ru(e),r=Ru(n.mutationQueue);return n.persistence.runTransaction("Lookup mutation documents","readonly",(e=>r.An(e,t).next((t=>t?n.localDocuments.getDocuments(e,t):pl.resolve(null)))))}(i.localStore,t);null!==s?("pending"===n?await Ty(i.remoteStore):"acknowledged"===n||"rejected"===n?(pv(i,t,r||null),fv(i,t),function(e,t){Ru(Ru(e).mutationQueue).bn(t)}(i.localStore,t)):Du(),await Iv(i,s)):ku("SyncEngine","Cannot apply mutation batch with id: "+t)}async function kv(e,t,n){const r=Ru(e),i=[],s=[];for(const e of t){let t;const n=r.uc.get(e);if(n&&0!==n.length){t=await Dg(r.localStore,ad(n[0]));for(const e of n){const t=r.oc.get(e),n=await Tv(r,t);n.snapshot&&s.push(n.snapshot)}}else{const n=await Og(r.localStore,e);t=await Dg(r.localStore,n),await ov(r,Av(n),e,!1,t.resumeToken)}i.push(t)}return r.rc.Ho(s),i}function Av(e){return ed(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function Cv(e){const t=Ru(e);return Ru(Ru(t.localStore).persistence).Si()}async function Nv(e,t,n,r){const i=Ru(e);if(i.wc)return void ku("SyncEngine","Ignoring unexpected query state notification.");const s=i.uc.get(t);if(s&&s.length>0)switch(n){case"current":case"not-current":{const e=await Pg(i.localStore,pd(s[0])),r=mf.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,Ml.EMPTY_BYTE_STRING);await Iv(i,e,r);break}case"rejected":await xg(i.localStore,t,!0),mv(i,t,r);break;default:Du()}}async function Dv(e,t,n){const r=xv(e);if(r.wc){for(const e of t){if(r.uc.has(e)){ku("SyncEngine","Adding an already active target "+e);continue}const t=await Og(r.localStore,e),n=await Dg(r.localStore,t);await ov(r,Av(t),n.targetId,!1,n.resumeToken),ly(r.remoteStore,n)}for(const e of n)r.uc.has(e)&&await xg(r.localStore,e,!1).then((()=>{hy(r.remoteStore,e),mv(r,e)})).catch(fl)}}function xv(e){const t=Ru(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=cv.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=_v.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=lv.bind(null,t),t.rc.Ho=zy.bind(null,t.eventManager),t.rc.gc=$y.bind(null,t.eventManager),t}function Rv(e){const t=Ru(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=hv.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=dv.bind(null,t),t}class Ov{constructor(){this.synchronizeTabs=!1}async initialize(e){this.Tt=ey(e.databaseInfo.databaseId),this.sharedClientState=this.Ic(e),this.persistence=this.Tc(e),await this.persistence.start(),this.localStore=this.Ec(e),this.gcScheduler=this.Ac(e,this.localStore),this.indexBackfillerScheduler=this.Rc(e,this.localStore)}Ac(e,t){return null}Rc(e,t){return null}Ec(e){return Sg(this.persistence,new Tg,e.initialUser,this.Tt)}Tc(e){return new dg(pg.qs,this.Tt)}Ic(e){return new $g}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Pv extends Ov{constructor(e,t,n){super(),this.bc=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.bc.initialize(this,e),await Rv(this.bc.syncEngine),await Ty(this.bc.remoteStore),await this.persistence.di((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}Ec(e){return Sg(this.persistence,new Tg,e.initialUser,this.Tt)}Ac(e,t){const n=this.persistence.referenceDelegate.garbageCollector;return new Km(n,e.asyncQueue,t)}Rc(e,t){const n=new Sl(t,this.persistence);return new El(e.asyncQueue,n)}Tc(e){const t=bg(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Cm.withCacheSize(this.cacheSizeBytes):Cm.DEFAULT;return new vg(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,Jg(),Zg(),this.Tt,this.sharedClientState,!!this.forceOwnership)}Ic(e){return new $g}}class Lv extends Pv{constructor(e,t){super(e,t,!1),this.bc=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.bc.syncEngine;this.sharedClientState instanceof zg&&(this.sharedClientState.syncEngine={Br:Sv.bind(null,t),Lr:Nv.bind(null,t),qr:Dv.bind(null,t),Si:Cv.bind(null,t),$r:Ev.bind(null,t)},await this.sharedClientState.start()),await this.persistence.di((async e=>{await async function(e,t){const n=Ru(e);if(xv(n),Rv(n),!0===t&&!0!==n.wc){const e=n.sharedClientState.getAllActiveQueryTargets(),t=await kv(n,e.toArray());n.wc=!0,await Oy(n.remoteStore,!0);for(const e of t)ly(n.remoteStore,e)}else if(!1===t&&!1!==n.wc){const e=[];let t=Promise.resolve();n.uc.forEach(((r,i)=>{n.sharedClientState.isLocalQueryTarget(i)?e.push(i):t=t.then((()=>(mv(n,i),xg(n.localStore,i,!0)))),hy(n.remoteStore,i)})),await t,await kv(n,e),function(e){const t=Ru(e);t.hc.forEach(((e,n)=>{hy(t.remoteStore,n)})),t.lc._s(),t.hc=new Map,t.ac=new Lh(tl.comparator)}(n),n.wc=!1,await Oy(n.remoteStore,!1)}}(this.bc.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())}))}Ic(e){const t=Jg();if(!zg.C(t))throw new Pu(Ou.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=bg(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new zg(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class Mv{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>uv(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=bv.bind(null,this.syncEngine),await Oy(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new jy}createDatastore(e){const t=ey(e.databaseInfo.databaseId),n=(r=e.databaseInfo,new Yg(r));var r;return function(e,t,n,r){return new sy(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=e=>uv(this.syncEngine,e,0),s=Hg.C()?new Hg:new Wg,new ay(t,n,r,i,s);var t,n,r,i,s}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new iv(e,t,n,r,i,s);return o&&(a.wc=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=Ru(e);ku("RemoteStore","RemoteStore shutting down."),t.mu.add(5),await uy(t),t.yu.shutdown(),t.pu.set("Unknown")}(this.remoteStore)}}function Fv(e,t=10240){let n=0;return{async read(){if(n<e.byteLength){const r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}class Vv{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.vc(this.observer.next,e)}error(e){this.observer.error?this.vc(this.observer.error,e):Au("Uncaught Error in snapshot listener:",e.toString())}Pc(){this.muted=!0}vc(e,t){this.muted||setTimeout((()=>{this.muted||e(t)}),0)}}class Uv{constructor(e,t){this.Vc=e,this.Tt=t,this.metadata=new Lu,this.buffer=new Uint8Array,this.Sc=new TextDecoder("utf-8"),this.Dc().then((e=>{e&&e.Fu()?this.metadata.resolve(e.Mu.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==e?void 0:e.Mu)}`))}),(e=>this.metadata.reject(e)))}close(){return this.Vc.cancel()}async getMetadata(){return this.metadata.promise}async yc(){return await this.getMetadata(),this.Dc()}async Dc(){const e=await this.Cc();if(null===e)return null;const t=this.Sc.decode(e),n=Number(t);isNaN(n)&&this.xc(`length string (${t}) is not valid number`);const r=await this.Nc(n);return new Qy(JSON.parse(r),e.length+n)}kc(){return this.buffer.findIndex((e=>e==="{".charCodeAt(0)))}async Cc(){for(;this.kc()<0&&!await this.Oc(););if(0===this.buffer.length)return null;const e=this.kc();e<0&&this.xc("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Nc(e){for(;this.buffer.length<e;)await this.Oc()&&this.xc("Reached the end of bundle when more is expected.");const t=this.Sc.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}xc(e){throw this.Vc.cancel(),new Error(`Invalid bundle format: ${e}`)}async Oc(){const e=await this.Vc.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class qv{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new Pu(Ou.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(e,t){const n=Ru(e),r=Vf(n.Tt)+"/documents",i={documents:t.map((e=>Pf(n.Tt,e)))},s=await n.mo("BatchGetDocuments",r,i,t.length),o=new Map;s.forEach((e=>{const t=function(e,t){return"found"in t?function(e,t){xu(!!t.found),t.found.name,t.found.updateTime;const n=Lf(e,t.found.name),r=xf(t.found.updateTime),i=t.found.createTime?xf(t.found.createTime):Xu.min(),s=new jh({mapValue:{fields:t.found.fields}});return Gh.newFoundDocument(n,r,i,s)}(e,t):"missing"in t?function(e,t){xu(!!t.missing),xu(!!t.readTime);const n=Lf(e,t.missing),r=xf(t.readTime);return Gh.newNoDocument(n,r)}(e,t):Du()}(n.Tt,e);o.set(t.key.toString(),t)}));const a=[];return t.forEach((e=>{const t=o.get(e.toString());xu(!!t),a.push(t)})),a}(this.datastore,e);return t.forEach((e=>this.recordVersion(e))),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new Wd(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const e=this.readVersions;this.mutations.forEach((t=>{e.delete(t.key.toString())})),e.forEach(((e,t)=>{const n=tl.fromPath(t);this.mutations.push(new Hd(n,this.precondition(n)))})),await async function(e,t){const n=Ru(e),r=Vf(n.Tt)+"/documents",i={writes:t.map((e=>jf(n.Tt,e)))};await n.lo("Commit",r,i)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Du();t=Xu.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new Pu(Ou.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Xu.min())?Pd.exists(!1):Pd.updateTime(t):Pd.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Xu.min()))throw new Pu(Ou.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Pd.updateTime(t)}return Pd.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class Bv{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.Mc=n.maxAttempts,this.ko=new ty(this.asyncQueue,"transaction_retry")}run(){this.Mc-=1,this.Fc()}Fc(){this.ko.vo((async()=>{const e=new qv(this.datastore),t=this.$c(e);t&&t.then((t=>{this.asyncQueue.enqueueAndForget((()=>e.commit().then((()=>{this.deferred.resolve(t)})).catch((e=>{this.Bc(e)}))))})).catch((e=>{this.Bc(e)}))}))}$c(e){try{const t=this.updateFunction(e);return!Rl(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Bc(e){this.Mc>0&&this.Lc(e)?(this.Mc-=1,this.asyncQueue.enqueueAndForget((()=>(this.Fc(),Promise.resolve())))):this.deferred.reject(e)}Lc(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!Jd(t)}return!1}}class jv{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=_u.UNAUTHENTICATED,this.clientId=zu.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async e=>{ku("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(ku("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Pu(Ou.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Lu;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Fy(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function Kv(e,t){e.asyncQueue.verifyOperationInProgress(),ku("FirestoreClient","Initializing OfflineComponentProvider");const n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await kg(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e.offlineComponents=t}async function Gv(e,t){e.asyncQueue.verifyOperationInProgress();const n=await zv(e);ku("FirestoreClient","Initializing OnlineComponentProvider");const r=await e.getConfiguration();await t.initialize(n,r),e.setCredentialChangeListener((e=>Ry(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>Ry(t.remoteStore,n))),e.onlineComponents=t}async function zv(e){return e.offlineComponents||(ku("FirestoreClient","Using default OfflineComponentProvider"),await Kv(e,new Ov)),e.offlineComponents}async function $v(e){return e.onlineComponents||(ku("FirestoreClient","Using default OnlineComponentProvider"),await Gv(e,new Mv)),e.onlineComponents}function Wv(e){return zv(e).then((e=>e.persistence))}function Hv(e){return zv(e).then((e=>e.localStore))}function Qv(e){return $v(e).then((e=>e.remoteStore))}function Xv(e){return $v(e).then((e=>e.syncEngine))}async function Yv(e){const t=await $v(e),n=t.eventManager;return n.onListen=sv.bind(null,t.syncEngine),n.onUnlisten=av.bind(null,t.syncEngine),n}function Jv(e,t,n={}){const r=new Lu;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new Vv({next:s=>{t.enqueueAndForget((()=>Gy(e,o)));const a=s.docs.has(n);!a&&s.fromCache?i.reject(new Pu(Ou.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&s.fromCache&&r&&"server"===r.source?i.reject(new Pu(Ou.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:e=>i.reject(e)}),o=new Hy(td(n.path),s,{includeMetadataChanges:!0,Ou:!0});return Ky(e,o)}(await Yv(e),e.asyncQueue,t,n,r))),r.promise}function Zv(e,t,n={}){const r=new Lu;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new Vv({next:n=>{t.enqueueAndForget((()=>Gy(e,o))),n.fromCache&&"server"===r.source?i.reject(new Pu(Ou.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new Hy(n,s,{includeMetadataChanges:!0,Ou:!0});return Ky(e,o)}(await Yv(e),e.asyncQueue,t,n,r))),r.promise}const ew=new Map;function tw(e,t,n){if(!n)throw new Pu(Ou.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function nw(e,t,n,r){if(!0===t&&!0===r)throw new Pu(Ou.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function rw(e){if(!tl.isDocumentKey(e))throw new Pu(Ou.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function iw(e){if(tl.isDocumentKey(e))throw new Pu(Ou.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function sw(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":Du()}function ow(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new Pu(Ou.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=sw(e);throw new Pu(Ou.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function aw(e,t){if(t<=0)throw new Pu(Ou.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}class cw{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new Pu(Ou.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new Pu(Ou.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,nw("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class uw{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new cw({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Pu(Ou.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new Pu(Ou.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new cw(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Fu;switch(e.type){case"gapi":const t=e.client;return new Bu(t,e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new Pu(Ou.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=ew.get(e);t&&(ku("ComponentProvider","Removing Datastore"),ew.delete(e),t.terminate())}(this),Promise.resolve()}}class lw{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new dw(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new lw(this.firestore,e,this._key)}}class hw{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new hw(this.firestore,e,this._query)}}class dw extends hw{constructor(e,t,n){super(e,t,td(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new lw(this.firestore,null,new tl(e))}withConverter(e){return new dw(this.firestore,e,this._path)}}function fw(e,t,...n){if(e=N(e),tw("collection","path",t),e instanceof uw){const r=Ju.fromString(t,...n);return iw(r),new dw(e,null,r)}{if(!(e instanceof lw||e instanceof dw))throw new Pu(Ou.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(Ju.fromString(t,...n));return iw(r),new dw(e.firestore,null,r)}}function pw(e,t,...n){if(e=N(e),1===arguments.length&&(t=zu.R()),tw("doc","path",t),e instanceof uw){const r=Ju.fromString(t,...n);return rw(r),new lw(e,null,new tl(r))}{if(!(e instanceof lw||e instanceof dw))throw new Pu(Ou.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(Ju.fromString(t,...n));return rw(r),new lw(e.firestore,e instanceof dw?e.converter:null,new tl(r))}}function mw(e,t){return e=N(e),t=N(t),(e instanceof lw||e instanceof dw)&&(t instanceof lw||t instanceof dw)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function gw(e,t){return e=N(e),t=N(t),e instanceof hw&&t instanceof hw&&e.firestore===t.firestore&&ld(e._query,t._query)&&e.converter===t.converter}class yw{constructor(){this.qc=Promise.resolve(),this.Uc=[],this.Kc=!1,this.Gc=[],this.Qc=null,this.jc=!1,this.zc=!1,this.Wc=[],this.ko=new ty(this,"async_queue_retry"),this.Hc=()=>{const e=Zg();e&&ku("AsyncQueue","Visibility state changed to "+e.visibilityState),this.ko.Vo()};const e=Zg();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Hc)}get isShuttingDown(){return this.Kc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Jc(),this.Yc(e)}enterRestrictedMode(e){if(!this.Kc){this.Kc=!0,this.zc=e||!1;const t=Zg();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Hc)}}enqueue(e){if(this.Jc(),this.Kc)return new Promise((()=>{}));const t=new Lu;return this.Yc((()=>this.Kc&&this.zc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Uc.push(e),this.Zc())))}async Zc(){if(0!==this.Uc.length){try{await this.Uc[0](),this.Uc.shift(),this.ko.reset()}catch(e){if(!wl(e))throw e;ku("AsyncQueue","Operation failed with retryable error: "+e)}this.Uc.length>0&&this.ko.vo((()=>this.Zc()))}}Yc(e){const t=this.qc.then((()=>(this.jc=!0,e().catch((e=>{this.Qc=e,this.jc=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw Au("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this.jc=!1,e))))));return this.qc=t,t}enqueueAfterDelay(e,t,n){this.Jc(),this.Wc.indexOf(e)>-1&&(t=0);const r=My.createAndSchedule(this,e,t,n,(e=>this.Xc(e)));return this.Gc.push(r),r}Jc(){this.Qc&&Du()}verifyOperationInProgress(){}async ta(){let e;do{e=this.qc,await e}while(e!==this.qc)}ea(e){for(const t of this.Gc)if(t.timerId===e)return!0;return!1}na(e){return this.ta().then((()=>{this.Gc.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.Gc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.ta()}))}sa(e){this.Wc.push(e)}Xc(e){const t=this.Gc.indexOf(e);this.Gc.splice(t,1)}}function vw(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const e of["next","error","complete"])if(e in n&&"function"==typeof n[e])return!0;return!1}(e)}class ww{constructor(){this._progressObserver={},this._taskCompletionResolver=new Lu,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class Iw extends uw{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new yw,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||_w(this),this._firestoreClient.terminate()}}function bw(e){return e._firestoreClient||_w(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function _w(e){var t;const n=e._freezeSettings(),r=function(e,t,n,r){return new Al(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,n);e._firestoreClient=new jv(e._authCredentials,e._appCheckCredentials,e._queue,r)}function Tw(e,t,n){const r=new Lu;return e.asyncQueue.enqueue((async()=>{try{await Kv(e,n),await Gv(e,t),r.resolve()}catch(e){const t=e;if(!function(e){return"FirebaseError"===e.name?e.code===Ou.FAILED_PRECONDITION||e.code===Ou.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(t))throw t;Cu("Error enabling offline persistence. Falling back to persistence disabled: "+t),r.reject(t)}})).then((()=>r.promise))}function Ew(e){if(e._initialized||e._terminated)throw new Pu(Ou.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Sw{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Sw(Ml.fromBase64String(e))}catch(e){throw new Pu(Ou.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Sw(Ml.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class kw{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new Pu(Ou.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new el(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Aw{constructor(e){this._methodName=e}}class Cw{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Pu(Ou.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Pu(Ou.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return $u(this._lat,e._lat)||$u(this._long,e._long)}}const Nw=/^__.*__$/;class Dw{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Kd(e,this.data,this.fieldMask,t,this.fieldTransforms):new jd(e,this.data,t,this.fieldTransforms)}}class xw{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Kd(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Rw(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Du()}}class Ow{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.Tt=n,this.ignoreUndefinedProperties=r,void 0===i&&this.ia(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get ra(){return this.settings.ra}oa(e){return new Ow(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.Tt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ua(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.oa({path:n,ca:!1});return r.aa(e),r}ha(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.oa({path:n,ca:!1});return r.ia(),r}la(e){return this.oa({path:void 0,ca:!0})}fa(e){return Zw(e,this.settings.methodName,this.settings.da||!1,this.path,this.settings._a)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}ia(){if(this.path)for(let e=0;e<this.path.length;e++)this.aa(this.path.get(e))}aa(e){if(0===e.length)throw this.fa("Document fields must not be empty");if(Rw(this.ra)&&Nw.test(e))throw this.fa('Document fields cannot begin and end with "__"')}}class Pw{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.Tt=n||ey(e)}wa(e,t,n,r=!1){return new Ow({ra:e,methodName:t,_a:n,path:el.emptyPath(),ca:!1,da:r},this.databaseId,this.Tt,this.ignoreUndefinedProperties)}}function Lw(e){const t=e._freezeSettings(),n=ey(e._databaseId);return new Pw(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Mw(e,t,n,r,i,s={}){const o=e.wa(s.merge||s.mergeFields?2:0,t,n,i);Qw("Data must be an object, but it was:",o,r);const a=Ww(r,o);let c,u;if(s.merge)c=new Bh(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=Xw(t,r,n);if(!o.contains(i))throw new Pu(Ou.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);eI(e,i)||e.push(i)}c=new Bh(e),u=o.fieldTransforms.filter((e=>c.covers(e.field)))}else c=null,u=o.fieldTransforms;return new Dw(new jh(a),c,u)}class Fw extends Aw{_toFieldTransform(e){if(2!==e.ra)throw 1===e.ra?e.fa(`${this._methodName}() can only appear at the top level of your update data`):e.fa(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Fw}}function Vw(e,t,n){return new Ow({ra:3,_a:t.settings._a,methodName:e._methodName,ca:n},t.databaseId,t.Tt,t.ignoreUndefinedProperties)}class Uw extends Aw{_toFieldTransform(e){return new Rd(e.path,new Ed)}isEqual(e){return e instanceof Uw}}class qw extends Aw{constructor(e,t){super(e),this.ma=t}_toFieldTransform(e){const t=Vw(this,e,!0),n=this.ma.map((e=>$w(e,t))),r=new Sd(n);return new Rd(e.path,r)}isEqual(e){return this===e}}class Bw extends Aw{constructor(e,t){super(e),this.ma=t}_toFieldTransform(e){const t=Vw(this,e,!0),n=this.ma.map((e=>$w(e,t))),r=new Ad(n);return new Rd(e.path,r)}isEqual(e){return this===e}}class jw extends Aw{constructor(e,t){super(e),this.ga=t}_toFieldTransform(e){const t=new Nd(e.Tt,wd(e.Tt,this.ga));return new Rd(e.path,t)}isEqual(e){return this===e}}function Kw(e,t,n,r){const i=e.wa(1,t,n);Qw("Data must be an object, but it was:",i,r);const s=[],o=jh.empty();Dl(r,((e,r)=>{const a=Jw(t,e,n);r=N(r);const c=i.ha(a);if(r instanceof Fw)s.push(a);else{const e=$w(r,c);null!=e&&(s.push(a),o.set(a,e))}}));const a=new Bh(s);return new xw(o,a,i.fieldTransforms)}function Gw(e,t,n,r,i,s){const o=e.wa(1,t,n),a=[Xw(t,r,n)],c=[i];if(s.length%2!=0)throw new Pu(Ou.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)a.push(Xw(t,s[e])),c.push(s[e+1]);const u=[],l=jh.empty();for(let e=a.length-1;e>=0;--e)if(!eI(u,a[e])){const t=a[e];let n=c[e];n=N(n);const r=o.ha(t);if(n instanceof Fw)u.push(t);else{const e=$w(n,r);null!=e&&(u.push(t),l.set(t,e))}}const h=new Bh(u);return new xw(l,h,o.fieldTransforms)}function zw(e,t,n,r=!1){return $w(n,e.wa(r?4:3,t))}function $w(e,t){if(Hw(e=N(e)))return Qw("Unsupported field value:",t,e),Ww(e,t);if(e instanceof Aw)return function(e,t){if(!Rw(t.ra))throw t.fa(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.fa(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.ca&&4!==t.ra)throw t.fa("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=$w(i,t.la(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=N(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return wd(t.Tt,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=Qu.fromDate(e);return{timestampValue:Cf(t.Tt,n)}}if(e instanceof Qu){const n=new Qu(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Cf(t.Tt,n)}}if(e instanceof Cw)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Sw)return{bytesValue:Nf(t.Tt,e._byteString)};if(e instanceof lw){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.fa(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Rf(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.fa(`Unsupported field value: ${sw(e)}`)}(e,t)}function Ww(e,t){const n={};return xl(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Dl(e,((e,r)=>{const i=$w(r,t.ua(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function Hw(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Qu||e instanceof Cw||e instanceof Sw||e instanceof lw||e instanceof Aw)}function Qw(e,t,n){if(!Hw(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=sw(n);throw"an object"===r?t.fa(e+" a custom object"):t.fa(e+" "+r)}}function Xw(e,t,n){if((t=N(t))instanceof kw)return t._internalPath;if("string"==typeof t)return Jw(e,t);throw Zw("Field path arguments must be of type string or ",e,!1,void 0,n)}const Yw=new RegExp("[~\\*/\\[\\]]");function Jw(e,t,n){if(t.search(Yw)>=0)throw Zw(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new kw(...t.split("."))._internalPath}catch(r){throw Zw(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function Zw(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new Pu(Ou.INVALID_ARGUMENT,a+e+c)}function eI(e,t){return e.some((e=>e.isEqual(t)))}class tI{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new lw(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new nI(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(rI("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class nI extends tI{data(){return super.data()}}function rI(e,t){return"string"==typeof t?Jw(e,t):t instanceof kw?t._internalPath:t._delegate._internalPath}function iI(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new Pu(Ou.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class sI{}class oI extends sI{}function aI(e,t,...n){let r=[];t instanceof sI&&r.push(t),r=r.concat(n),function(e){const t=e.filter((e=>e instanceof uI)).length,n=e.filter((e=>e instanceof cI)).length;if(t>1||t>0&&n>0)throw new Pu(Ou.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const t of r)e=t._apply(e);return e}class cI extends oI{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new cI(e,t,n)}_apply(e){const t=this._parse(e);return yI(e._query,t),new hw(e.firestore,e.converter,cd(e._query,t))}_parse(e){const t=Lw(e.firestore),n=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new Pu(Ou.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){gI(o,s);const t=[];for(const n of o)t.push(mI(r,e,n));a={arrayValue:{values:t}}}else a=mI(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||gI(o,s),a=zw(n,"where",o,"in"===s||"not-in"===s);return mh.create(i,s,a)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value);return n}}class uI extends sI{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new uI(e,t)}_parse(e){const t=this._queryConstraints.map((t=>t._parse(e))).filter((e=>e.getFilters().length>0));return 1===t.length?t[0]:gh.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const e of r)yI(n,e),n=cd(n,e)}(e._query,t),new hw(e.firestore,e.converter,cd(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class lI extends oI{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new lI(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new Pu(Ou.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new Pu(Ou.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const r=new Oh(t,n);return function(e,t){if(null===rd(e)){const n=id(e);null!==n&&vI(0,n,t.field)}}(e,r),r}(e._query,this._field,this._direction);return new hw(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new Zh(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}class hI extends oI{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new hI(e,t,n)}_apply(e){return new hw(e.firestore,e.converter,ud(e._query,this._limit,this._limitType))}}class dI extends oI{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new dI(e,t,n)}_apply(e){const t=pI(e,this.type,this._docOrFields,this._inclusive);return new hw(e.firestore,e.converter,function(e,t){return new Zh(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}class fI extends oI{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new fI(e,t,n)}_apply(e){const t=pI(e,this.type,this._docOrFields,this._inclusive);return new hw(e.firestore,e.converter,function(e,t){return new Zh(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}function pI(e,t,n,r){if(n[0]=N(n[0]),n[0]instanceof tI)return function(e,t,n,r,i){if(!r)throw new Pu(Ou.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const n of od(e))if(n.field.isKeyField())s.push(Zl(t,r.key));else{const e=r.data.field(n.field);if(Bl(e))throw new Pu(Ou.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new Pu(Ou.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new hh(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{const i=Lw(e.firestore);return function(e,t,n,r,i,s){const o=e.explicitOrderBy;if(i.length>o.length)throw new Pu(Ou.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let s=0;s<i.length;s++){const c=i[s];if(o[s].field.isKeyField()){if("string"!=typeof c)throw new Pu(Ou.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!sd(e)&&-1!==c.indexOf("/"))throw new Pu(Ou.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);const n=e.path.child(Ju.fromString(c));if(!tl.isDocumentKey(n))throw new Pu(Ou.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new tl(n);a.push(Zl(t,i))}else{const e=zw(n,r,c);a.push(e)}}return new hh(a,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}function mI(e,t,n){if("string"==typeof(n=N(n))){if(""===n)throw new Pu(Ou.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!sd(t)&&-1!==n.indexOf("/"))throw new Pu(Ou.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(Ju.fromString(n));if(!tl.isDocumentKey(r))throw new Pu(Ou.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Zl(e,new tl(r))}if(n instanceof lw)return Zl(e,n._key);throw new Pu(Ou.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${sw(n)}.`)}function gI(e,t){if(!Array.isArray(e)||0===e.length)throw new Pu(Ou.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function yI(e,t){if(t.isInequality()){const n=id(e),r=t.field;if(null!==n&&!n.isEqual(r))throw new Pu(Ou.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${r.toString()}'`);const i=rd(e);null!==i&&vI(0,r,i)}const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new Pu(Ou.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new Pu(Ou.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}function vI(e,t,n){if(!n.isEqual(t))throw new Pu(Ou.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class wI{convertValue(e,t="none"){switch($l(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ul(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ql(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Du()}}convertObject(e,t){const n={};return Dl(e.fields,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertGeoPoint(e){return new Cw(Ul(e.latitude),Ul(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=jl(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Kl(e));default:return null}}convertTimestamp(e){const t=Vl(e);return new Qu(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=Ju.fromString(e);xu(tp(n));const r=new Cl(n.get(1),n.get(3)),i=new tl(n.popFirst(5));return r.isEqual(t)||Au(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function II(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class bI extends wI{constructor(e){super(),this.firestore=e}convertBytes(e){return new Sw(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new lw(this.firestore,null,t)}}class _I{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class TI extends tI{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new EI(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(rI("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class EI extends TI{data(e={}){return super.data(e)}}class SI{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new _I(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new EI(this._firestore,this._userDataWriter,n.key,n,new _I(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Pu(Ou.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{const r=new EI(e._firestore,e._userDataWriter,n.doc.key,n.doc,new _I(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const r=new EI(e._firestore,e._userDataWriter,t.doc.key,t.doc,new _I(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:kI(t.type),doc:r,oldIndex:i,newIndex:s}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function kI(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Du()}}function AI(e,t){return e instanceof TI&&t instanceof TI?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof SI&&t instanceof SI&&e._firestore===t._firestore&&gw(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}class CI extends wI{constructor(e){super(),this.firestore=e}convertBytes(e){return new Sw(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new lw(this.firestore,null,t)}}function NI(e,t,n){e=ow(e,lw);const r=ow(e.firestore,Iw),i=II(e.converter,t,n);return RI(r,[Mw(Lw(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Pd.none())])}function DI(e,t,n,...r){e=ow(e,lw);const i=ow(e.firestore,Iw),s=Lw(i);let o;return o="string"==typeof(t=N(t))||t instanceof kw?Gw(s,"updateDoc",e._key,t,n,r):Kw(s,"updateDoc",e._key,t),RI(i,[o.toMutation(e._key,Pd.exists(!0))])}function xI(e,...t){var n,r,i;e=N(e);let s={includeMetadataChanges:!1},o=0;"object"!=typeof t[o]||vw(t[o])||(s=t[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges};if(vw(t[o])){const e=t[o];t[o]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[o+1]=null===(r=e.error)||void 0===r?void 0:r.bind(e),t[o+2]=null===(i=e.complete)||void 0===i?void 0:i.bind(e)}let c,u,l;if(e instanceof lw)u=ow(e.firestore,Iw),l=td(e._key.path),c={next:n=>{t[o]&&t[o](OI(u,e,n))},error:t[o+1],complete:t[o+2]};else{const n=ow(e,hw);u=ow(n.firestore,Iw),l=n._query;const r=new CI(u);c={next:e=>{t[o]&&t[o](new SI(u,r,n,e))},error:t[o+1],complete:t[o+2]},iI(e._query)}return function(e,t,n,r){const i=new Vv(r),s=new Hy(t,i,n);return e.asyncQueue.enqueueAndForget((async()=>Ky(await Yv(e),s))),()=>{i.Pc(),e.asyncQueue.enqueueAndForget((async()=>Gy(await Yv(e),s)))}}(bw(u),l,a,c)}function RI(e,t){return function(e,t){const n=new Lu;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const r=Rv(e);try{const e=await function(e,t){const n=Ru(e),r=Qu.now(),i=t.reduce(((e,t)=>e.add(t.key)),df());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let a=nf(),c=df();return n.ji.getEntries(e,i).next((e=>{a=e,a.forEach(((e,t)=>{t.isValidDocument()||(c=c.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,a))).next((i=>{s=i;const o=[];for(const e of t){const t=qd(e,s.get(e.key).overlayedDocument);null!=t&&o.push(new Kd(e.key,t,Kh(t.value.mapValue),Pd.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,o,t)})).next((t=>{o=t;const r=t.applyToLocalDocumentSet(s,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:of(s)})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.fc[e.currentUser.toKey()];r||(r=new Lh($u)),r=r.insert(t,n),e.fc[e.currentUser.toKey()]=r}(r,e.batchId,n),await Iv(r,e.changes),await Ty(r.remoteStore)}catch(e){const t=Fy(e,"Failed to persist write");n.reject(t)}}(await Xv(e),t,n))),n.promise}(bw(e),t)}function OI(e,t,n){const r=n.docs.get(t._key),i=new CI(e);return new TI(e,i,t._key,r,new _I(n.hasPendingWrites,n.fromCache),t.converter)}const PI={maxAttempts:5};class LI{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Lw(e)}set(e,t,n){this._verifyNotCommitted();const r=MI(e,this._firestore),i=II(r.converter,t,n),s=Mw(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,Pd.none())),this}update(e,t,n,...r){this._verifyNotCommitted();const i=MI(e,this._firestore);let s;return s="string"==typeof(t=N(t))||t instanceof kw?Gw(this._dataReader,"WriteBatch.update",i._key,t,n,r):Kw(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(s.toMutation(i._key,Pd.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=MI(e,this._firestore);return this._mutations=this._mutations.concat(new Wd(t._key,Pd.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Pu(Ou.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function MI(e,t){if((e=N(e)).firestore!==t)throw new Pu(Ou.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class FI extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Lw(e)}get(e){const t=MI(e,this._firestore),n=new bI(this._firestore);return this._transaction.lookup([t._key]).then((e=>{if(!e||1!==e.length)return Du();const r=e[0];if(r.isFoundDocument())return new tI(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new tI(this._firestore,n,t._key,null,t.converter);throw Du()}))}set(e,t,n){const r=MI(e,this._firestore),i=II(r.converter,t,n),s=Mw(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(e,t,n,...r){const i=MI(e,this._firestore);let s;return s="string"==typeof(t=N(t))||t instanceof kw?Gw(this._dataReader,"Transaction.update",i._key,t,n,r):Kw(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,s),this}delete(e){const t=MI(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=MI(e,this._firestore),n=new CI(this._firestore);return super.get(e).then((e=>new TI(this._firestore,n,t._key,e._document,new _I(!1,!1),t.converter)))}}!function(e,t=!0){!function(e){Tu=e}(Ie),pe(new D("firestore",((e,{instanceIdentifier:n,options:r})=>{const i=e.getProvider("app").getImmediate(),s=new Iw(new Uu(e.getProvider("auth-internal")),new Ku(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new Pu(Ou.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Cl(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:t},r),s._setSettings(r),s}),"PUBLIC").setMultipleInstances(!0)),Se(bu,"3.8.4",e),Se(bu,"3.8.4","esm2017")}();function VI(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new Pu("invalid-argument",`Invalid options passed to function ${e}(): You cannot specify both "merge" and "mergeFields".`);return t}function UI(){if("undefined"==typeof Uint8Array)throw new Pu("unimplemented","Uint8Arrays are not available in this environment.")}function qI(){if("undefined"==typeof atob)throw new Pu("unimplemented","Blobs are unavailable in Firestore in this environment.")}class BI{constructor(e){this._delegate=e}static fromBase64String(e){return qI(),new BI(Sw.fromBase64String(e))}static fromUint8Array(e){return UI(),new BI(Sw.fromUint8Array(e))}toBase64(){return qI(),this._delegate.toBase64()}toUint8Array(){return UI(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function jI(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const e of["next","error","complete"])if(e in n&&"function"==typeof n[e])return!0;return!1}(e)}class KI{enableIndexedDbPersistence(e,t){return function(e,t){Ew(e=ow(e,Iw));const n=bw(e),r=e._freezeSettings(),i=new Mv;return Tw(n,i,new Pv(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function(e){Ew(e=ow(e,Iw));const t=bw(e),n=e._freezeSettings(),r=new Mv;return Tw(t,r,new Lv(r,n.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function(e){if(e._initialized&&!e._terminated)throw new Pu(Ou.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new Lu;return e._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await async function(e){if(!gl.C())return Promise.resolve();const t=e+"main";await gl.delete(t)}(bg(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}})),t.promise}(e._delegate)}}class GI{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof Cl||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();e.merge||t.host===e.host||Cu("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){!function(e,t,n,r={}){var i;const o=(e=ow(e,uw))._getSettings();if("firestore.googleapis.com"!==o.host&&o.host!==t&&Cu("Host has been set in both settings() and useEmulator(), emulator host will be used"),e._setSettings(Object.assign(Object.assign({},o),{host:`${t}:${n}`,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=_u.MOCK_USER;else{t=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[s(JSON.stringify({alg:"none",type:"JWT"})),s(JSON.stringify(o)),""].join(".")}(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const o=r.mockUserToken.sub||r.mockUserToken.user_id;if(!o)throw new Pu(Ou.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new _u(o)}e._authCredentials=new Vu(new Mu(t,n))}}(this._delegate,e,t,n)}enableNetwork(){return function(e){return function(e){return e.asyncQueue.enqueue((async()=>{const t=await Wv(e),n=await Qv(e);return t.setNetworkEnabled(!0),function(e){const t=Ru(e);return t.mu.delete(0),cy(t)}(n)}))}(bw(e=ow(e,Iw)))}(this._delegate)}disableNetwork(){return function(e){return function(e){return e.asyncQueue.enqueue((async()=>{const t=await Wv(e),n=await Qv(e);return t.setNetworkEnabled(!1),async function(e){const t=Ru(e);t.mu.add(0),await uy(t),t.pu.set("Offline")}(n)}))}(bw(e=ow(e,Iw)))}(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,nw("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function(e){return function(e){const t=new Lu;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t){const n=Ru(e);gy(n.remoteStore)||ku("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(e){const t=Ru(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e)))}(n.localStore);if(-1===e)return void t.resolve();const r=n.dc.get(e)||[];r.push(t),n.dc.set(e,r)}catch(e){const n=Fy(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await Xv(e),t))),t.promise}(bw(e=ow(e,Iw)))}(this._delegate)}onSnapshotsInSync(e){return function(e,t){return function(e,t){const n=new Vv(t);return e.asyncQueue.enqueueAndForget((async()=>function(e,t){Ru(e).vu.add(t),t.next()}(await Yv(e),n))),()=>{n.Pc(),e.asyncQueue.enqueueAndForget((async()=>function(e,t){Ru(e).vu.delete(t)}(await Yv(e),n)))}}(bw(e=ow(e,Iw)),vw(t)?t:{next:t})}(this._delegate,e)}get app(){if(!this._appCompat)throw new Pu("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new ib(this,fw(this._delegate,e))}catch(e){throw XI(e,"collection()","Firestore.collection()")}}doc(e){try{return new QI(this,pw(this._delegate,e))}catch(e){throw XI(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new tb(this,function(e,t){if(e=ow(e,uw),tw("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new Pu(Ou.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new hw(e,null,function(e){return new Zh(Ju.emptyPath(),e)}(t))}(this._delegate,e))}catch(e){throw XI(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function(e,t,n){e=ow(e,Iw);const r=Object.assign(Object.assign({},PI),void 0);return function(e){if(e.maxAttempts<1)throw new Pu(Ou.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(e,t,n){const r=new Lu;return e.asyncQueue.enqueueAndForget((async()=>{const i=await function(e){return $v(e).then((e=>e.datastore))}(e);new Bv(e.asyncQueue,i,n,t,r).run()})),r.promise}(bw(e),(n=>t(new FI(e,n))),r)}(this._delegate,(t=>e(new $I(this,t))))}batch(){return bw(this._delegate),new WI(new LI(this._delegate,(e=>RI(this._delegate,e))))}loadBundle(e){return function(e,t){const n=bw(e=ow(e,Iw)),r=new ww;return function(e,t,n,r){const i=function(e,t){let n;return n="string"==typeof e?(new TextEncoder).encode(e):e,function(e,t){return new Uv(e,t)}(function(e,t){if(e instanceof Uint8Array)return Fv(e,t);if(e instanceof ArrayBuffer)return Fv(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),t)}(n,ey(t));e.asyncQueue.enqueueAndForget((async()=>{!function(e,t,n){const r=Ru(e);(async function(e,t,n){try{const r=await t.getMetadata();if(await function(e,t){const n=Ru(e),r=xf(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(e=>n.Os.getBundleMetadata(e,t.id))).then((e=>!!e&&e.createTime.compareTo(r)>=0))}(e.localStore,r))return await t.close(),n._completeWith(function(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(r)),Promise.resolve(new Set);n._updateProgress(Jy(r));const i=new Yy(r,e.localStore,t.Tt);let s=await t.yc();for(;s;){const e=await i.Bu(s);e&&n._updateProgress(e),s=await t.yc()}const o=await i.complete();return await Iv(e,o.Uu,void 0),await function(e,t){const n=Ru(e);return n.persistence.runTransaction("Save bundle","readwrite",(e=>n.Os.saveBundleMetadata(e,t)))}(e.localStore,r),n._completeWith(o.progress),Promise.resolve(o.qu)}catch(e){return Cu("SyncEngine",`Loading bundle failed with ${e}`),n._failWith(e),Promise.resolve(new Set)}})(r,t,n).then((e=>{r.sharedClientState.notifyBundleLoaded(e)}))}(await Xv(e),i,r)}))}(n,e._databaseId,t,r),r}(this._delegate,e)}namedQuery(e){return function(e,t){return function(e,t){return e.asyncQueue.enqueue((async()=>function(e,t){const n=Ru(e);return n.persistence.runTransaction("Get named query","readonly",(e=>n.Os.getNamedQuery(e,t)))}(await Hv(e),t)))}(bw(e=ow(e,Iw)),t).then((t=>t?new hw(e,null,t.query):null))}(this._delegate,e).then((e=>e?new tb(this,e):null))}}class zI extends wI{constructor(e){super(),this.firestore=e}convertBytes(e){return new BI(new Sw(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return QI.forKey(t,this.firestore,null)}}class $I{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new zI(e)}get(e){const t=sb(e);return this._delegate.get(t).then((e=>new ZI(this._firestore,new TI(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter))))}set(e,t,n){const r=sb(e);return n?(VI("Transaction.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){const i=sb(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){const t=sb(e);return this._delegate.delete(t),this}}class WI{constructor(e){this._delegate=e}set(e,t,n){const r=sb(e);return n?(VI("WriteBatch.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){const i=sb(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){const t=sb(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class HI{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){const n=new EI(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new eb(this._firestore,n),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=HI.INSTANCES;let r=n.get(e);r||(r=new WeakMap,n.set(e,r));let i=r.get(t);return i||(i=new HI(e,new zI(e),t),r.set(t,i)),i}}HI.INSTANCES=new WeakMap;class QI{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new zI(e)}static forPath(e,t,n){if(e.length%2!=0)throw new Pu("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new QI(t,new lw(t._delegate,n,new tl(e)))}static forKey(e,t,n){return new QI(t,new lw(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new ib(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new ib(this.firestore,fw(this._delegate,e))}catch(e){throw XI(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=N(e))instanceof lw&&mw(this._delegate,e)}set(e,t){t=VI("DocumentReference.set",t);try{return t?NI(this._delegate,e,t):NI(this._delegate,e)}catch(e){throw XI(e,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?DI(this._delegate,e):DI(this._delegate,e,t,...n)}catch(e){throw XI(e,"updateDoc()","DocumentReference.update()")}}delete(){return function(e){return RI(ow(e.firestore,Iw),[new Wd(e._key,Pd.none())])}(this._delegate)}onSnapshot(...e){const t=YI(e),n=JI(e,(e=>new ZI(this.firestore,new TI(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter))));return xI(this._delegate,t,n)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function(e){e=ow(e,lw);const t=ow(e.firestore,Iw),n=bw(t),r=new CI(t);return function(e,t){const n=new Lu;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){try{const r=await function(e,t){const n=Ru(e);return n.persistence.runTransaction("read document","readonly",(e=>n.localDocuments.getDocument(e,t)))}(e,t);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new Pu(Ou.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){const r=Fy(e,`Failed to get document '${t} from cache`);n.reject(r)}}(await Hv(e),t,n))),n.promise}(n,e._key).then((n=>new TI(t,r,e._key,n,new _I(null!==n&&n.hasLocalMutations,!0),e.converter)))}(this._delegate):"server"===(null==e?void 0:e.source)?function(e){e=ow(e,lw);const t=ow(e.firestore,Iw);return Jv(bw(t),e._key,{source:"server"}).then((n=>OI(t,e,n)))}(this._delegate):function(e){e=ow(e,lw);const t=ow(e.firestore,Iw);return Jv(bw(t),e._key).then((n=>OI(t,e,n)))}(this._delegate),t.then((e=>new ZI(this.firestore,new TI(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter))))}withConverter(e){return new QI(this.firestore,e?this._delegate.withConverter(HI.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function XI(e,t,n){return e.message=e.message.replace(t,n),e}function YI(e){for(const t of e)if("object"==typeof t&&!jI(t))return t;return{}}function JI(e,t){var n,r;let i;return i=jI(e[0])?e[0]:jI(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{i.next&&i.next(t(e))},error:null===(n=i.error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}class ZI{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new QI(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return AI(this._delegate,e._delegate)}}class eb extends ZI{data(e){const t=this._delegate.data(e);return function(e,t){e||Du()}(void 0!==t),t}}class tb{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new zI(e)}where(e,t,n){try{return new tb(this.firestore,aI(this._delegate,function(e,t,n){const r=t,i=rI("where",e);return cI._create(i,r,n)}(e,t,n)))}catch(e){throw XI(e,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new tb(this.firestore,aI(this._delegate,function(e,t="asc"){const n=t,r=rI("orderBy",e);return lI._create(r,n)}(e,t)))}catch(e){throw XI(e,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new tb(this.firestore,aI(this._delegate,function(e){return aw("limit",e),hI._create("limit",e,"F")}(e)))}catch(e){throw XI(e,"limit()","Query.limit()")}}limitToLast(e){try{return new tb(this.firestore,aI(this._delegate,function(e){return aw("limitToLast",e),hI._create("limitToLast",e,"L")}(e)))}catch(e){throw XI(e,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new tb(this.firestore,aI(this._delegate,function(...e){return dI._create("startAt",e,!0)}(...e)))}catch(e){throw XI(e,"startAt()","Query.startAt()")}}startAfter(...e){try{return new tb(this.firestore,aI(this._delegate,function(...e){return dI._create("startAfter",e,!1)}(...e)))}catch(e){throw XI(e,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new tb(this.firestore,aI(this._delegate,function(...e){return fI._create("endBefore",e,!1)}(...e)))}catch(e){throw XI(e,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new tb(this.firestore,aI(this._delegate,function(...e){return fI._create("endAt",e,!0)}(...e)))}catch(e){throw XI(e,"endAt()","Query.endAt()")}}isEqual(e){return gw(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function(e){e=ow(e,hw);const t=ow(e.firestore,Iw),n=bw(t),r=new CI(t);return function(e,t){const n=new Lu;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){try{const r=await Rg(e,t,!0),i=new tv(t,r.Yi),s=i.Hu(r.documents),o=i.applyChanges(s,!1);n.resolve(o.snapshot)}catch(e){const r=Fy(e,`Failed to execute query '${t} against cache`);n.reject(r)}}(await Hv(e),t,n))),n.promise}(n,e._query).then((n=>new SI(t,r,e,n)))}(this._delegate):"server"===(null==e?void 0:e.source)?function(e){e=ow(e,hw);const t=ow(e.firestore,Iw),n=bw(t),r=new CI(t);return Zv(n,e._query,{source:"server"}).then((n=>new SI(t,r,e,n)))}(this._delegate):function(e){e=ow(e,hw);const t=ow(e.firestore,Iw),n=bw(t),r=new CI(t);return iI(e._query),Zv(n,e._query).then((n=>new SI(t,r,e,n)))}(this._delegate),t.then((e=>new rb(this.firestore,new SI(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot))))}onSnapshot(...e){const t=YI(e),n=JI(e,(e=>new rb(this.firestore,new SI(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot))));return xI(this._delegate,t,n)}withConverter(e){return new tb(this.firestore,e?this._delegate.withConverter(HI.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class nb{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new eb(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class rb{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new tb(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map((e=>new eb(this._firestore,e)))}docChanges(e){return this._delegate.docChanges(e).map((e=>new nb(this._firestore,e)))}forEach(e,t){this._delegate.forEach((n=>{e.call(t,new eb(this._firestore,n))}))}isEqual(e){return AI(this._delegate,e._delegate)}}class ib extends tb{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new QI(this.firestore,e):null}doc(e){try{return new QI(this.firestore,void 0===e?pw(this._delegate):pw(this._delegate,e))}catch(e){throw XI(e,"doc()","CollectionReference.doc()")}}add(e){return function(e,t){const n=ow(e.firestore,Iw),r=pw(e),i=II(e.converter,t);return RI(n,[Mw(Lw(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,Pd.exists(!1))]).then((()=>r))}(this._delegate,e).then((e=>new QI(this.firestore,e)))}isEqual(e){return mw(this._delegate,e._delegate)}withConverter(e){return new ib(this.firestore,e?this._delegate.withConverter(HI.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function sb(e){return ow(e,lw)}class ob{constructor(...e){this._delegate=new kw(...e)}static documentId(){return new ob(el.keyField().canonicalString())}isEqual(e){return(e=N(e))instanceof kw&&this._delegate._internalPath.isEqual(e._internalPath)}}class ab{constructor(e){this._delegate=e}static serverTimestamp(){const e=new Uw("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new ab(e)}static delete(){const e=new Fw("deleteField");return e._methodName="FieldValue.delete",new ab(e)}static arrayUnion(...e){const t=function(...e){return new qw("arrayUnion",e)}(...e);return t._methodName="FieldValue.arrayUnion",new ab(t)}static arrayRemove(...e){const t=function(...e){return new Bw("arrayRemove",e)}(...e);return t._methodName="FieldValue.arrayRemove",new ab(t)}static increment(e){const t=function(e){return new jw("increment",e)}(e);return t._methodName="FieldValue.increment",new ab(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const cb={Firestore:GI,GeoPoint:Cw,Timestamp:Qu,Blob:BI,Transaction:$I,WriteBatch:WI,DocumentReference:QI,DocumentSnapshot:ZI,Query:tb,QueryDocumentSnapshot:eb,QuerySnapshot:rb,CollectionReference:ib,FieldPath:ob,FieldValue:ab,setLogLevel:function(e){!function(e){Eu.setLogLevel(e)}(e)},CACHE_SIZE_UNLIMITED:-1};!function(e){!function(e,t){e.INTERNAL.registerComponent(new D("firestore-compat",(e=>((e,t)=>new GI(e,t,new KI))(e.getProvider("app-compat").getImmediate(),e.getProvider("firestore").getImmediate())),"PUBLIC").setServiceProps(Object.assign({},cb)))}(e),e.registerVersion("@firebase/firestore-compat","0.3.4")}(Ke),Ke.initializeApp({apiKey:"AIzaSyDktX7JTqbygFsWmIDncA4qf7yV2KqQOD8",authDomain:"chemisphere-33c44.firebaseapp.com",projectId:"chemisphere-33c44",storageBucket:"chemisphere-33c44.appspot.com",messagingSenderId:"781175905864",appId:"1:781175905864:web:6f96a7815c183fc4c0427d",measurementId:"G-MHRHYEZ6Z1"});var ub=document.getElementById("signup-form");ub.addEventListener("submit",(function(e){e.preventDefault();var t=ub.email.value,n=ub.password.value;Ke.auth().createUserWithEmailAndPassword(t,n).then((function(e){var t=e.user;alert("User account created:",t)})).catch((function(e){var t=e.code,n=e.message;console.error("Error creating user account:",t,n)}))}))})();